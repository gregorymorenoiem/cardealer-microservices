<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Test Search API Fix</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        padding: 20px;
      }
      .results {
        margin-top: 20px;
      }
      .error {
        color: red;
      }
      .success {
        color: green;
      }
      .vehicle {
        border: 1px solid #ccc;
        padding: 10px;
        margin: 5px 0;
      }
    </style>
  </head>
  <body>
    <h1>Test Search API Fix</h1>

    <h2>1. Test GlobalSearch endpoint (corrected)</h2>
    <button onclick="testGlobalSearch()">Test GlobalSearch BMW</button>
    <div id="globalSearchResults"></div>

    <h2>2. Test Catalog endpoint</h2>
    <button onclick="testCatalogMakes()">Test Get Makes</button>
    <div id="catalogResults"></div>

    <h2>3. Test Vehicles search</h2>
    <button onclick="testVehicleSearch()">Test Vehicle Search</button>
    <div id="vehicleResults"></div>

    <script>
      const API_URL = "http://localhost:18443";

      async function testGlobalSearch() {
        const resultsDiv = document.getElementById("globalSearchResults");
        resultsDiv.innerHTML = "Loading...";

        try {
          // This is the corrected URL from GlobalSearch.tsx
          const response = await fetch(
            `${API_URL}/api/vehicles?search=BMW&pageSize=8&page=1`
          );

          if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
          }

          const data = await response.json();

          resultsDiv.innerHTML = `
                    <div class="success">‚úÖ GlobalSearch Fixed! Found ${
                      data.vehicles.length
                    } vehicles</div>
                    <div class="results">
                        ${data.vehicles
                          .slice(0, 3)
                          .map(
                            (v) => `
                            <div class="vehicle">
                                <strong>${v.title}</strong><br>
                                Price: $${v.price.toLocaleString()}<br>
                                Year: ${v.year}, Make: ${v.make}, Model: ${
                              v.model
                            }
                            </div>
                        `
                          )
                          .join("")}
                    </div>
                `;

          console.log("GlobalSearch test passed:", data);
        } catch (error) {
          resultsDiv.innerHTML = `<div class="error">‚ùå Error: ${error.message}</div>`;
          console.error("GlobalSearch test failed:", error);
        }
      }

      async function testCatalogMakes() {
        const resultsDiv = document.getElementById("catalogResults");
        resultsDiv.innerHTML = "Loading...";

        try {
          // This is the corrected URL from SearchPage.tsx
          const response = await fetch(`${API_URL}/api/catalog/makes`);

          if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
          }

          const data = await response.json();

          resultsDiv.innerHTML = `
                    <div class="success">‚úÖ Catalog Fixed! Found ${
                      data.length
                    } makes</div>
                    <div class="results">
                        Popular makes: ${data
                          .filter((m) => m.isPopular)
                          .slice(0, 5)
                          .map((m) => m.name)
                          .join(", ")}
                    </div>
                `;

          console.log("Catalog test passed:", data);
        } catch (error) {
          resultsDiv.innerHTML = `<div class="error">‚ùå Error: ${error.message}</div>`;
          console.error("Catalog test failed:", error);
        }
      }

      async function testVehicleSearch() {
        const resultsDiv = document.getElementById("vehicleResults");
        resultsDiv.innerHTML = "Loading...";

        try {
          // Test the search endpoint with multiple parameters
          const response = await fetch(
            `${API_URL}/api/vehicles?search=Toyota&page=1&pageSize=5`
          );

          if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
          }

          const data = await response.json();

          resultsDiv.innerHTML = `
                    <div class="success">‚úÖ Vehicle Search Fixed! Found ${
                      data.vehicles.length
                    } vehicles</div>
                    <div class="results">
                        ${data.vehicles
                          .slice(0, 2)
                          .map(
                            (v) => `
                            <div class="vehicle">
                                <strong>${v.title}</strong><br>
                                Price: $${v.price.toLocaleString()}<br>
                                Seller: ${v.sellerName} (${v.sellerCity})
                            </div>
                        `
                          )
                          .join("")}
                    </div>
                `;

          console.log("Vehicle search test passed:", data);
        } catch (error) {
          resultsDiv.innerHTML = `<div class="error">‚ùå Error: ${error.message}</div>`;
          console.error("Vehicle search test failed:", error);
        }
      }

      // Auto-test on load
      window.onload = function () {
        console.log("üß™ Running automatic tests...");
        setTimeout(() => testGlobalSearch(), 500);
        setTimeout(() => testCatalogMakes(), 1000);
        setTimeout(() => testVehicleSearch(), 1500);
      };
    </script>
  </body>
</html>
