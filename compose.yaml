# ============================================================================
# COMPOSE.YAML - SOLO MICROSERVICIOS REQUERIDOS POR FRONTEND
# ============================================================================
#
# Este archivo levanta SOLO los servicios necesarios para que el frontend
# funcione completamente:
#
# ğŸ”´ CRÃTICOS (4):
#   - AuthService (15001)
#   - VehiclesSaleService (15010)
#   - MediaService (15020)
#   - Gateway (18443)
#
# ğŸŸ  IMPORTANTES (6):
#   - UserService (15002)
#   - ContactService (15003)
#   - NotificationService (15005)
#   - AdminService (15007)
#   - ErrorService (5080) - Manejo centralizado de errores
#   - EventTrackingService (5050) - Analytics y tracking de eventos
#
# ğŸ”µ INFRAESTRUCTURA (4):
#   - PostgreSQL (5433)
#   - RabbitMQ (5672, 15672)
#   - Redis (6379)
#   - Consul (8500)
#
# ğŸ”® OBSERVABILIDAD - FASE 2 (2):
#   - Seq (5341) - Logs centralizados (Serilog compatible)
#   - Jaeger (16686, 4317) - Distributed tracing (OpenTelemetry)
#
# USAR:
#   docker-compose -f compose.frontend-only.yaml up -d
#
# UIs DE OBSERVABILIDAD:
#   - Seq UI: http://localhost:5341 (Logs)
#   - Jaeger UI: http://localhost:16686 (Tracing)
#   - RabbitMQ UI: http://localhost:15672 (MensajerÃ­a)
#   - Consul UI: http://localhost:8500 (Service Discovery)
#
# ============================================================================

services:
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # ğŸ”µ INFRAESTRUCTURA
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  # PostgreSQL - Base de datos consolidada
  postgres_db:
    image: postgres:16
    container_name: postgres_db
    command: >
      postgres
      -c max_connections=300
      -c shared_buffers=256MB
      -c effective_cache_size=512MB
      -c work_mem=4MB
      -c maintenance_work_mem=64MB
    deploy:
      resources:
        limits:
          cpus: "1.0"
          memory: 1024M
        reservations:
          memory: 512M
    environment:
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: "${POSTGRES_PASSWORD:-password}"
    ports:
      - "5433:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data
      - ./scripts/postgres-init.sh:/docker-entrypoint-initdb.d/postgres-init.sh
    networks:
      - okla-net
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U postgres"]
      interval: 10s
      timeout: 5s
      retries: 5

  # PgBouncer - Connection Pooler (reduces connection overhead to PostgreSQL)
  pgbouncer:
    image: edoburu/pgbouncer:1.22.0
    container_name: pgbouncer
    restart: unless-stopped
    deploy:
      resources:
        limits:
          cpus: "0.25"
          memory: 128M
        reservations:
          memory: 64M
    environment:
      DATABASE_URL: "postgres://postgres:${POSTGRES_PASSWORD:-password}@postgres_db:5432/postgres"
      POOL_MODE: transaction
      DEFAULT_POOL_SIZE: 20
      MIN_POOL_SIZE: 5
      MAX_CLIENT_CONN: 500
      MAX_DB_CONNECTIONS: 50
      RESERVE_POOL_SIZE: 5
      RESERVE_POOL_TIMEOUT: 3
      SERVER_IDLE_TIMEOUT: 600
      SERVER_LIFETIME: 3600
      LOG_CONNECTIONS: 0
      LOG_DISCONNECTIONS: 0
      LOG_POOLER_ERRORS: 1
      STATS_PERIOD: 60
      AUTH_TYPE: plain
    ports:
      - "6432:5432"
    networks:
      - okla-net
    depends_on:
      postgres_db:
        condition: service_healthy
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -p 5432 -U postgres"]
      interval: 10s
      timeout: 5s
      retries: 3

  # pg-backup - Automated PostgreSQL backups (daily, 7-day retention)
  pg-backup:
    image: prodrigestivill/postgres-backup-local:16
    container_name: pg-backup
    restart: unless-stopped
    deploy:
      resources:
        limits:
          cpus: "0.25"
          memory: 256M
        reservations:
          memory: 128M
    environment:
      POSTGRES_HOST: postgres_db
      POSTGRES_PORT: 5432
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: "${POSTGRES_PASSWORD:-password}"
      POSTGRES_DB: "authservice,vehiclessaleservice,billingservice,mediaservice,notificationservice,errorservice,contactservice,userservice,roleservice,adminservice"
      POSTGRES_EXTRA_OPTS: "--schema=public --blobs --format=custom --compress=6"
      SCHEDULE: "@daily"
      BACKUP_KEEP_DAYS: 7
      BACKUP_KEEP_WEEKS: 4
      BACKUP_KEEP_MONTHS: 3
      HEALTHCHECK_PORT: 8080
    volumes:
      - pg_backup_data:/backups
    networks:
      - okla-net
    depends_on:
      postgres_db:
        condition: service_healthy

  # RabbitMQ - Message broker
  rabbitmq:
    image: rabbitmq:3.12-management
    container_name: rabbitmq
    restart: unless-stopped
    deploy:
      resources:
        limits:
          cpus: "0.5"
          memory: 512M
        reservations:
          memory: 256M
    environment:
      RABBITMQ_DEFAULT_USER: guest
      RABBITMQ_DEFAULT_PASS: guest
      RABBITMQ_SERVER_ADDITIONAL_ERL_ARGS: "-rabbit consumer_timeout 1800000"
    ports:
      - "5672:5672" # AMQP
      - "15672:15672" # Management UI
    networks:
      - okla-net
    healthcheck:
      test: rabbitmq-diagnostics -q ping
      interval: 30s
      timeout: 10s
      retries: 5
    volumes:
      - rabbitmq_data:/var/lib/rabbitmq

  # Redis - CachÃ© distribuido
  redis:
    image: redis:7-alpine
    container_name: redis
    restart: unless-stopped
    command:
      [
        "redis-server",
        "--maxmemory",
        "256mb",
        "--maxmemory-policy",
        "allkeys-lru",
        "--save",
        "60",
        "1000",
      ]
    deploy:
      resources:
        limits:
          cpus: "0.5"
          memory: 512M
        reservations:
          memory: 256M
    ports:
      - "6379:6379"
    networks:
      - okla-net
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    volumes:
      - redis_data:/data

  # Consul - Service discovery
  consul:
    image: hashicorp/consul:1.17
    container_name: consul
    deploy:
      resources:
        limits:
          cpus: "0.5"
          memory: 256M
        reservations:
          memory: 128M
    ports:
      - "8500:8500" # HTTP API
      - "8600:8600/udp" # DNS
    command: agent -server -ui -node=server-1 -bootstrap-expect=1 -client=0.0.0.0
    environment:
      CONSUL_BIND_INTERFACE: eth0
    networks:
      - okla-net
    volumes:
      - consul_data:/consul/data
    healthcheck:
      test: ["CMD", "consul", "members"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s

  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # ï¿½ OBSERVABILIDAD (FASE 2)
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  # Seq - Centralized Logging UI (Serilog compatible)
  seq:
    image: datalust/seq:2024.1
    container_name: seq
    deploy:
      resources:
        limits:
          cpus: "0.5"
          memory: 512M
        reservations:
          memory: 256M
    environment:
      ACCEPT_EULA: "Y"
    ports:
      - "5341:80" # Web UI + Ingestion
      - "5342:5341" # API / Ingestion endpoint
    networks:
      - okla-net
    volumes:
      - seq_data:/data
    healthcheck:
      test:
        [
          "CMD-SHELL",
          "[ -f /data/Documents/metastore.flare ] && exit 0 || exit 1",
        ]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 30s

  # Jaeger - Distributed Tracing (OpenTelemetry compatible)
  jaeger:
    image: jaegertracing/all-in-one:1.53
    container_name: jaeger
    deploy:
      resources:
        limits:
          cpus: "0.5"
          memory: 512M
        reservations:
          memory: 256M
    environment:
      COLLECTOR_OTLP_ENABLED: "true"
    ports:
      - "16686:16686" # Web UI
      - "4317:4317" # OTLP gRPC receiver
      - "4318:4318" # OTLP HTTP receiver
      - "14268:14268" # Jaeger HTTP receiver
      - "14250:14250" # Jaeger gRPC receiver
    networks:
      - okla-net
    healthcheck:
      test: ["CMD", "wget", "-q", "-O", "/dev/null", "http://localhost:14269/"]
      interval: 30s
      timeout: 10s
      retries: 3

  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # ï¿½ğŸ”´ MICROSERVICIOS CRÃTICOS
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  # AuthService - Puerto 5001 (AutenticaciÃ³n JWT)
  authservice:
    build:
      context: ./backend
      dockerfile: AuthService/AuthService.Api/Dockerfile.dev
    deploy:
      resources:
        limits:
          cpus: "0.5"
          memory: 384M
        reservations:
          memory: 256M
    environment:
      ASPNETCORE_ENVIRONMENT: Development
      ASPNETCORE_URLS: http://+:80
      Database__Provider: "PostgreSQL"
      Database__ConnectionStrings__PostgreSQL: "Host=postgres_db;Port=5432;Database=authservice;Username=postgres;Password=password;Pooling=true;Minimum Pool Size=1;Maximum Pool Size=10"
      Database__AutoMigrate: "true"
      Jwt__Key: "${JWT__KEY:-clave-super-secreta-desarrollo-32-caracteres-aaa}"
      Jwt__Issuer: "AuthService-Dev"
      Jwt__Audience: "OKLA-Dev"
      RabbitMQ__Host: "rabbitmq"
      RabbitMQ__Port: "5672"
      RabbitMQ__UserName: "guest"
      RabbitMQ__Password: "guest"
      RabbitMQ__User: "guest"
      RabbitMQ__Enabled: "true"
      Redis__Host: "redis:6379"
      Consul__Host: "http://consul:8500"
      ConfigurationService__BaseUrl: "http://host.docker.internal:15124"
      # OAuth Providers - Use environment variables or docker secrets
      # See compose.secrets.example.yaml for production setup
      Authentication__Google__ClientId: "${GOOGLE_CLIENT_ID:-your-google-client-id}"
      Authentication__Google__ClientSecret: "${GOOGLE_CLIENT_SECRET:-your-google-client-secret}"
      FrontendUrl: "http://localhost:3000"
      # FASE 2: Observability
      Logging__Seq__ServerUrl: "http://seq:80"
      Observability__Otlp__Endpoint: "http://jaeger:4317"
      Observability__SamplingRatio: "1.0"
      Observability__Prometheus__Enabled: "true"
      ErrorHandling__PublishToErrorService: "true"
    ports:
      - "15001:80"
    depends_on:
      postgres_db:
        condition: service_healthy
      rabbitmq:
        condition: service_healthy
      redis:
        condition: service_healthy
      consul:
        condition: service_started
    networks:
      - okla-net
    volumes:
      - ./backend/AuthService:/app/AuthService
      - ./backend/_Shared/CarDealer.Contracts:/app/_Shared/CarDealer.Contracts
      - ./backend/_Shared/CarDealer.Shared:/app/_Shared/CarDealer.Shared
      - ./backend/_Shared/CarDealer.Shared.Logging:/app/_Shared/CarDealer.Shared.Logging
      - ./backend/_Shared/CarDealer.Shared.ErrorHandling:/app/_Shared/CarDealer.Shared.ErrorHandling
      - ./backend/_Shared/CarDealer.Shared.Observability:/app/_Shared/CarDealer.Shared.Observability
    healthcheck:
      test:
        [
          "CMD-SHELL",
          "wget -q -O /dev/null http://localhost:80/health || exit 1",
        ]
      interval: 30s
      timeout: 10s
      retries: 3

  # VehiclesSaleService - Puerto 5010 (CRUD vehÃ­culos)
  vehiclessaleservice:
    build:
      context: ./backend
      dockerfile: VehiclesSaleService/VehiclesSaleService.Api/Dockerfile.dev
    deploy:
      resources:
        limits:
          cpus: "0.5"
          memory: 512M
        reservations:
          memory: 384M
    environment:
      ASPNETCORE_ENVIRONMENT: Development
      ASPNETCORE_URLS: http://+:80
      Database__Provider: "PostgreSQL"
      Database__ConnectionStrings__PostgreSQL: "Host=postgres_db;Port=5432;Database=vehiclessaleservice;Username=postgres;Password=password;Pooling=true;Minimum Pool Size=1;Maximum Pool Size=10"
      Database__AutoMigrate: "true"
      Jwt__Key: "${JWT__KEY:-clave-super-secreta-desarrollo-32-caracteres-aaa}"
      Jwt__Issuer: "AuthService-Dev"
      RabbitMQ__Host: "rabbitmq"
      RabbitMQ__Port: "5672"
      RabbitMQ__User: "guest"
      RabbitMQ__Password: "guest"
      RabbitMQ__Enabled: "true"
      Redis__Host: "redis:6379"
      Consul__Host: "http://consul:8500"
      # FASE 2: Observability
      Logging__Seq__ServerUrl: "http://seq:80"
      Observability__Otlp__Endpoint: "http://jaeger:4317"
      Observability__SamplingRatio: "1.0"
      Observability__Prometheus__Enabled: "true"
      ErrorHandling__PublishToErrorService: "true"
      Services__ConfigurationService: "http://host.docker.internal:15124"
    ports:
      - "15010:80"
    depends_on:
      postgres_db:
        condition: service_healthy
      rabbitmq:
        condition: service_healthy
      redis:
        condition: service_healthy
      authservice:
        condition: service_healthy
      seq:
        condition: service_healthy
      jaeger:
        condition: service_healthy
    networks:
      - okla-net
    # Usar command para forzar rebuild dentro del contenedor
    command:
      [
        "dotnet",
        "watch",
        "run",
        "--project",
        "/app/VehiclesSaleService/VehiclesSaleService.Api/VehiclesSaleService.Api.csproj",
      ]
    volumes:
      - ./backend/VehiclesSaleService:/app/VehiclesSaleService
      - ./backend/_Shared/CarDealer.Contracts:/app/_Shared/CarDealer.Contracts
      - ./backend/_Shared/CarDealer.Shared:/app/_Shared/CarDealer.Shared
      - ./backend/_Shared/CarDealer.Shared.Logging:/app/_Shared/CarDealer.Shared.Logging
      - ./backend/_Shared/CarDealer.Shared.ErrorHandling:/app/_Shared/CarDealer.Shared.ErrorHandling
      - ./backend/_Shared/CarDealer.Shared.Observability:/app/_Shared/CarDealer.Shared.Observability
      # VolÃºmenes anÃ³nimos para excluir bin/obj de macOS
      - /app/VehiclesSaleService/VehiclesSaleService.Api/bin
      - /app/VehiclesSaleService/VehiclesSaleService.Api/obj
      - /app/VehiclesSaleService/VehiclesSaleService.Domain/bin
      - /app/VehiclesSaleService/VehiclesSaleService.Domain/obj
      - /app/VehiclesSaleService/VehiclesSaleService.Application/bin
      - /app/VehiclesSaleService/VehiclesSaleService.Application/obj
      - /app/VehiclesSaleService/VehiclesSaleService.Infrastructure/bin
      - /app/VehiclesSaleService/VehiclesSaleService.Infrastructure/obj
      - /app/VehiclesSaleService/VehiclesSaleService.Shared/bin
      - /app/VehiclesSaleService/VehiclesSaleService.Shared/obj
    healthcheck:
      test:
        [
          "CMD-SHELL",
          "wget -q -O /dev/null http://localhost:80/health || exit 1",
        ]
      interval: 30s
      timeout: 10s
      retries: 5
      start_period: 120s

  # MediaService - Puerto 5020 (GestiÃ³n de imÃ¡genes)
  mediaservice:
    build:
      context: ./backend
      dockerfile: MediaService/MediaService.Api/Dockerfile.dev
    deploy:
      resources:
        limits:
          cpus: "1.0"
          memory: 1024M
        reservations:
          memory: 512M
    environment:
      ASPNETCORE_ENVIRONMENT: Development
      ASPNETCORE_URLS: http://+:80
      Database__Provider: "PostgreSQL"
      Database__ConnectionStrings__PostgreSQL: "Host=postgres_db;Port=5432;Database=mediaservice;Username=postgres;Password=password;Pooling=true;Minimum Pool Size=1;Maximum Pool Size=10"
      Database__AutoMigrate: "true"
      Jwt__Key: "${JWT__KEY:-clave-super-secreta-desarrollo-32-caracteres-aaa}"
      Jwt__Issuer: "AuthService-Dev"
      RabbitMQ__Host: "rabbitmq"
      RabbitMQ__Port: "5672"
      RabbitMQ__Enabled: "true"
      RabbitMQ__UserName: "guest"
      RabbitMQ__Password: "guest"
      Redis__Host: "redis:6379"
      Consul__Host: "http://consul:8500"
      Consul__Enabled: "false"
      # Storage configuration - AWS S3 Enabled
      Storage__Provider: "s3"
      Storage__S3__AccessKey: "${AWS_ACCESS_KEY_ID:-AKIAQII4Y254AUECTCON}"
      Storage__S3__SecretKey: "${AWS_SECRET_ACCESS_KEY:-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}"
      Storage__S3__BucketName: "${AWS_S3_BUCKET:-okla-images-2026}"
      Storage__S3__Region: "${AWS_REGION:-us-east-2}"
      Storage__S3__CdnBaseUrl: ""
      Storage__S3__PreSignedUrlExpirationMinutes: "60"
      Storage__Local__BasePath: "/app/media-files"
      Storage__Local__BaseUrl: "http://localhost:15020/uploads"
      ServiceUrls__ErrorService: "http://errorservice:80"
      Services__ConfigurationService: "http://host.docker.internal:15124"
    ports:
      - "15020:80"
    depends_on:
      postgres_db:
        condition: service_healthy
      rabbitmq:
        condition: service_healthy
      redis:
        condition: service_healthy
      authservice:
        condition: service_healthy
    networks:
      - okla-net
    volumes:
      - ./backend/MediaService:/app/MediaService
      - ./backend/_Shared/CarDealer.Contracts:/app/_Shared/CarDealer.Contracts
      - ./backend/_Shared/CarDealer.Shared:/app/_Shared/CarDealer.Shared
    healthcheck:
      test:
        [
          "CMD-SHELL",
          "wget -q -O /dev/null http://localhost:80/health || exit 1",
        ]
      interval: 30s
      timeout: 10s
      retries: 3

  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # ğŸŸ  MICROSERVICIOS IMPORTANTES
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  # UserService - Puerto 5002 (GestiÃ³n de usuarios y perfiles)
  userservice:
    build:
      context: ./backend
      dockerfile: UserService/UserService.Api/Dockerfile.dev
    deploy:
      resources:
        limits:
          cpus: "1.0"
          memory: 1024M
        reservations:
          memory: 512M
    environment:
      ASPNETCORE_ENVIRONMENT: Development
      ASPNETCORE_URLS: http://+:80
      Database__Provider: "PostgreSQL"
      Database__ConnectionStrings__PostgreSQL: "Host=postgres_db;Port=5432;Database=userservice;Username=postgres;Password=password;Pooling=true;Minimum Pool Size=1;Maximum Pool Size=10"
      Database__AutoMigrate: "true"
      Jwt__Key: "${JWT__KEY:-clave-super-secreta-desarrollo-32-caracteres-aaa}"
      Jwt__Issuer: "AuthService-Dev"
      Jwt__Audience: "OKLA-Dev"
      RabbitMQ__Host: "rabbitmq"
      RabbitMQ__Port: "5672"
      RabbitMQ__User: "guest"
      RabbitMQ__Password: "guest"
      RabbitMQ__Enabled: "true"
      Redis__Host: "redis:6379"
      Consul__Host: "http://consul:8500"
      # FASE 2: Observability
      Logging__Seq__ServerUrl: "http://seq:80"
      Observability__Otlp__Endpoint: "http://jaeger:4317"
      Observability__SamplingRatio: "1.0"
      Observability__Prometheus__Enabled: "true"
      ErrorHandling__PublishToErrorService: "true"
    ports:
      - "15002:80"
    depends_on:
      postgres_db:
        condition: service_healthy
      rabbitmq:
        condition: service_healthy
      redis:
        condition: service_healthy
      seq:
        condition: service_healthy
      jaeger:
        condition: service_healthy
    networks:
      - okla-net
    volumes:
      - ./backend/UserService:/app/UserService
      - ./backend/_Shared/CarDealer.Contracts:/app/_Shared/CarDealer.Contracts
      - ./backend/_Shared/CarDealer.Shared:/app/_Shared/CarDealer.Shared
      - ./backend/_Shared/CarDealer.Shared.Logging:/app/_Shared/CarDealer.Shared.Logging
      - ./backend/_Shared/CarDealer.Shared.ErrorHandling:/app/_Shared/CarDealer.Shared.ErrorHandling
      - ./backend/_Shared/CarDealer.Shared.Observability:/app/_Shared/CarDealer.Shared.Observability
      - ./backend/ServiceDiscovery:/app/ServiceDiscovery
    healthcheck:
      test:
        [
          "CMD-SHELL",
          "wget -q -O /dev/null http://localhost:80/health || exit 1",
        ]
      interval: 30s
      timeout: 10s
      retries: 3

  # ContactService - Puerto 5003 (MensajerÃ­a entre usuarios)
  contactservice:
    build:
      context: ./backend
      dockerfile: ContactService/ContactService.Api/Dockerfile.dev
    deploy:
      resources:
        limits:
          cpus: "0.5"
          memory: 384M
        reservations:
          memory: 256M
    environment:
      ASPNETCORE_ENVIRONMENT: Development
      ASPNETCORE_URLS: http://+:80
      Database__Provider: "PostgreSQL"
      Database__ConnectionStrings__PostgreSQL: "Host=postgres_db;Port=5432;Database=contactservice;Username=postgres;Password=password;Pooling=true;Minimum Pool Size=1;Maximum Pool Size=10"
      ConnectionStrings__DefaultConnection: "Host=postgres_db;Port=5432;Database=contactservice;Username=postgres;Password=password;Pooling=true;Minimum Pool Size=1;Maximum Pool Size=10"
      Database__AutoMigrate: "true"
      Jwt__Key: "${JWT__KEY:-clave-super-secreta-desarrollo-32-caracteres-aaa}"
      Jwt__Issuer: "AuthService-Dev"
      Jwt__Audience: "OKLA-Dev"
      RabbitMQ__Host: "rabbitmq"
      RabbitMQ__Port: "5672"
      Redis__Host: "redis:6379"
      Consul__Host: "http://consul:8500"
    ports:
      - "15003:80"
    depends_on:
      postgres_db:
        condition: service_healthy
      rabbitmq:
        condition: service_healthy
      redis:
        condition: service_healthy
    networks:
      - okla-net
    # Sin volÃºmenes para usar cÃ³digo del build
    healthcheck:
      test:
        [
          "CMD-SHELL",
          "wget -q -O /dev/null http://localhost:80/health || exit 1",
        ]
      interval: 30s
      timeout: 10s
      retries: 5
      start_period: 60s

  # NotificationService - Puerto 5005 (Email/SMS/Push)
  notificationservice:
    build:
      context: ./backend
      dockerfile: NotificationService/NotificationService.Api/Dockerfile.dev
    deploy:
      resources:
        limits:
          cpus: "0.5"
          memory: 384M
        reservations:
          memory: 256M
    environment:
      ASPNETCORE_ENVIRONMENT: Development
      ASPNETCORE_URLS: http://+:80
      Database__Provider: "PostgreSQL"
      Database__ConnectionStrings__PostgreSQL: "Host=postgres_db;Port=5432;Database=notificationservice;Username=postgres;Password=password;Pooling=true;Minimum Pool Size=1;Maximum Pool Size=10"
      Database__AutoMigrate: "true"
      Jwt__Key: "${JWT__KEY:-clave-super-secreta-desarrollo-32-caracteres-aaa}"
      Jwt__Issuer: "AuthService-Dev"
      Jwt__Audience: "OKLA-Dev"
      RabbitMQ__Host: "rabbitmq"
      RabbitMQ__Port: "5672"
      Redis__Host: "redis:6379"
      Consul__Host: "http://consul:8500"
    ports:
      - "15005:80"
    depends_on:
      postgres_db:
        condition: service_healthy
      rabbitmq:
        condition: service_healthy
      redis:
        condition: service_healthy
    networks:
      - okla-net
    volumes:
      - ./backend/NotificationService:/app/NotificationService
      - ./backend/_Shared/CarDealer.Contracts:/app/_Shared/CarDealer.Contracts
      - ./backend/_Shared/CarDealer.Shared:/app/_Shared/CarDealer.Shared
    healthcheck:
      test:
        [
          "CMD-SHELL",
          "wget -q -O /dev/null http://localhost:80/health || exit 1",
        ]
      interval: 30s
      timeout: 10s
      retries: 3

  # AdminService - Puerto 5007 (Panel de administraciÃ³n)
  adminservice:
    build:
      context: ./backend
      dockerfile: AdminService/AdminService.Api/Dockerfile.dev
    restart: unless-stopped
    deploy:
      resources:
        limits:
          cpus: "0.5"
          memory: 384M
        reservations:
          memory: 256M
    environment:
      ASPNETCORE_ENVIRONMENT: Development
      ASPNETCORE_URLS: http://+:80
      Database__Provider: "PostgreSQL"
      Database__ConnectionStrings__PostgreSQL: "Host=postgres_db;Port=5432;Database=adminservice;Username=postgres;Password=password;Pooling=true;Minimum Pool Size=1;Maximum Pool Size=10"
      Database__AutoMigrate: "true"
      Jwt__Key: "${JWT__KEY:-clave-super-secreta-desarrollo-32-caracteres-aaa}"
      Jwt__Issuer: "AuthService-Dev"
      Jwt__Audience: "OKLA-Dev"
      RabbitMQ__Host: "rabbitmq"
      RabbitMQ__Port: "5672"
      Redis__Host: "redis:6379"
      Consul__Host: "http://consul:8500"
      ServiceUrls__DealerManagementService: "http://dealermanagementservice:80"
    ports:
      - "15007:80"
    depends_on:
      postgres_db:
        condition: service_healthy
      rabbitmq:
        condition: service_healthy
      redis:
        condition: service_healthy
    networks:
      - okla-net
    volumes:
      - ./backend/AdminService:/app/AdminService
      - ./backend/_Shared/CarDealer.Contracts:/app/_Shared/CarDealer.Contracts
      - ./backend/_Shared/CarDealer.Shared:/app/_Shared/CarDealer.Shared
    healthcheck:
      test:
        [
          "CMD-SHELL",
          "wget -q -O /dev/null http://localhost:80/health || exit 1",
        ]
      interval: 30s
      timeout: 10s
      retries: 3

  # StaffService - Puerto 15200 (GestiÃ³n de empleados/staff)
  staffservice:
    build:
      context: ./backend
      dockerfile: StaffService/Dockerfile
    restart: unless-stopped
    deploy:
      resources:
        limits:
          cpus: "0.5"
          memory: 384M
        reservations:
          memory: 256M
    environment:
      ASPNETCORE_ENVIRONMENT: Development
      ASPNETCORE_URLS: http://+:80
      Database__Provider: "PostgreSQL"
      Database__ConnectionStrings__PostgreSQL: "Host=postgres_db;Port=5432;Database=staffservice;Username=postgres;Password=password;Pooling=true;Minimum Pool Size=1;Maximum Pool Size=10"
      Database__AutoMigrate: "true"
      Jwt__Key: "${JWT__KEY:-clave-super-secreta-desarrollo-32-caracteres-aaa}"
      Jwt__Issuer: "AuthService-Dev"
      Jwt__Audience: "OKLA-Dev"
      ServiceUrls__AuthService: "http://authservice:80"
      ServiceUrls__NotificationService: "http://notificationservice:80"
      ServiceUrls__AuditService: "http://auditservice:80"
      RabbitMQ__Host: "rabbitmq"
      RabbitMQ__Port: "5672"
      Redis__Host: "redis:6379"
      Consul__Host: "http://consul:8500"
    ports:
      - "15200:80"
    depends_on:
      postgres_db:
        condition: service_healthy
      rabbitmq:
        condition: service_healthy
      redis:
        condition: service_healthy
    networks:
      - okla-net
    volumes:
      - ./backend/StaffService:/app/StaffService
      - ./backend/_Shared/CarDealer.Contracts:/app/_Shared/CarDealer.Contracts
      - ./backend/_Shared/CarDealer.Shared:/app/_Shared/CarDealer.Shared
    healthcheck:
      test:
        [
          "CMD-SHELL",
          "wget -q -O /dev/null http://localhost:80/health || exit 1",
        ]
      interval: 30s
      timeout: 10s
      retries: 3

  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # ğŸ” SERVICIOS ADICIONALES PARA FRONTEND
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  # ErrorService - Puerto 5080 (Manejo centralizado de errores)
  errorservice:
    image: ${DOCKER_REGISTRY-}errorservice:latest
    build:
      context: ./backend
      dockerfile: ErrorService/Dockerfile
    restart: on-failure:3
    deploy:
      resources:
        limits:
          cpus: "0.5"
          memory: 384M
        reservations:
          memory: 256M
    environment:
      ASPNETCORE_ENVIRONMENT: Docker
      ASPNETCORE_URLS: http://+:80
      Database__Provider: "PostgreSQL"
      Database__ConnectionStrings__PostgreSQL: "Host=postgres_db;Port=5432;Database=errorservice;Username=postgres;Password=password;Pooling=true;Minimum Pool Size=1;Maximum Pool Size=10"
      Database__AutoMigrate: "true"
      Jwt__Key: "${JWT__KEY:-clave-super-secreta-desarrollo-32-caracteres-aaa}"
      Jwt__Issuer: "AuthService-Dev"
      Jwt__Audience: "OKLA-Dev"
      RabbitMQ__Host: "rabbitmq"
      RabbitMQ__Port: "5672"
      RabbitMQ__User: "guest"
      RabbitMQ__Password: "guest"
      RabbitMQ__Enabled: "false"
      Redis__Host: "redis:6379"
      Consul__Host: "http://consul:8500"
      # Observability
      Logging__Seq__ServerUrl: "http://seq:80"
      Observability__Otlp__Endpoint: "http://jaeger:4317"
      Observability__SamplingRatio: "1.0"
    ports:
      - "5080:80"
    depends_on:
      postgres_db:
        condition: service_healthy
      redis:
        condition: service_healthy
      seq:
        condition: service_healthy
      jaeger:
        condition: service_healthy
    networks:
      - okla-net
    healthcheck:
      test:
        [
          "CMD-SHELL",
          "wget -q -O /dev/null http://localhost:80/health || exit 1",
        ]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

  # EventTrackingService - Puerto 5050 (Analytics y tracking de eventos)
  eventtrackingservice:
    build:
      context: ./backend
      dockerfile: EventTrackingService/EventTrackingService.Api/Dockerfile.dev
    restart: on-failure:3
    deploy:
      resources:
        limits:
          cpus: "0.5"
          memory: 384M
        reservations:
          memory: 256M
    environment:
      ASPNETCORE_ENVIRONMENT: Development
      ASPNETCORE_URLS: http://+:80
      Database__Provider: "PostgreSQL"
      Database__ConnectionStrings__PostgreSQL: "Host=postgres_db;Port=5432;Database=eventtrackingservice;Username=postgres;Password=password;Pooling=true;Minimum Pool Size=1;Maximum Pool Size=10"
      Database__AutoMigrate: "true"
      Jwt__Key: "${JWT__KEY:-clave-super-secreta-desarrollo-32-caracteres-aaa}"
      Jwt__Issuer: "AuthService-Dev"
      Jwt__Audience: "OKLA-Dev"
      RabbitMQ__Host: "rabbitmq"
      RabbitMQ__Port: "5672"
      RabbitMQ__User: "guest"
      RabbitMQ__Password: "guest"
      RabbitMQ__Enabled: "true"
      Redis__Host: "redis:6379"
      Consul__Host: "http://consul:8500"
      # Observability
      Logging__Seq__ServerUrl: "http://seq:80"
      Observability__Otlp__Endpoint: "http://jaeger:4317"
      Observability__SamplingRatio: "1.0"
      ErrorHandling__PublishToErrorService: "true"
    ports:
      - "5050:80"
    depends_on:
      postgres_db:
        condition: service_healthy
      rabbitmq:
        condition: service_healthy
      redis:
        condition: service_healthy
      seq:
        condition: service_healthy
      jaeger:
        condition: service_healthy
      errorservice:
        condition: service_healthy
    networks:
      - okla-net
    volumes:
      - ./backend/EventTrackingService:/app/EventTrackingService
      - ./backend/_Shared/CarDealer.Contracts:/app/_Shared/CarDealer.Contracts
      - ./backend/_Shared/CarDealer.Shared:/app/_Shared/CarDealer.Shared
    healthcheck:
      test:
        [
          "CMD-SHELL",
          "wget -q -O /dev/null http://localhost:80/health || exit 1",
        ]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

  # RoleService - Puerto 15101 (Roles y Permisos)
  roleservice:
    build:
      context: ./backend
      dockerfile: RoleService/RoleService.Api/Dockerfile.dev
    deploy:
      resources:
        limits:
          cpus: "1.0"
          memory: 1024M
        reservations:
          memory: 512M
    environment:
      ASPNETCORE_ENVIRONMENT: Development
      ASPNETCORE_URLS: http://+:80
      Database__Provider: "PostgreSQL"
      Database__ConnectionStrings__PostgreSQL: "Host=postgres_db;Port=5432;Database=roleservice;Username=postgres;Password=password;Pooling=true;Minimum Pool Size=1;Maximum Pool Size=10"
      Database__AutoMigrate: "true"
      Jwt__Key: "${JWT__KEY:-clave-super-secreta-desarrollo-32-caracteres-aaa}"
      Jwt__Issuer: "AuthService-Dev"
      Jwt__Audience: "OKLA-Dev"
      RabbitMQ__Host: "rabbitmq"
      RabbitMQ__Port: "5672"
      Redis__Host: "redis:6379"
    ports:
      - "15101:80"
    depends_on:
      postgres_db:
        condition: service_healthy
      rabbitmq:
        condition: service_healthy
    networks:
      - okla-net
    volumes:
      - ./backend/RoleService:/app/RoleService
      - ./backend/_Shared/CarDealer.Contracts:/app/_Shared/CarDealer.Contracts
      - ./backend/_Shared/CarDealer.Shared:/app/_Shared/CarDealer.Shared
    healthcheck:
      test:
        [
          "CMD-SHELL",
          "wget -q -O /dev/null http://localhost:80/health || exit 1",
        ]
      interval: 30s
      timeout: 10s
      retries: 3

  # BillingService - Puerto 15107 (FacturaciÃ³n y Pagos)
  billingservice:
    build:
      context: ./backend
      dockerfile: BillingService/BillingService.Api/Dockerfile.dev
    deploy:
      resources:
        limits:
          cpus: "0.5"
          memory: 384M
        reservations:
          memory: 256M
    environment:
      ASPNETCORE_ENVIRONMENT: Development
      ASPNETCORE_URLS: http://+:80
      Database__Provider: "PostgreSQL"
      Database__ConnectionStrings__PostgreSQL: "Host=postgres_db;Port=5432;Database=billingservice;Username=postgres;Password=password;Pooling=true;Minimum Pool Size=1;Maximum Pool Size=10"
      Database__AutoMigrate: "true"
      DATABASE_HOST: "postgres_db"
      DATABASE_PORT: "5432"
      DATABASE_NAME: "billingservice"
      DATABASE_USER: "postgres"
      DATABASE_PASSWORD: "password"
      ConnectionStrings__DefaultConnection: "Host=postgres_db;Port=5432;Database=billingservice;Username=postgres;Password=password;Pooling=true;Minimum Pool Size=1;Maximum Pool Size=10"
      Jwt__Key: "${JWT__KEY:-clave-super-secreta-desarrollo-32-caracteres-aaa}"
      Jwt__Issuer: "AuthService-Dev"
      Jwt__Audience: "OKLA-Dev"
      RabbitMQ__Host: "rabbitmq"
      RabbitMQ__Port: "5672"
      RabbitMQ__User: "guest"
      RabbitMQ__Password: "guest"
      RabbitMQ__Enabled: "true"
      Redis__Host: "redis:6379"
      Redis__Connection: "redis:6379"
      Idempotency__Enabled: "true"
      Idempotency__DefaultTtlSeconds: "86400"
      Idempotency__ProcessingTimeoutSeconds: "120"
      Stripe__ApiKey: "${STRIPE_API_KEY:-sk_test_placeholder}"
      Stripe__WebhookSecret: "${STRIPE_WEBHOOK_SECRET:-whsec_placeholder}"
      # FASE 2: Observability
      Logging__Seq__ServerUrl: "http://seq:80"
      Observability__Otlp__Endpoint: "http://jaeger:4317"
      Observability__SamplingRatio: "1.0"
      Observability__Prometheus__Enabled: "true"
      ErrorHandling__PublishToErrorService: "true"
    ports:
      - "15107:80"
    depends_on:
      postgres_db:
        condition: service_healthy
      rabbitmq:
        condition: service_healthy
      redis:
        condition: service_healthy
      seq:
        condition: service_healthy
      jaeger:
        condition: service_healthy
    networks:
      - okla-net
    volumes:
      - ./backend/BillingService:/app/BillingService
      - ./backend/_Shared/CarDealer.Contracts:/app/_Shared/CarDealer.Contracts
      - ./backend/_Shared/CarDealer.Shared:/app/_Shared/CarDealer.Shared
      - ./backend/_Shared/CarDealer.Shared.Logging:/app/_Shared/CarDealer.Shared.Logging
      - ./backend/_Shared/CarDealer.Shared.ErrorHandling:/app/_Shared/CarDealer.Shared.ErrorHandling
      - ./backend/_Shared/CarDealer.Shared.Observability:/app/_Shared/CarDealer.Shared.Observability
    healthcheck:
      test:
        [
          "CMD-SHELL",
          "wget -q -O /dev/null http://localhost:80/health || exit 1",
        ]
      interval: 30s
      timeout: 10s
      retries: 3

  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # ğŸ¬ SERVICIOS DE PROCESAMIENTO 360
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  # BackgroundRemovalService - Puerto 15061 (RemociÃ³n de fondos con IA)
  backgroundremovalservice:
    build:
      context: ./backend
      dockerfile: BackgroundRemovalService/BackgroundRemovalService.Api/Dockerfile.dev
    deploy:
      resources:
        limits:
          cpus: "2.0"
          memory: 2048M
        reservations:
          memory: 1024M
    environment:
      ASPNETCORE_ENVIRONMENT: Development
      ASPNETCORE_URLS: http://+:80
      Database__Provider: "PostgreSQL"
      Database__ConnectionStrings__PostgreSQL: "Host=postgres_db;Port=5432;Database=backgroundremovalservice;Username=postgres;Password=password;Pooling=true;Minimum Pool Size=1;Maximum Pool Size=10"
      Database__AutoMigrate: "true"
      Jwt__Key: "${JWT__KEY:-clave-super-secreta-desarrollo-32-caracteres-aaa}"
      Jwt__Issuer: "AuthService-Dev"
      Jwt__Audience: "OKLA-Dev"
      RabbitMQ__Host: "rabbitmq"
      RabbitMQ__Port: "5672"
      Redis__Host: "redis:6379"
      # ConfiguraciÃ³n de proveedores de remociÃ³n de fondos
      BackgroundRemoval__DefaultProvider: "local"
      BackgroundRemoval__RemoveBg__ApiKey: "${REMOVEBG_API_KEY:-}"
      BackgroundRemoval__Photoroom__ApiKey: "${PHOTOROOM_API_KEY:-}"
    ports:
      - "15061:80"
    depends_on:
      postgres_db:
        condition: service_healthy
      rabbitmq:
        condition: service_healthy
      redis:
        condition: service_healthy
    networks:
      - okla-net
    volumes:
      - ./backend/BackgroundRemovalService:/app/BackgroundRemovalService
      - ./backend/_Shared/CarDealer.Contracts:/app/_Shared/CarDealer.Contracts
      - ./backend/_Shared/CarDealer.Shared:/app/_Shared/CarDealer.Shared
    healthcheck:
      test:
        [
          "CMD-SHELL",
          "wget -q -O /dev/null http://localhost:80/health || exit 1",
        ]
      interval: 30s
      timeout: 10s
      retries: 3

  # Vehicle360ProcessingService - Puerto 15062 (Orquestador de procesamiento 360)
  vehicle360processingservice:
    build:
      context: ./backend
      dockerfile: Vehicle360ProcessingService/Vehicle360ProcessingService.Api/Dockerfile.dev
    deploy:
      resources:
        limits:
          cpus: "1.0"
          memory: 512M
        reservations:
          memory: 256M
    environment:
      ASPNETCORE_ENVIRONMENT: Development
      ASPNETCORE_URLS: http://+:80
      Database__Provider: "PostgreSQL"
      Database__ConnectionStrings__PostgreSQL: "Host=postgres_db;Port=5432;Database=vehicle360processingservice;Username=postgres;Password=password;Pooling=true;Minimum Pool Size=1;Maximum Pool Size=10"
      Database__AutoMigrate: "true"
      Jwt__Key: "${JWT__KEY:-clave-super-secreta-desarrollo-32-caracteres-aaa}"
      Jwt__Issuer: "AuthService-Dev"
      Jwt__Audience: "OKLA-Dev"
      RabbitMQ__Host: "rabbitmq"
      RabbitMQ__Port: "5672"
      Redis__Host: "redis:6379"
      # URLs de servicios downstream
      ServiceUrls__MediaService: "http://mediaservice:80"
      ServiceUrls__BackgroundRemovalService: "http://backgroundremovalservice:80"
      # ConfiguraciÃ³n de resiliencia (Polly)
      Resilience__RetryCount: "3"
      Resilience__CircuitBreakerThreshold: "5"
      Resilience__CircuitBreakerDurationSeconds: "30"
    ports:
      - "15062:80"
    depends_on:
      postgres_db:
        condition: service_healthy
      rabbitmq:
        condition: service_healthy
      redis:
        condition: service_healthy
      mediaservice:
        condition: service_healthy
      backgroundremovalservice:
        condition: service_healthy
    networks:
      - okla-net
    volumes:
      - ./backend/Vehicle360ProcessingService:/app/Vehicle360ProcessingService
    healthcheck:
      test:
        [
          "CMD-SHELL",
          "wget -q -O /dev/null http://localhost:80/health || exit 1",
        ]
      interval: 30s
      timeout: 10s
      retries: 3

  # DealerManagementService - Puerto 15039 (GestiÃ³n de Dealers)
  dealermanagementservice:
    build:
      context: ./backend
      dockerfile: DealerManagementService/DealerManagementService.Api/Dockerfile.dev
    deploy:
      resources:
        limits:
          cpus: "0.5"
          memory: 768M
        reservations:
          memory: 384M
    environment:
      ASPNETCORE_ENVIRONMENT: Development
      ASPNETCORE_URLS: http://+:80
      Database__Provider: "PostgreSQL"
      Database__ConnectionStrings__PostgreSQL: "Host=postgres_db;Port=5432;Database=dealermanagementservice;Username=postgres;Password=password;Pooling=true;Minimum Pool Size=1;Maximum Pool Size=10"
      Database__AutoMigrate: "true"
      DATABASE_HOST: "postgres_db"
      DATABASE_PORT: "5432"
      DATABASE_NAME: "dealermanagementservice"
      DATABASE_USER: "postgres"
      DATABASE_PASSWORD: "password"
      ConnectionStrings__DefaultConnection: "Host=postgres_db;Port=5432;Database=dealermanagementservice;Username=postgres;Password=password;Pooling=true;Minimum Pool Size=1;Maximum Pool Size=10"
      Jwt__Key: "${JWT__KEY:-clave-super-secreta-desarrollo-32-caracteres-aaa}"
      Jwt__Issuer: "AuthService-Dev"
      Jwt__Audience: "OKLA-Dev"
      RabbitMQ__Host: "rabbitmq"
      RabbitMQ__Port: "5672"
      Redis__Host: "redis:6379"
    ports:
      - "15039:80"
    depends_on:
      postgres_db:
        condition: service_healthy
      rabbitmq:
        condition: service_healthy
    networks:
      - okla-net
    volumes:
      - ./backend/DealerManagementService:/app/DealerManagementService
      - ./backend/_Shared/CarDealer.Contracts:/app/_Shared/CarDealer.Contracts
      - ./backend/_Shared/CarDealer.Shared:/app/_Shared/CarDealer.Shared
    healthcheck:
      test:
        [
          "CMD-SHELL",
          "wget -q -O /dev/null http://localhost:80/health || exit 1",
        ]
      interval: 30s
      timeout: 10s
      retries: 3

  # DealerAnalyticsService - Puerto 15041 (AnalÃ­ticas de Dealers)
  dealeranalyticsservice:
    build:
      context: ./backend
      dockerfile: DealerAnalyticsService/DealerAnalyticsService.Api/Dockerfile.dev
    deploy:
      resources:
        limits:
          cpus: "0.5"
          memory: 768M
        reservations:
          memory: 384M
    environment:
      ASPNETCORE_ENVIRONMENT: Development
      ASPNETCORE_URLS: http://+:80
      Database__Provider: "PostgreSQL"
      Database__ConnectionStrings__PostgreSQL: "Host=postgres_db;Port=5432;Database=dealeranalyticsservice;Username=postgres;Password=password;Pooling=true;Minimum Pool Size=1;Maximum Pool Size=10"
      Database__AutoMigrate: "true"
      Jwt__Key: "${JWT__KEY:-clave-super-secreta-desarrollo-32-caracteres-aaa}"
      Jwt__Issuer: "AuthService-Dev"
      Jwt__Audience: "OKLA-Dev"
      RabbitMQ__Host: "rabbitmq"
      RabbitMQ__Port: "5672"
      Redis__Host: "redis:6379"
    ports:
      - "15041:80"
    depends_on:
      postgres_db:
        condition: service_healthy
      rabbitmq:
        condition: service_healthy
    networks:
      - okla-net
    volumes:
      - ./backend/DealerAnalyticsService:/app/DealerAnalyticsService
      - ./backend/_Shared/CarDealer.Contracts:/app/_Shared/CarDealer.Contracts
      - ./backend/_Shared/CarDealer.Shared:/app/_Shared/CarDealer.Shared
    healthcheck:
      test:
        [
          "CMD-SHELL",
          "wget -q -O /dev/null http://localhost:80/health || exit 1",
        ]
      interval: 30s
      timeout: 10s
      retries: 3

  # CRMService - Puerto 15106 (CRM y Leads)
  crmservice:
    build:
      context: ./backend
      dockerfile: CRMService/CRMService.Api/Dockerfile.dev
    deploy:
      resources:
        limits:
          cpus: "0.5"
          memory: 384M
        reservations:
          memory: 256M
    environment:
      ASPNETCORE_ENVIRONMENT: Development
      ASPNETCORE_URLS: http://+:80
      Database__Provider: "PostgreSQL"
      Database__ConnectionStrings__PostgreSQL: "Host=postgres_db;Port=5432;Database=crmservice;Username=postgres;Password=password;Pooling=true;Minimum Pool Size=1;Maximum Pool Size=10"
      Database__AutoMigrate: "true"
      Jwt__Key: "${JWT__KEY:-clave-super-secreta-desarrollo-32-caracteres-aaa}"
      Jwt__Issuer: "AuthService-Dev"
      Jwt__Audience: "OKLA-Dev"
      RabbitMQ__Host: "rabbitmq"
      RabbitMQ__Port: "5672"
      Redis__Host: "redis:6379"
    ports:
      - "15106:80"
    depends_on:
      postgres_db:
        condition: service_healthy
      rabbitmq:
        condition: service_healthy
    networks:
      - okla-net
    volumes:
      - ./backend/CRMService:/app/CRMService
      - ./backend/_Shared/CarDealer.Contracts:/app/_Shared/CarDealer.Contracts
      - ./backend/_Shared/CarDealer.Shared:/app/_Shared/CarDealer.Shared
    healthcheck:
      test:
        [
          "CMD-SHELL",
          "wget -q -O /dev/null http://localhost:80/health || exit 1",
        ]
      interval: 30s
      timeout: 10s
      retries: 3

  # SearchService - Puerto 15093 (BÃºsqueda)
  alertservice:
    build:
      context: ./backend
      dockerfile: AlertService/AlertService.Api/Dockerfile.dev
    deploy:
      resources:
        limits:
          cpus: "0.5"
          memory: 384M
        reservations:
          memory: 256M
    environment:
      ASPNETCORE_ENVIRONMENT: Development
      ASPNETCORE_URLS: http://+:80
      Database__Provider: "PostgreSQL"
      Database__ConnectionStrings__PostgreSQL: "Host=postgres_db;Port=5432;Database=alertservice;Username=postgres;Password=password;Pooling=true;Minimum Pool Size=1;Maximum Pool Size=10"
      Database__AutoMigrate: "true"
      DATABASE_HOST: "postgres_db"
      DATABASE_PORT: "5432"
      DATABASE_NAME: "alertservice"
      DATABASE_USER: "postgres"
      DATABASE_PASSWORD: "password"
      ConnectionStrings__DefaultConnection: "Host=postgres_db;Port=5432;Database=alertservice;Username=postgres;Password=password;Pooling=true;Minimum Pool Size=1;Maximum Pool Size=10"
      Jwt__Key: "${JWT__KEY:-clave-super-secreta-desarrollo-32-caracteres-aaa}"
      Jwt__Issuer: "AuthService-Dev"
      Jwt__Audience: "OKLA-Dev"
      RabbitMQ__Host: "rabbitmq"
      RabbitMQ__Port: "5672"
      Redis__Host: "redis:6379"
    ports:
      - "5067:80"
    depends_on:
      postgres_db:
        condition: service_healthy
      rabbitmq:
        condition: service_healthy
    networks:
      - okla-net
    volumes:
      - ./backend/AlertService:/app/AlertService
      - ./backend/_Shared/CarDealer.Contracts:/app/_Shared/CarDealer.Contracts
      - ./backend/_Shared/CarDealer.Shared:/app/_Shared/CarDealer.Shared
    healthcheck:
      test:
        [
          "CMD-SHELL",
          "wget -q -O /dev/null http://localhost:80/health || exit 1",
        ]
      interval: 30s
      timeout: 10s
      retries: 3

  # MaintenanceService - Puerto 5061 (Mantenimiento del Sistema)
  maintenanceservice:
    build:
      context: ./backend
      dockerfile: MaintenanceService/MaintenanceService.Api/Dockerfile.dev
    deploy:
      resources:
        limits:
          cpus: "0.5"
          memory: 384M
        reservations:
          memory: 256M
    environment:
      ASPNETCORE_ENVIRONMENT: Development
      ASPNETCORE_URLS: http://+:80
      Database__Provider: "PostgreSQL"
      Database__ConnectionStrings__PostgreSQL: "Host=postgres_db;Port=5432;Database=maintenanceservice;Username=postgres;Password=password;Pooling=true;Minimum Pool Size=1;Maximum Pool Size=10"
      Database__AutoMigrate: "true"
      DATABASE_HOST: "postgres_db"
      DATABASE_PORT: "5432"
      DATABASE_NAME: "maintenanceservice"
      DATABASE_USER: "postgres"
      DATABASE_PASSWORD: "password"
      ConnectionStrings__DefaultConnection: "Host=postgres_db;Port=5432;Database=maintenanceservice;Username=postgres;Password=password;Pooling=true;Minimum Pool Size=1;Maximum Pool Size=10"
      Jwt__Key: "${JWT__KEY:-clave-super-secreta-desarrollo-32-caracteres-aaa}"
      Jwt__Issuer: "AuthService-Dev"
      Jwt__Audience: "OKLA-Dev"
      RabbitMQ__Host: "rabbitmq"
      RabbitMQ__Port: "5672"
      Redis__Host: "redis:6379"
    ports:
      - "5061:80"
    depends_on:
      postgres_db:
        condition: service_healthy
      rabbitmq:
        condition: service_healthy
    networks:
      - okla-net
    volumes:
      - ./backend/MaintenanceService:/app/MaintenanceService
      - ./backend/_Shared/CarDealer.Contracts:/app/_Shared/CarDealer.Contracts
      - ./backend/_Shared/CarDealer.Shared:/app/_Shared/CarDealer.Shared
    healthcheck:
      test:
        [
          "CMD-SHELL",
          "wget -q -O /dev/null http://localhost:80/health || exit 1",
        ]
      interval: 30s
      timeout: 10s
      retries: 3

  # ComparisonService - Puerto 5066 (ComparaciÃ³n de VehÃ­culos)
  comparisonservice:
    build:
      context: ./backend
      dockerfile: ComparisonService/ComparisonService.Api/Dockerfile.dev
    deploy:
      resources:
        limits:
          cpus: "0.5"
          memory: 384M
        reservations:
          memory: 256M
    environment:
      ASPNETCORE_ENVIRONMENT: Development
      ASPNETCORE_URLS: http://+:80
      Database__Provider: "PostgreSQL"
      Database__ConnectionStrings__PostgreSQL: "Host=postgres_db;Port=5432;Database=comparisonservice;Username=postgres;Password=password;Pooling=true;Minimum Pool Size=1;Maximum Pool Size=10"
      Database__AutoMigrate: "true"
      DATABASE_HOST: "postgres_db"
      DATABASE_PORT: "5432"
      DATABASE_NAME: "comparisonservice"
      DATABASE_USER: "postgres"
      DATABASE_PASSWORD: "password"
      ConnectionStrings__DefaultConnection: "Host=postgres_db;Port=5432;Database=comparisonservice;Username=postgres;Password=password;Pooling=true;Minimum Pool Size=1;Maximum Pool Size=10"
      Jwt__Key: "${JWT__KEY:-clave-super-secreta-desarrollo-32-caracteres-aaa}"
      Jwt__Issuer: "AuthService-Dev"
      Jwt__Audience: "OKLA-Dev"
      RabbitMQ__Host: "rabbitmq"
      RabbitMQ__Port: "5672"
      Redis__Host: "redis:6379"
    ports:
      - "5066:80"
    depends_on:
      postgres_db:
        condition: service_healthy
      rabbitmq:
        condition: service_healthy
    networks:
      - okla-net
    volumes:
      - ./backend/ComparisonService:/app/ComparisonService
      - ./backend/_Shared/CarDealer.Contracts:/app/_Shared/CarDealer.Contracts
      - ./backend/_Shared/CarDealer.Shared:/app/_Shared/CarDealer.Shared
    healthcheck:
      test:
        [
          "CMD-SHELL",
          "wget -q -O /dev/null http://localhost:80/health || exit 1",
        ]
      interval: 30s
      timeout: 10s
      retries: 3

  # ReviewService - Puerto 5059 (ReseÃ±as)
  reviewservice:
    build:
      context: ./backend
      dockerfile: ReviewService/ReviewService.Api/Dockerfile.dev
    deploy:
      resources:
        limits:
          cpus: "0.5"
          memory: 384M
        reservations:
          memory: 256M
    environment:
      ASPNETCORE_ENVIRONMENT: Development
      ASPNETCORE_URLS: http://+:80
      Kestrel__Endpoints__Http__Url: "http://+:80"
      Database__Provider: "PostgreSQL"
      Database__ConnectionStrings__PostgreSQL: "Host=postgres_db;Port=5432;Database=reviewservice;Username=postgres;Password=password;Pooling=true;Minimum Pool Size=1;Maximum Pool Size=10"
      Database__AutoMigrate: "true"
      DATABASE_HOST: "postgres_db"
      DATABASE_PORT: "5432"
      DATABASE_NAME: "reviewservice"
      DATABASE_USER: "postgres"
      DATABASE_PASSWORD: "password"
      ConnectionStrings__DefaultConnection: "Host=postgres_db;Port=5432;Database=reviewservice;Username=postgres;Password=password;Pooling=true;Minimum Pool Size=1;Maximum Pool Size=10"
      Jwt__Key: "${JWT__KEY:-clave-super-secreta-desarrollo-32-caracteres-aaa}"
      Jwt__Issuer: "AuthService-Dev"
      Jwt__Audience: "OKLA-Dev"
      RabbitMQ__Host: "rabbitmq"
      RabbitMQ__Port: "5672"
      Redis__Host: "redis:6379"
    ports:
      - "5059:80"
    depends_on:
      postgres_db:
        condition: service_healthy
      rabbitmq:
        condition: service_healthy
    networks:
      - okla-net
    volumes:
      - ./backend/ReviewService:/app/ReviewService
      - ./backend/_Shared/CarDealer.Contracts:/app/_Shared/CarDealer.Contracts
      - ./backend/_Shared/CarDealer.Shared:/app/_Shared/CarDealer.Shared
    healthcheck:
      test:
        [
          "CMD-SHELL",
          "wget -q -O /dev/null http://localhost:80/health || exit 1",
        ]
      interval: 30s
      timeout: 10s
      retries: 3

  # FinanceService - Puerto 15108 (Financiamiento)
  reportsservice:
    build:
      context: ./backend
      dockerfile: ReportsService/ReportsService.Api/Dockerfile.dev
    deploy:
      resources:
        limits:
          cpus: "0.5"
          memory: 384M
        reservations:
          memory: 256M
    environment:
      ASPNETCORE_ENVIRONMENT: Development
      ASPNETCORE_URLS: http://+:80
      Database__Provider: "PostgreSQL"
      Database__ConnectionStrings__PostgreSQL: "Host=postgres_db;Port=5432;Database=reportsservice;Username=postgres;Password=password;Pooling=true;Minimum Pool Size=1;Maximum Pool Size=10"
      Database__AutoMigrate: "true"
      DATABASE_HOST: "postgres_db"
      DATABASE_PORT: "5432"
      DATABASE_NAME: "reportsservice"
      DATABASE_USER: "postgres"
      DATABASE_PASSWORD: "password"
      ConnectionStrings__DefaultConnection: "Host=postgres_db;Port=5432;Database=reportsservice;Username=postgres;Password=password;Pooling=true;Minimum Pool Size=1;Maximum Pool Size=10"
      Jwt__Key: "${JWT__KEY:-clave-super-secreta-desarrollo-32-caracteres-aaa}"
      Jwt__Issuer: "AuthService-Dev"
      Jwt__Audience: "OKLA-Dev"
      RabbitMQ__Host: "rabbitmq"
      RabbitMQ__Port: "5672"
      Redis__Host: "redis:6379"
    ports:
      - "15110:80"
    depends_on:
      postgres_db:
        condition: service_healthy
      rabbitmq:
        condition: service_healthy
    networks:
      - okla-net
    volumes:
      - ./backend/ReportsService:/app/ReportsService
      - ./backend/_Shared/CarDealer.Contracts:/app/_Shared/CarDealer.Contracts
      - ./backend/_Shared/CarDealer.Shared:/app/_Shared/CarDealer.Shared
    healthcheck:
      test:
        [
          "CMD-SHELL",
          "wget -q -O /dev/null http://localhost:80/health || exit 1",
        ]
      interval: 30s
      timeout: 10s
      retries: 3

  # SchedulerService - Puerto 15111 (Tareas Programadas)
  schedulerservice:
    build:
      context: ./backend
      dockerfile: SchedulerService/SchedulerService.Api/Dockerfile.dev
    deploy:
      resources:
        limits:
          cpus: "0.5"
          memory: 384M
        reservations:
          memory: 256M
    environment:
      ASPNETCORE_ENVIRONMENT: Development
      ASPNETCORE_URLS: http://+:80
      Database__Provider: "PostgreSQL"
      Database__ConnectionStrings__PostgreSQL: "Host=postgres_db;Port=5432;Database=schedulerservice;Username=postgres;Password=password;Pooling=true;Minimum Pool Size=1;Maximum Pool Size=10"
      Database__AutoMigrate: "true"
      DATABASE_HOST: "postgres_db"
      DATABASE_PORT: "5432"
      DATABASE_NAME: "schedulerservice"
      DATABASE_USER: "postgres"
      DATABASE_PASSWORD: "password"
      ConnectionStrings__DefaultConnection: "Host=postgres_db;Port=5432;Database=schedulerservice;Username=postgres;Password=password;Pooling=true;Minimum Pool Size=1;Maximum Pool Size=10"
      Jwt__Key: "${JWT__KEY:-clave-super-secreta-desarrollo-32-caracteres-aaa}"
      Jwt__Issuer: "AuthService-Dev"
      Jwt__Audience: "OKLA-Dev"
      RabbitMQ__Host: "rabbitmq"
      RabbitMQ__Port: "5672"
      Redis__Host: "redis:6379"
    ports:
      - "15111:80"
    depends_on:
      postgres_db:
        condition: service_healthy
      rabbitmq:
        condition: service_healthy
    networks:
      - okla-net
    volumes:
      - ./backend/SchedulerService:/app/SchedulerService
      - ./backend/_Shared/CarDealer.Contracts:/app/_Shared/CarDealer.Contracts
      - ./backend/_Shared/CarDealer.Shared:/app/_Shared/CarDealer.Shared
    healthcheck:
      test:
        [
          "CMD-SHELL",
          "wget -q -O /dev/null http://localhost:80/health || exit 1",
        ]
      interval: 30s
      timeout: 10s
      retries: 3

  # AuditService - Puerto 15112 (AuditorÃ­a)
  auditservice:
    build:
      context: ./backend
      dockerfile: AuditService/AuditService.Api/Dockerfile.dev
    deploy:
      resources:
        limits:
          cpus: "0.5"
          memory: 384M
        reservations:
          memory: 256M
    environment:
      ASPNETCORE_ENVIRONMENT: Development
      ASPNETCORE_URLS: http://+:80
      Database__Provider: "PostgreSQL"
      Database__ConnectionStrings__PostgreSQL: "Host=postgres_db;Port=5432;Database=auditservice;Username=postgres;Password=password;Pooling=true;Minimum Pool Size=1;Maximum Pool Size=10"
      Database__AutoMigrate: "true"
      DATABASE_HOST: "postgres_db"
      DATABASE_PORT: "5432"
      DATABASE_NAME: "auditservice"
      DATABASE_USER: "postgres"
      DATABASE_PASSWORD: "password"
      ConnectionStrings__DefaultConnection: "Host=postgres_db;Port=5432;Database=auditservice;Username=postgres;Password=password;Pooling=true;Minimum Pool Size=1;Maximum Pool Size=10"
      Jwt__Key: "${JWT__KEY:-clave-super-secreta-desarrollo-32-caracteres-aaa}"
      Jwt__Issuer: "AuthService-Dev"
      Jwt__Audience: "OKLA-Dev"
      RabbitMQ__Host: "rabbitmq"
      RabbitMQ__Port: "5672"
      Redis__Host: "redis:6379"
    ports:
      - "15112:80"
    depends_on:
      postgres_db:
        condition: service_healthy
      rabbitmq:
        condition: service_healthy
    networks:
      - okla-net
    volumes:
      - ./backend/AuditService:/app/AuditService
      - ./backend/_Shared/CarDealer.Contracts:/app/_Shared/CarDealer.Contracts
      - ./backend/_Shared/CarDealer.Shared:/app/_Shared/CarDealer.Shared
    healthcheck:
      test:
        [
          "CMD-SHELL",
          "wget -q -O /dev/null http://localhost:80/health || exit 1",
        ]
      interval: 30s
      timeout: 10s
      retries: 3

  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # ğŸ—„ï¸ CACHE SERVICE (Redis wrapper)
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  cacheservice:
    build:
      context: ./backend
      dockerfile: CacheService/Dockerfile
    deploy:
      resources:
        limits:
          cpus: "0.5"
          memory: 256M
        reservations:
          memory: 128M
    environment:
      ASPNETCORE_ENVIRONMENT: Development
      ASPNETCORE_URLS: http://+:80
      ConnectionStrings__Redis: "redis:6379"
      Jwt__Key: "${JWT__KEY:-clave-super-secreta-desarrollo-32-caracteres-aaa}"
      Jwt__Issuer: "AuthService-Dev"
      Jwt__Audience: "OKLA-Dev"
      Services__ConfigurationService: "http://host.docker.internal:15124"
    ports:
      - "15120:80"
    depends_on:
      redis:
        condition: service_healthy
    networks:
      - okla-net
    healthcheck:
      test:
        [
          "CMD-SHELL",
          "wget -q -O /dev/null http://localhost:80/swagger || exit 1",
        ]
      interval: 30s
      timeout: 10s
      retries: 3

  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  #  APPOINTMENT SERVICE
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  appointmentservice:
    build:
      context: ./backend
      dockerfile: AppointmentService/Dockerfile
    deploy:
      resources:
        limits:
          cpus: "0.5"
          memory: 512M
        reservations:
          memory: 256M
    environment:
      ASPNETCORE_ENVIRONMENT: Development
      ASPNETCORE_URLS: http://+:80
      DATABASE_HOST: "postgres_db"
      DATABASE_PORT: "5432"
      DATABASE_NAME: "appointmentservice"
      DATABASE_USER: "postgres"
      DATABASE_PASSWORD: "password"
      ConnectionStrings__DefaultConnection: "Host=postgres_db;Port=5432;Database=appointmentservice;Username=postgres;Password=password;Pooling=true;Minimum Pool Size=1;Maximum Pool Size=10"
      Jwt__Key: "${JWT__KEY:-clave-super-secreta-desarrollo-32-caracteres-aaa}"
      Jwt__Issuer: "AuthService-Dev"
      Jwt__Audience: "OKLA-Dev"
      RabbitMQ__Host: "rabbitmq"
      RabbitMQ__Port: "5672"
    ports:
      - "15122:80"
    depends_on:
      postgres_db:
        condition: service_healthy
      rabbitmq:
        condition: service_healthy
    networks:
      - okla-net
    healthcheck:
      test:
        [
          "CMD-SHELL",
          "wget -q -O /dev/null http://localhost:80/health || exit 1",
        ]
      interval: 30s
      timeout: 10s
      retries: 3

  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # ğŸ“¦ INVENTORY MANAGEMENT SERVICE (FIXED âœ…)
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  inventorymanagementservice:
    build:
      context: ./backend
      dockerfile: InventoryManagementService/Dockerfile
    deploy:
      resources:
        limits:
          cpus: "0.5"
          memory: 512M
        reservations:
          memory: 256M
    environment:
      ASPNETCORE_ENVIRONMENT: Development
      ASPNETCORE_URLS: http://+:80
      DATABASE_HOST: "postgres_db"
      DATABASE_PORT: "5432"
      DATABASE_NAME: "inventorymanagementservice"
      DATABASE_USER: "postgres"
      DATABASE_PASSWORD: "password"
      ConnectionStrings__DefaultConnection: "Host=postgres_db;Port=5432;Database=inventorymanagementservice;Username=postgres;Password=password;Pooling=true;Minimum Pool Size=1;Maximum Pool Size=10"
      Jwt__Key: "${JWT__KEY:-clave-super-secreta-desarrollo-32-caracteres-aaa}"
      Jwt__Issuer: "AuthService-Dev"
      Jwt__Audience: "OKLA-Dev"
      RabbitMQ__Host: "rabbitmq"
      RabbitMQ__Port: "5672"
    ports:
      - "15149:80"
    depends_on:
      postgres_db:
        condition: service_healthy
      rabbitmq:
        condition: service_healthy
    networks:
      - okla-net
    healthcheck:
      test:
        [
          "CMD-SHELL",
          "wget -q -O /dev/null http://localhost:80/swagger || exit 1",
        ]
      interval: 30s
      timeout: 10s
      retries: 3

  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # ğŸ§¾ INVOICING SERVICE
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  marketingservice:
    build:
      context: ./backend
      dockerfile: MarketingService/Dockerfile
    deploy:
      resources:
        limits:
          cpus: "0.5"
          memory: 512M
        reservations:
          memory: 256M
    environment:
      ASPNETCORE_ENVIRONMENT: Development
      ASPNETCORE_URLS: http://+:80
      DATABASE_HOST: "postgres_db"
      DATABASE_PORT: "5432"
      DATABASE_NAME: "marketingservice"
      DATABASE_USER: "postgres"
      DATABASE_PASSWORD: "password"
      ConnectionStrings__DefaultConnection: "Host=postgres_db;Port=5432;Database=marketingservice;Username=postgres;Password=password;Pooling=true;Minimum Pool Size=1;Maximum Pool Size=10"
      Jwt__Key: "${JWT__KEY:-clave-super-secreta-desarrollo-32-caracteres-aaa}"
      Jwt__Issuer: "AuthService-Dev"
      Jwt__Audience: "OKLA-Dev"
      RabbitMQ__Host: "rabbitmq"
      RabbitMQ__Port: "5672"
    ports:
      - "15125:80"
    depends_on:
      postgres_db:
        condition: service_healthy
      rabbitmq:
        condition: service_healthy
    networks:
      - okla-net
    healthcheck:
      test:
        [
          "CMD-SHELL",
          "wget -q -O /dev/null http://localhost:80/health || exit 1",
        ]
      interval: 30s
      timeout: 10s
      retries: 3

  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # ğŸ¤– RECOMMENDATION SERVICE
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  recommendationservice:
    build:
      context: ./backend
      dockerfile: RecommendationService/Dockerfile
    deploy:
      resources:
        limits:
          cpus: "0.5"
          memory: 512M
        reservations:
          memory: 256M
    environment:
      ASPNETCORE_ENVIRONMENT: Development
      ASPNETCORE_URLS: http://+:80
      DATABASE_HOST: "postgres_db"
      DATABASE_PORT: "5432"
      DATABASE_NAME: "recommendationservice"
      DATABASE_USER: "postgres"
      DATABASE_PASSWORD: "password"
      ConnectionStrings__DefaultConnection: "Host=postgres_db;Port=5432;Database=recommendationservice;Username=postgres;Password=password;Pooling=true;Minimum Pool Size=1;Maximum Pool Size=10"
      Jwt__Key: "${JWT__KEY:-clave-super-secreta-desarrollo-32-caracteres-aaa}"
      Jwt__Issuer: "AuthService-Dev"
      Jwt__Audience: "OKLA-Dev"
      Redis__Host: "redis:6379"
    ports:
      - "15126:80"
    depends_on:
      postgres_db:
        condition: service_healthy
      redis:
        condition: service_healthy
    networks:
      - okla-net
    healthcheck:
      test:
        [
          "CMD-SHELL",
          "wget -q -O /dev/null http://localhost:80/swagger || exit 1",
        ]
      interval: 30s
      timeout: 10s
      retries: 3

  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # ğŸ¥ HEALTH CHECK SERVICE
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  ratelimitingservice:
    build:
      context: ./backend
      dockerfile: RateLimitingService/Dockerfile
    deploy:
      resources:
        limits:
          cpus: "0.3"
          memory: 256M
        reservations:
          memory: 128M
    environment:
      ASPNETCORE_ENVIRONMENT: Development
      ASPNETCORE_URLS: http://+:80
      DATABASE_HOST: "postgres_db"
      DATABASE_PORT: "5432"
      DATABASE_NAME: "ratelimitingservice"
      DATABASE_USER: "postgres"
      DATABASE_PASSWORD: "password"
      ConnectionStrings__DefaultConnection: "Host=postgres_db;Port=5432;Database=ratelimitingservice;Username=postgres;Password=password;Pooling=true;Minimum Pool Size=1;Maximum Pool Size=10"
      Redis__ConnectionString: "redis:6379"
      Jwt__Key: "${JWT__KEY:-clave-super-secreta-desarrollo-32-caracteres-aaa}"
      Jwt__Issuer: "AuthService-Dev"
      Jwt__Audience: "OKLA-Dev"
    ports:
      - "15128:80"
    depends_on:
      redis:
        condition: service_healthy
      postgres_db:
        condition: service_healthy
    networks:
      - okla-net
    healthcheck:
      test:
        [
          "CMD-SHELL",
          "wget -q -O /dev/null http://localhost:80/health || exit 1",
        ]
      interval: 30s
      timeout: 10s
      retries: 3

  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # ğŸš— VEHICLE INTELLIGENCE SERVICE (FIXED âœ…)
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  vehicleintelligenceservice:
    build:
      context: ./backend
      dockerfile: VehicleIntelligenceService/Dockerfile
    deploy:
      resources:
        limits:
          cpus: "0.5"
          memory: 512M
        reservations:
          memory: 256M
    environment:
      ASPNETCORE_ENVIRONMENT: Development
      ASPNETCORE_URLS: http://+:80
      DATABASE_HOST: "postgres_db"
      DATABASE_PORT: "5432"
      DATABASE_NAME: "vehicleintelligenceservice"
      DATABASE_USER: "postgres"
      DATABASE_PASSWORD: "password"
      ConnectionStrings__DefaultConnection: "Host=postgres_db;Port=5432;Database=vehicleintelligenceservice;Username=postgres;Password=password;Pooling=true;Minimum Pool Size=1;Maximum Pool Size=10"
      Jwt__Key: "${JWT__KEY:-clave-super-secreta-desarrollo-32-caracteres-aaa}"
      Jwt__Issuer: "AuthService-Dev"
      Jwt__Audience: "OKLA-Dev"
      RabbitMQ__Host: "rabbitmq"
      RabbitMQ__Port: "5672"
    ports:
      - "15147:80"
    depends_on:
      postgres_db:
        condition: service_healthy
      rabbitmq:
        condition: service_healthy
    networks:
      - okla-net
    healthcheck:
      test:
        [
          "CMD-SHELL",
          "wget -q -O /dev/null http://localhost:80/health || exit 1",
        ]
      interval: 30s
      timeout: 10s
      retries: 3

  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # ğŸ‘¤ USER BEHAVIOR SERVICE
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  configurationservice:
    build:
      context: ./backend
      dockerfile: ConfigurationService/Dockerfile
    deploy:
      resources:
        limits:
          cpus: "0.3"
          memory: 256M
        reservations:
          memory: 128M
    environment:
      ASPNETCORE_ENVIRONMENT: Development
      ASPNETCORE_URLS: http://+:80
      DATABASE_HOST: "postgres_db"
      DATABASE_PORT: "5432"
      DATABASE_NAME: "configurationservice"
      DATABASE_USER: "postgres"
      DATABASE_PASSWORD: "password"
      ConnectionStrings__DefaultConnection: "Host=postgres_db;Port=5432;Database=configurationservice;Username=postgres;Password=password;Pooling=true;Minimum Pool Size=1;Maximum Pool Size=10"
      Jwt__Key: "${JWT__KEY:-clave-super-secreta-desarrollo-32-caracteres-aaa}"
      Jwt__Issuer: "AuthService-Dev"
      Jwt__Audience: "OKLA-Dev"
    ports:
      - "15134:80"
    depends_on:
      postgres_db:
        condition: service_healthy
    networks:
      - okla-net
    healthcheck:
      test:
        [
          "CMD-SHELL",
          "wget -q -O /dev/null http://localhost:80/health || exit 1",
        ]
      interval: 30s
      timeout: 10s
      retries: 3

  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # ğŸ”— INTEGRATION SERVICE
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  integrationservice:
    build:
      context: ./backend
      dockerfile: IntegrationService/Dockerfile
    deploy:
      resources:
        limits:
          cpus: "0.5"
          memory: 512M
        reservations:
          memory: 256M
    environment:
      ASPNETCORE_ENVIRONMENT: Development
      ASPNETCORE_URLS: http://+:80
      DATABASE_HOST: "postgres_db"
      DATABASE_PORT: "5432"
      DATABASE_NAME: "integrationservice"
      DATABASE_USER: "postgres"
      DATABASE_PASSWORD: "password"
      ConnectionStrings__DefaultConnection: "Host=postgres_db;Port=5432;Database=integrationservice;Username=postgres;Password=password;Pooling=true;Minimum Pool Size=1;Maximum Pool Size=10"
      Jwt__Key: "${JWT__KEY:-clave-super-secreta-desarrollo-32-caracteres-aaa}"
      Jwt__Issuer: "AuthService-Dev"
      Jwt__Audience: "OKLA-Dev"
      RabbitMQ__Host: "rabbitmq"
      RabbitMQ__Port: "5672"
    ports:
      - "15135:80"
    depends_on:
      postgres_db:
        condition: service_healthy
      rabbitmq:
        condition: service_healthy
    networks:
      - okla-net
    healthcheck:
      test: ["CMD-SHELL", "exit 0"]
      interval: 30s
      timeout: 10s
      retries: 3

  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # ğŸ”‘ IDEMPOTENCY SERVICE
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  idempotencyservice:
    build:
      context: ./backend
      dockerfile: IdempotencyService/Dockerfile
    deploy:
      resources:
        limits:
          cpus: "0.3"
          memory: 256M
        reservations:
          memory: 128M
    environment:
      ASPNETCORE_ENVIRONMENT: Development
      ASPNETCORE_URLS: http://+:80
      Redis__ConnectionString: "redis:6379"
      Jwt__Key: "${JWT__KEY:-clave-super-secreta-desarrollo-32-caracteres-aaa}"
      Jwt__Issuer: "AuthService-Dev"
      Jwt__Audience: "OKLA-Dev"
    ports:
      - "15136:80"
    depends_on:
      redis:
        condition: service_healthy
    networks:
      - okla-net
    healthcheck:
      test:
        [
          "CMD-SHELL",
          "wget -q -O /dev/null http://localhost:80/swagger || exit 1",
        ]
      interval: 30s
      timeout: 10s
      retries: 3

  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # ğŸ“¨ MESSAGE BUS SERVICE
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  messagebusservice:
    build:
      context: ./backend
      dockerfile: MessageBusService/Dockerfile
    deploy:
      resources:
        limits:
          cpus: "0.3"
          memory: 256M
        reservations:
          memory: 128M
    environment:
      ASPNETCORE_ENVIRONMENT: Development
      ASPNETCORE_URLS: http://+:80
      DATABASE_HOST: "postgres_db"
      DATABASE_PORT: "5432"
      DATABASE_NAME: "messagebusservice"
      DATABASE_USER: "postgres"
      DATABASE_PASSWORD: "password"
      ConnectionStrings__DefaultConnection: "Host=postgres_db;Port=5432;Database=messagebusservice;Username=postgres;Password=password;Pooling=true;Minimum Pool Size=1;Maximum Pool Size=10"
      RabbitMQ__Host: "rabbitmq"
      RabbitMQ__Port: "5672"
      Jwt__Key: "${JWT__KEY:-clave-super-secreta-desarrollo-32-caracteres-aaa}"
      Jwt__Issuer: "AuthService-Dev"
      Jwt__Audience: "OKLA-Dev"
    ports:
      - "15137:80"
    depends_on:
      rabbitmq:
        condition: service_healthy
      postgres_db:
        condition: service_healthy
    networks:
      - okla-net
    healthcheck:
      test:
        [
          "CMD-SHELL",
          "wget -q -O /dev/null http://localhost:80/health || exit 1",
        ]
      interval: 30s
      timeout: 10s
      retries: 3

  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # ğŸ¤– CHATBOT SERVICE (FIXED âœ…)
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  chatbotservice:
    build:
      context: ./backend
      dockerfile: ChatbotService/Dockerfile
    deploy:
      resources:
        limits:
          cpus: "0.5"
          memory: 512M
        reservations:
          memory: 256M
    environment:
      ASPNETCORE_ENVIRONMENT: Development
      ASPNETCORE_URLS: http://+:80
      DATABASE_HOST: "postgres_db"
      DATABASE_PORT: "5432"
      DATABASE_NAME: "chatbotservice"
      DATABASE_USER: "postgres"
      DATABASE_PASSWORD: "password"
      ConnectionStrings__DefaultConnection: "Host=postgres_db;Port=5432;Database=chatbotservice;Username=postgres;Password=password;Pooling=true;Minimum Pool Size=1;Maximum Pool Size=10"
      Jwt__Key: "${JWT__KEY:-clave-super-secreta-desarrollo-32-caracteres-aaa}"
      Jwt__Issuer: "AuthService-Dev"
      Jwt__Audience: "OKLA-Dev"
      RabbitMQ__Host: "rabbitmq"
      RabbitMQ__Port: "5672"
      OpenAI__ApiKey: "${OPENAI_API_KEY:-sk-placeholder}"
    ports:
      - "15148:80"
    depends_on:
      postgres_db:
        condition: service_healthy
      rabbitmq:
        condition: service_healthy
    networks:
      - okla-net
    healthcheck:
      test:
        [
          "CMD-SHELL",
          "wget -q -O /dev/null http://localhost:80/swagger || exit 1",
        ]
      interval: 30s
      timeout: 10s
      retries: 3

  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # ğŸ’³ PAYMENT SERVICE (Multi-Provider: Azul, CardNET, PixelPay, Fygaro, PayPal)
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  paymentservice:
    build:
      context: ./backend
      dockerfile: PaymentService/Dockerfile
    deploy:
      resources:
        limits:
          cpus: "0.5"
          memory: 512M
        reservations:
          memory: 256M
    environment:
      ASPNETCORE_ENVIRONMENT: Development
      ASPNETCORE_URLS: http://+:80
      DATABASE_HOST: "postgres_db"
      DATABASE_PORT: "5432"
      DATABASE_NAME: "paymentservice"
      DATABASE_USER: "postgres"
      DATABASE_PASSWORD: "password"
      ConnectionStrings__DefaultConnection: "Host=postgres_db;Port=5432;Database=paymentservice;Username=postgres;Password=password;Pooling=true;Minimum Pool Size=1;Maximum Pool Size=10"
      Jwt__Key: "${JWT__KEY:-clave-super-secreta-desarrollo-32-caracteres-aaa}"
      Jwt__Issuer: "AuthService-Dev"
      Jwt__Audience: "OKLA-Dev"
      # Azul Payment Gateway
      PaymentGateway__Azul__MerchantId: "${AZUL_MERCHANT_ID:-placeholder}"
      PaymentGateway__Azul__AuthKey: "${AZUL_AUTH_KEY:-placeholder}"
      PaymentGateway__Azul__CyberSourceSecretKey: "${CYBERSOURCE_SECRET_KEY:-placeholder}"
      PaymentGateway__Azul__BaseUrl: "https://pagos.azul.com.do"
      PaymentGateway__Azul__CyberSourceUrl: "https://testsecureacceptance.cybersource.com"
      # CardNET Payment Gateway
      PaymentGateway__CardNET__TerminalId: "${CARDNET_TERMINAL_ID:-placeholder}"
      PaymentGateway__CardNET__APIKey: "${CARDNET_API_KEY:-placeholder}"
      # PixelPay Payment Gateway
      PaymentGateway__PixelPay__AppId: "${PIXELPAY_APP_ID:-placeholder}"
      PaymentGateway__PixelPay__SecretKey: "${PIXELPAY_SECRET_KEY:-placeholder}"
      # PayPal Payment Gateway
      PaymentGateway__PayPal__ClientId: "${PAYPAL_CLIENT_ID:-placeholder}"
      PaymentGateway__PayPal__ClientSecret: "${PAYPAL_CLIENT_SECRET:-placeholder}"
      # Redis Cache
      Redis__ConnectionString: "redis:6379,abortConnect=false"
      Idempotency__DefaultTTLSeconds: "86400"
      Idempotency__ProcessingTimeoutSeconds: "120"
    ports:
      - "15160:80"
    depends_on:
      postgres_db:
        condition: service_healthy
      redis:
        condition: service_healthy
    networks:
      - okla-net
    healthcheck:
      test:
        [
          "CMD-SHELL",
          "wget -q -O /dev/null http://localhost:80/health || exit 1",
        ]
      interval: 30s
      timeout: 10s
      retries: 3

  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # ğŸ’³ AZUL PAYMENT SERVICE (Legacy - Being replaced by PaymentService)
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  azulpaymentservice:
    build:
      context: ./backend
      dockerfile: AzulPaymentService/Dockerfile
    deploy:
      resources:
        limits:
          cpus: "0.5"
          memory: 512M
        reservations:
          memory: 256M
    environment:
      ASPNETCORE_ENVIRONMENT: Development
      ASPNETCORE_URLS: http://+:80
      DATABASE_HOST: "postgres_db"
      DATABASE_PORT: "5432"
      DATABASE_NAME: "azulpaymentservice"
      DATABASE_USER: "postgres"
      DATABASE_PASSWORD: "password"
      ConnectionStrings__DefaultConnection: "Host=postgres_db;Port=5432;Database=azulpaymentservice;Username=postgres;Password=password;Pooling=true;Minimum Pool Size=1;Maximum Pool Size=10"
      Jwt__Key: "${JWT__KEY:-clave-super-secreta-desarrollo-32-caracteres-aaa}"
      Jwt__Issuer: "AuthService-Dev"
      Jwt__Audience: "OKLA-Dev"
      Azul__MerchantId: "${AZUL_MERCHANT_ID:-placeholder}"
      Azul__AuthKey: "${AZUL_AUTH_KEY:-placeholder}"
      Redis__ConnectionString: "redis:6379"
      Idempotency__DefaultTTLSeconds: "86400"
      Idempotency__ProcessingTimeoutSeconds: "120"
    ports:
      - "15145:80"
    depends_on:
      postgres_db:
        condition: service_healthy
      redis:
        condition: service_healthy
    networks:
      - okla-net
    healthcheck:
      test:
        [
          "CMD-SHELL",
          "wget -q -O /dev/null http://localhost:80/health || exit 1",
        ]
      interval: 30s
      timeout: 10s
      retries: 3

  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # ğŸ“š API DOCS SERVICE
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  apidocsservice:
    build:
      context: ./backend
      dockerfile: ApiDocsService/Dockerfile
    deploy:
      resources:
        limits:
          cpus: "0.3"
          memory: 256M
        reservations:
          memory: 128M
    environment:
      ASPNETCORE_ENVIRONMENT: Development
      ASPNETCORE_URLS: http://+:80
      Jwt__Key: "${JWT__KEY:-clave-super-secreta-desarrollo-32-caracteres-aaa}"
      Jwt__Issuer: "AuthService-Dev"
      Jwt__Audience: "OKLA-Dev"
    ports:
      - "15146:80"
    networks:
      - okla-net
    healthcheck:
      test:
        [
          "CMD-SHELL",
          "wget -q -O /dev/null http://localhost:80/health || exit 1",
        ]
      interval: 30s
      timeout: 10s
      retries: 3

  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # ğŸŒ API GATEWAY (Ocelot)
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  # Gateway - Puerto 18443 (Enrutamiento y JWT validation)
  gateway:
    build:
      context: ./backend
      dockerfile: Gateway/Gateway.Api/Dockerfile.dev
    deploy:
      resources:
        limits:
          cpus: "1.0"
          memory: 512M
        reservations:
          memory: 256M
    environment:
      ASPNETCORE_ENVIRONMENT: Development
      ASPNETCORE_URLS: http://+:80
      Jwt__Key: "${JWT__KEY:-clave-super-secreta-desarrollo-32-caracteres-aaa}"
      Jwt__Issuer: "AuthService-Dev"
      Jwt__Audience: "OKLA-Dev"
      Redis__Host: "redis:6379"
      Redis__Connection: "redis:6379"
      RateLimiting__Enabled: "true"
      RateLimiting__DefaultLimit: "100"
      RateLimiting__DefaultWindowSeconds: "60"
      RabbitMQ__Host: "rabbitmq"
      RabbitMQ__Port: "5672"
      RabbitMQ__User: "guest"
      RabbitMQ__Password: "guest"
      Consul__Host: "http://consul:8500"
      # FASE 2: Observability
      Logging__Seq__ServerUrl: "http://seq:80"
      Observability__Otlp__Endpoint: "http://jaeger:4317"
      Observability__SamplingRatio: "1.0"
      Observability__Prometheus__Enabled: "true"
      ErrorHandling__PublishToErrorService: "true"
    ports:
      - "18443:80"
    depends_on:
      authservice:
        condition: service_healthy
      vehiclessaleservice:
        condition: service_healthy
      mediaservice:
        condition: service_healthy
      userservice:
        condition: service_healthy
      contactservice:
        condition: service_healthy
      # notificationservice:                # TEMP: disabled - ITeamsProvider DI error
      #   condition: service_healthy
      adminservice:
        condition: service_healthy
      redis:
        condition: service_healthy
      seq:
        condition: service_healthy
      jaeger:
        condition: service_healthy
    networks:
      - okla-net
    volumes:
      - ./backend/Gateway:/app/Gateway
      - ./backend/_Shared/CarDealer.Contracts:/app/_Shared/CarDealer.Contracts
      - ./backend/_Shared/CarDealer.Shared:/app/_Shared/CarDealer.Shared
      - ./backend/_Shared/CarDealer.Shared.Logging:/app/_Shared/CarDealer.Shared.Logging
      - ./backend/_Shared/CarDealer.Shared.ErrorHandling:/app/_Shared/CarDealer.Shared.ErrorHandling
      - ./backend/_Shared/CarDealer.Shared.Observability:/app/_Shared/CarDealer.Shared.Observability
      - ./backend/_Shared/CarDealer.Shared.RateLimiting:/app/_Shared/CarDealer.Shared.RateLimiting
    healthcheck:
      test:
        [
          "CMD-SHELL",
          "wget -q -O /dev/null http://localhost:80/health || exit 1",
        ]
      interval: 30s
      timeout: 10s
      retries: 3

  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # ğŸ”’ COMPLIANCE & LEGAL SERVICES
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  # KYCService - Puerto 15180 (Know Your Customer - VerificaciÃ³n de Identidad)
  kycservice:
    build:
      context: ./backend
      dockerfile: KYCService/KYCService.Api/Dockerfile.dev
    deploy:
      resources:
        limits:
          cpus: "0.5"
          memory: 512M
        reservations:
          memory: 256M
    environment:
      ASPNETCORE_ENVIRONMENT: Development
      ASPNETCORE_URLS: http://+:80
      DATABASE_HOST: "postgres_db"
      DATABASE_PORT: "5432"
      DATABASE_NAME: "kycdb"
      DATABASE_USER: "postgres"
      DATABASE_PASSWORD: "password"
      ConnectionStrings__DefaultConnection: "Host=postgres_db;Port=5432;Database=kycdb;Username=postgres;Password=password;Pooling=true;Minimum Pool Size=1;Maximum Pool Size=10"
      Jwt__Key: "${JWT__KEY:-clave-super-secreta-desarrollo-32-caracteres-aaa}"
      Jwt__Issuer: "AuthService-Dev"
      Jwt__Audience: "OKLA-Dev"
      Redis__Host: "redis:6379"
      RabbitMQ__Host: "rabbitmq"
      RabbitMQ__Port: "5672"
      Services__ConfigurationService: "http://host.docker.internal:15124"
      # Amazon Rekognition - Usa credenciales de ~/.aws montado como volumen
      FaceComparison__UseSimulation: "false"
      FaceComparison__UseAmazonRekognition: "true"
      AmazonRekognition__Region: "us-east-2"
    volumes:
      - ~/.aws:/root/.aws:ro
    ports:
      - "15180:80"
    depends_on:
      postgres_db:
        condition: service_healthy
      redis:
        condition: service_healthy
      rabbitmq:
        condition: service_healthy
    networks:
      - okla-net
    healthcheck:
      test:
        [
          "CMD-SHELL",
          "wget -q -O /dev/null http://localhost:80/health || exit 1",
        ]
      interval: 30s
      timeout: 10s
      retries: 3

  # ComplianceService - Puerto 15151 (Cumplimiento Regulatorio General)
  complianceservice:
    build:
      context: ./backend
      dockerfile: ComplianceService/ComplianceService.Api/Dockerfile.dev
    deploy:
      resources:
        limits:
          cpus: "0.5"
          memory: 512M
        reservations:
          memory: 256M
    environment:
      ASPNETCORE_ENVIRONMENT: Development
      ASPNETCORE_URLS: http://+:80
      DATABASE_HOST: "postgres_db"
      DATABASE_PORT: "5432"
      DATABASE_NAME: "complianceservice"
      DATABASE_USER: "postgres"
      DATABASE_PASSWORD: "password"
      ConnectionStrings__DefaultConnection: "Host=postgres_db;Port=5432;Database=complianceservice;Username=postgres;Password=password;Pooling=true;Minimum Pool Size=1;Maximum Pool Size=10"
      Jwt__Key: "${JWT__KEY:-clave-super-secreta-desarrollo-32-caracteres-aaa}"
      Jwt__Issuer: "AuthService-Dev"
      Jwt__Audience: "OKLA-Dev"
      Redis__Host: "redis:6379"
      RabbitMQ__Host: "rabbitmq"
      RabbitMQ__Port: "5672"
    ports:
      - "15151:80"
    depends_on:
      postgres_db:
        condition: service_healthy
      redis:
        condition: service_healthy
      rabbitmq:
        condition: service_healthy
    networks:
      - okla-net
    healthcheck:
      test:
        [
          "CMD-SHELL",
          "wget -q -O /dev/null http://localhost:80/health || exit 1",
        ]
      interval: 30s
      timeout: 10s
      retries: 3

  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # ğŸ“¦ FASE 4 CONSOLIDADOS: ContractService, LegalDocumentService,
  #    DisputeService â†’ Absorbidos en LegalService (futuro)
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # ğŸ§  DATA & ML SERVICES
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  # FeatureStoreService - Puerto 15156 (Feature Store para ML)
  leadscoringservice:
    build:
      context: ./backend
      dockerfile: LeadScoringService/LeadScoringService.Api/Dockerfile.dev
    deploy:
      resources:
        limits:
          cpus: "0.5"
          memory: 512M
        reservations:
          memory: 256M
    environment:
      ASPNETCORE_ENVIRONMENT: Development
      ASPNETCORE_URLS: http://+:80
      DATABASE_HOST: "postgres_db"
      DATABASE_PORT: "5432"
      DATABASE_NAME: "leadscoringservice"
      DATABASE_USER: "postgres"
      DATABASE_PASSWORD: "password"
      ConnectionStrings__DefaultConnection: "Host=postgres_db;Port=5432;Database=leadscoringservice;Username=postgres;Password=password;Pooling=true;Minimum Pool Size=1;Maximum Pool Size=10"
      Jwt__Key: "${JWT__KEY:-clave-super-secreta-desarrollo-32-caracteres-aaa}"
      Jwt__Issuer: "AuthService-Dev"
      Jwt__Audience: "OKLA-Dev"
      Redis__Host: "redis:6379"
      RabbitMQ__Host: "rabbitmq"
      RabbitMQ__Port: "5672"
    ports:
      - "15157:80"
    depends_on:
      postgres_db:
        condition: service_healthy
      redis:
        condition: service_healthy
      rabbitmq:
        condition: service_healthy
    networks:
      - okla-net
    healthcheck:
      test:
        [
          "CMD-SHELL",
          "wget -q -O /dev/null http://localhost:80/health || exit 1",
        ]
      interval: 30s
      timeout: 10s
      retries: 3

  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # ğŸ”— INTEGRATION SERVICES
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  # SpyneIntegrationService - Puerto 15158 (IntegraciÃ³n con Spyne AI)
  spyneintegrationservice:
    build:
      context: ./backend
      dockerfile: SpyneIntegrationService/SpyneIntegrationService.Api/Dockerfile.dev
    deploy:
      resources:
        limits:
          cpus: "0.5"
          memory: 512M
        reservations:
          memory: 256M
    environment:
      ASPNETCORE_ENVIRONMENT: Development
      ASPNETCORE_URLS: http://+:80
      DATABASE_HOST: "postgres_db"
      DATABASE_PORT: "5432"
      DATABASE_NAME: "spyneintegrationservice"
      DATABASE_USER: "postgres"
      DATABASE_PASSWORD: "password"
      ConnectionStrings__DefaultConnection: "Host=postgres_db;Port=5432;Database=spyneintegrationservice;Username=postgres;Password=password;Pooling=true;Minimum Pool Size=1;Maximum Pool Size=10"
      Jwt__Key: "${JWT__KEY:-clave-super-secreta-desarrollo-32-caracteres-aaa}"
      Jwt__Issuer: "AuthService-Dev"
      Jwt__Audience: "OKLA-Dev"
      Redis__Host: "redis:6379"
      RabbitMQ__Host: "rabbitmq"
      RabbitMQ__Port: "5672"
    ports:
      - "15158:80"
    depends_on:
      postgres_db:
        condition: service_healthy
      redis:
        condition: service_healthy
      rabbitmq:
        condition: service_healthy
    networks:
      - okla-net
    healthcheck:
      test:
        [
          "CMD-SHELL",
          "wget -q -O /dev/null http://localhost:80/health || exit 1",
        ]
      interval: 30s
      timeout: 10s
      retries: 3

  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # ğŸ“¦ FASE 4 CONSOLIDADOS: RegulatoryAlertService, ComplianceIntegrationService
  #    â†’ Absorbidos en ComplianceService
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  # ReportingService - Puerto 15161 (Reportes Generales)
  frontend-web:
    build:
      context: ./frontend/web
      dockerfile: Dockerfile.dev
    deploy:
      resources:
        limits:
          cpus: "1.0"
          memory: 2G
        reservations:
          memory: 1G
    ports:
      - "3000:5173" # Vite dev server
    volumes:
      - ./frontend/web/src:/app/src
      - ./frontend/web/public:/app/public
    depends_on:
      gateway:
        condition: service_healthy
      authservice:
        condition: service_healthy
    networks:
      - okla-net
    environment:
      - NODE_OPTIONS=--max-old-space-size=1536
      - VITE_API_URL=http://localhost:18443
      - VITE_AUTH_SERVICE_URL=http://localhost:15085/api
      - VITE_GOOGLE_MAPS_KEY=AIzaSyBHYPOPdUI45VrntYnM173q19BYVQ7k4nY
      - VITE_PRODUCT_SERVICE_URL=http://localhost:15006/api
      - VITE_MEDIA_SERVICE_URL=http://localhost:15090/api
      - VITE_USE_MOCK_AUTH=false
      - VITE_ENABLE_MSW=false
      - VITE_GOOGLE_CLIENT_ID=${GOOGLE_CLIENT_ID:-your-google-client-id}
    restart: on-failure
    healthcheck:
      test:
        [
          "CMD-SHELL",
          'node -e "require(''http'').get(''http://localhost:5173'', (r) => process.exit(r.statusCode === 200 ? 0 : 1)).on(''error'', () => process.exit(1))"',
        ]
      interval: 30s
      timeout: 10s
      retries: 5
      start_period: 60s

  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # ğŸŒ FRONTEND WEB-NEXT (Next.js 16 Rebuild)
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  frontend-next:
    build:
      context: ./frontend/web-next
      dockerfile: Dockerfile.dev # Development mode with hot reload
    deploy:
      resources:
        limits:
          cpus: "1.5"
          memory: 2G
        reservations:
          memory: 1G
    ports:
      - "3000:3000" # Next.js dev server on port 3000
    volumes:
      # Mount source code for hot reload
      - ./frontend/web-next/src:/app/src:delegated
      - ./frontend/web-next/public:/app/public:delegated
      - ./frontend/web-next/next.config.ts:/app/next.config.ts:delegated
      - ./frontend/web-next/tailwind.config.ts:/app/tailwind.config.ts:delegated
      - ./frontend/web-next/tsconfig.json:/app/tsconfig.json:delegated
      # Exclude node_modules and .next from host (use container's)
      - /app/node_modules
      - /app/.next
    depends_on:
      gateway:
        condition: service_healthy
      postgres_db:
        condition: service_healthy
    networks:
      - okla-net
    environment:
      - NODE_ENV=development
      - NEXT_TELEMETRY_DISABLED=1
      - WATCHPACK_POLLING=true
      - CHOKIDAR_USEPOLLING=true
      - NEXT_PUBLIC_API_URL=http://localhost:18443
      - NEXT_PUBLIC_SITE_URL=http://localhost:3000
      - INTERNAL_API_URL=http://gateway:80
    restart: unless-stopped
    healthcheck:
      test:
        [
          "CMD-SHELL",
          "wget --no-verbose --tries=1 --spider http://localhost:3000 || exit 1",
        ]
      interval: 30s
      timeout: 10s
      retries: 5
      start_period: 90s

# ============================================================================
# NETWORKS
# ============================================================================
networks:
  okla-net:
    driver: bridge

# ============================================================================
# VOLUMES
# ============================================================================
volumes:
  postgres_data:
  rabbitmq_data:
  redis_data:
  consul_data:
  pg_backup_data:
  # FASE 2: Observability volumes
  seq_data:
