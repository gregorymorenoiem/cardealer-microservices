# ğŸ“„ Comprobantes Fiscales ElectrÃ³nicos (e-CF) - OKLA S.R.L.

> **Empresa:** OKLA S.R.L.  
> **RNC:** 1-33-32590-1  
> **Registro Mercantil:** 196339PSD  
> **Fecha de CreaciÃ³n:** Enero 25, 2026  
> **PropÃ³sito:** ImplementaciÃ³n de FacturaciÃ³n ElectrÃ³nica segÃºn Norma General 06-2018

---

## ğŸ“‹ RESUMEN EJECUTIVO

OKLA implementarÃ¡ **Comprobantes Fiscales ElectrÃ³nicos (e-CF)** para todas sus operaciones de facturaciÃ³n, cumpliendo con la Norma General 06-2018 de DGII. Esto permitirÃ¡:

1. âœ… EmisiÃ³n instantÃ¡nea de facturas validadas por DGII
2. âœ… EliminaciÃ³n de papel y almacenamiento fÃ­sico
3. âœ… Trazabilidad completa de todas las transacciones
4. âœ… IntegraciÃ³n directa con sistemas DGII
5. âœ… GeneraciÃ³n automÃ¡tica de Formatos 606/607/608

---

## 1. Â¿QUÃ‰ ES EL e-CF?

### 1.1 DefiniciÃ³n

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              COMPROBANTE FISCAL ELECTRÃ“NICO (e-CF)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  El e-CF es un documento tributario emitido y transmitido              â”‚
â”‚  electrÃ³nicamente a la DGII, que tiene la misma validez legal          â”‚
â”‚  que un NCF en papel.                                                   â”‚
â”‚                                                                         â”‚
â”‚  ğŸ“‹ CARACTERÃSTICAS:                                                    â”‚
â”‚  â”œâ”€â”€ Firmado digitalmente                                               â”‚
â”‚  â”œâ”€â”€ Transmitido en tiempo real a DGII                                  â”‚
â”‚  â”œâ”€â”€ Validado y autorizado por DGII                                     â”‚
â”‚  â”œâ”€â”€ Almacenado electrÃ³nicamente                                        â”‚
â”‚  â””â”€â”€ Incluye cÃ³digo QR de verificaciÃ³n                                  â”‚
â”‚                                                                         â”‚
â”‚  ğŸ“Š ESTRUCTURA DEL e-CF:                                                â”‚
â”‚  E + Tipo (2 dÃ­gitos) + Secuencial (8 dÃ­gitos)                          â”‚
â”‚  Ejemplo: E310000001 (Factura de CrÃ©dito Fiscal ElectrÃ³nica)            â”‚
â”‚                                                                         â”‚
â”‚  ğŸ“œ BASE LEGAL:                                                         â”‚
â”‚  â€¢ Norma General 06-2018 (DGII)                                         â”‚
â”‚  â€¢ ResoluciÃ³n 13-2019 (Especificaciones TÃ©cnicas)                       â”‚
â”‚  â€¢ Ley 11-92 (CÃ³digo Tributario)                                        â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 Tipos de e-CF

| CÃ³digo | Tipo de e-CF              | Equivalente NCF | Uso en OKLA                   |
| ------ | ------------------------- | --------------- | ----------------------------- |
| E31    | Factura de CrÃ©dito Fiscal | B01             | Ventas a empresas con RNC     |
| E32    | Factura de Consumo        | B02             | Ventas a consumidores finales |
| E33    | Nota de DÃ©bito            | B03             | Ajustes a favor de OKLA       |
| E34    | Nota de CrÃ©dito           | B04             | Devoluciones, descuentos      |
| E41    | Compras                   | B11             | Compras a informales          |
| E43    | Gastos Menores            | B13             | Gastos del exterior           |
| E44    | RegÃ­menes Especiales      | B14             | (No aplica a OKLA)            |
| E45    | Gubernamental             | B15             | Ventas al gobierno            |
| E46    | Exportaciones             | B16             | (No aplica a OKLA)            |
| E47    | Compras Exterior          | B17             | Pagos internacionales         |

### 1.3 Tipos de e-CF que OKLA EmitirÃ¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    e-CF QUE OKLA EMITIRÃ                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  ğŸ§¾ VENTAS (Formato 607)                                                â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                              â”‚
â”‚                                                                         â”‚
â”‚  E31 - Factura de CrÃ©dito Fiscal ElectrÃ³nica                            â”‚
â”‚  â””â”€â”€ Cuando: Dealer con RNC compra suscripciÃ³n o boost                  â”‚
â”‚  â””â”€â”€ Ejemplo: Dealer ABC SRL paga $129/mes plan Pro                    â”‚
â”‚  â””â”€â”€ ITBIS: 18% ($23.22)                                               â”‚
â”‚                                                                         â”‚
â”‚  E32 - Factura de Consumo ElectrÃ³nica                                   â”‚
â”‚  â””â”€â”€ Cuando: Individuo paga listing o boost                            â”‚
â”‚  â””â”€â”€ Ejemplo: Juan PÃ©rez paga $29 por publicar vehÃ­culo                â”‚
â”‚  â””â”€â”€ ITBIS: 18% ($5.22)                                                â”‚
â”‚                                                                         â”‚
â”‚  E34 - Nota de CrÃ©dito ElectrÃ³nica                                      â”‚
â”‚  â””â”€â”€ Cuando: Reembolso, devoluciÃ³n, descuento posterior                â”‚
â”‚  â””â”€â”€ Ejemplo: Cliente cancela suscripciÃ³n, reembolso prorrateado       â”‚
â”‚  â””â”€â”€ Debe referenciar e-CF original                                    â”‚
â”‚                                                                         â”‚
â”‚  ğŸ“¦ COMPRAS (Formato 606)                                               â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                              â”‚
â”‚                                                                         â”‚
â”‚  E47 - Comprobante de Compras Exterior                                  â”‚
â”‚  â””â”€â”€ Cuando: Pago a Digital Ocean, Stripe, Google Ads, etc.           â”‚
â”‚  â””â”€â”€ NO tiene ITBIS (es gasto exterior)                                â”‚
â”‚  â””â”€â”€ Sistema genera e-CF interno para control                          â”‚
â”‚                                                                         â”‚
â”‚  E41 - Comprobante de Compras                                           â”‚
â”‚  â””â”€â”€ Cuando: Proveedor local no tiene NCF (raro)                       â”‚
â”‚  â””â”€â”€ RetenciÃ³n de 2% ISR                                               â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. PROCESO DE CERTIFICACIÃ“N e-CF

### 2.1 Requisitos para ser Emisor e-CF

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              REQUISITOS PARA EMITIR e-CF                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  1ï¸âƒ£ REQUISITOS LEGALES                                                  â”‚
â”‚  â”œâ”€â”€ âœ… RNC activo y al dÃ­a                                             â”‚
â”‚  â”œâ”€â”€ âœ… Sin deudas con DGII                                             â”‚
â”‚  â”œâ”€â”€ âœ… Declaraciones al dÃ­a (IT-1, IR-17, etc.)                        â”‚
â”‚  â””â”€â”€ âœ… Representante legal registrado                                   â”‚
â”‚                                                                         â”‚
â”‚  2ï¸âƒ£ REQUISITOS TÃ‰CNICOS                                                 â”‚
â”‚  â”œâ”€â”€ ğŸ” Certificado Digital (Firma ElectrÃ³nica)                         â”‚
â”‚  â”‚   â””â”€â”€ Emitido por: INDOTEL o proveedor autorizado                   â”‚
â”‚  â”‚   â””â”€â”€ Costo: ~RD$5,000-15,000/aÃ±o                                   â”‚
â”‚  â”‚   â””â”€â”€ Opciones: CÃ¡mara de Comercio, CertiSign, etc.                 â”‚
â”‚  â”œâ”€â”€ ğŸ’» Sistema de FacturaciÃ³n ElectrÃ³nica                              â”‚
â”‚  â”‚   â””â”€â”€ Desarrollo propio (OKLA) o software certificado               â”‚
â”‚  â”‚   â””â”€â”€ Debe cumplir especificaciones DGII                            â”‚
â”‚  â””â”€â”€ ğŸŒ ConexiÃ³n a Servicios Web DGII                                   â”‚
â”‚      â””â”€â”€ URLs de prueba y producciÃ³n                                   â”‚
â”‚      â””â”€â”€ AutenticaciÃ³n con certificado                                 â”‚
â”‚                                                                         â”‚
â”‚  3ï¸âƒ£ PROCESO DE CERTIFICACIÃ“N                                            â”‚
â”‚  â”œâ”€â”€ Paso 1: Solicitar acceso a ambiente de pruebas                     â”‚
â”‚  â”œâ”€â”€ Paso 2: Desarrollar integraciÃ³n                                    â”‚
â”‚  â”œâ”€â”€ Paso 3: Ejecutar pruebas (mÃ­nimo 20 e-CF de cada tipo)            â”‚
â”‚  â”œâ”€â”€ Paso 4: DGII valida y aprueba                                      â”‚
â”‚  â”œâ”€â”€ Paso 5: Migrar a producciÃ³n                                        â”‚
â”‚  â””â”€â”€ Tiempo estimado: 30-60 dÃ­as                                       â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 Arquitectura de IntegraciÃ³n DGII

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ARQUITECTURA e-CF - OKLA                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚   Frontend   â”‚â”€â”€â”€â–¶â”‚ BillingServiceâ”‚â”€â”€â”€â–¶â”‚  ECFService  â”‚              â”‚
â”‚  â”‚  (Checkout)  â”‚    â”‚              â”‚    â”‚              â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                  â”‚                      â”‚
â”‚                                                  â–¼                      â”‚
â”‚                                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚                                         â”‚ Certificado  â”‚                â”‚
â”‚                                         â”‚   Digital    â”‚                â”‚
â”‚                                         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                                  â”‚                      â”‚
â”‚                                                  â–¼                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚                    DGII Web Services                          â”‚      â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚      â”‚
â”‚  â”‚  â”‚ RecepcionECF   â”‚  â”‚ ConsultaECF    â”‚  â”‚ AnulacionECF   â”‚  â”‚      â”‚
â”‚  â”‚  â”‚ (Enviar e-CF)  â”‚  â”‚ (Verificar)    â”‚  â”‚ (Cancelar)     â”‚  â”‚      â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                                         â”‚
â”‚  URLs DGII:                                                             â”‚
â”‚  â€¢ Pruebas: https://ecf.dgii.gov.do/testecf/                           â”‚
â”‚  â€¢ ProducciÃ³n: https://ecf.dgii.gov.do/ecf/                            â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. IMPLEMENTACIÃ“N TÃ‰CNICA

### 3.1 ECFService - Microservicio de FacturaciÃ³n ElectrÃ³nica

```csharp
// ECFService.Domain/Entities/ElectronicInvoice.cs

namespace ECFService.Domain.Entities;

public class ElectronicInvoice
{
    public Guid Id { get; set; }
    public string ECFNumber { get; set; } = string.Empty;  // E3100000001
    public ECFType Type { get; set; }
    public ECFStatus Status { get; set; }

    // Emisor (OKLA)
    public string IssuerRNC { get; set; } = "133325901";
    public string IssuerName { get; set; } = "OKLA S.R.L.";

    // Receptor (Cliente)
    public string? ReceiverRNC { get; set; }
    public string ReceiverName { get; set; } = string.Empty;
    public ReceiverType ReceiverType { get; set; }  // Empresa, PersonaFisica, Consumidor

    // Montos
    public decimal Subtotal { get; set; }
    public decimal TaxAmount { get; set; }  // ITBIS 18%
    public decimal Total { get; set; }

    // Fechas
    public DateTime IssueDate { get; set; }
    public DateTime? DGIISubmitDate { get; set; }
    public DateTime? DGIIApprovalDate { get; set; }

    // DGII Response
    public string? TrackingNumber { get; set; }  // NÃºmero de seguimiento DGII
    public string? ApprovalCode { get; set; }
    public string? DGIIMessage { get; set; }

    // XML y PDF
    public string? SignedXmlUrl { get; set; }  // XML firmado en S3
    public string? PdfUrl { get; set; }         // PDF con QR en S3
    public string? QRCode { get; set; }         // CÃ³digo QR de verificaciÃ³n

    // Relaciones
    public string? OriginalECFNumber { get; set; }  // Para notas de crÃ©dito
    public Guid? PaymentId { get; set; }
    public ICollection<ElectronicInvoiceItem> Items { get; set; } = new List<ElectronicInvoiceItem>();
}

public enum ECFType
{
    E31_CreditoFiscal = 31,
    E32_Consumo = 32,
    E33_NotaDebito = 33,
    E34_NotaCredito = 34,
    E41_Compras = 41,
    E43_GastosMenores = 43,
    E47_ComprasExterior = 47
}

public enum ECFStatus
{
    Draft,          // En ediciÃ³n
    Pending,        // Pendiente de firma
    Signed,         // Firmado, pendiente de envÃ­o
    Submitted,      // Enviado a DGII
    Approved,       // Aprobado por DGII
    Rejected,       // Rechazado por DGII
    Cancelled       // Anulado
}
```

### 3.2 Servicio de GeneraciÃ³n de e-CF

```csharp
// ECFService.Application/Services/ECFGeneratorService.cs

public class ECFGeneratorService : IECFGeneratorService
{
    private readonly IECFRepository _repository;
    private readonly IDigitalSignatureService _signatureService;
    private readonly IDGIIWebService _dgiiService;
    private readonly IS3Service _s3;
    private readonly IPdfGenerator _pdfGenerator;

    public async Task<ElectronicInvoice> GenerateFromPaymentAsync(Payment payment)
    {
        // 1. Determinar tipo de e-CF
        var ecfType = DetermineECFType(payment);

        // 2. Obtener siguiente nÃºmero secuencial
        var nextNumber = await _repository.GetNextSequentialAsync(ecfType);
        var ecfNumber = FormatECFNumber(ecfType, nextNumber);

        // 3. Crear e-CF
        var invoice = new ElectronicInvoice
        {
            Id = Guid.NewGuid(),
            ECFNumber = ecfNumber,
            Type = ecfType,
            Status = ECFStatus.Draft,
            IssuerRNC = "133325901",
            IssuerName = "OKLA S.R.L.",
            ReceiverRNC = payment.CustomerRNC,
            ReceiverName = payment.CustomerName,
            ReceiverType = DetermineReceiverType(payment),
            Subtotal = payment.Subtotal,
            TaxAmount = payment.TaxAmount,
            Total = payment.Total,
            IssueDate = DateTime.UtcNow,
            PaymentId = payment.Id
        };

        // 4. Agregar items
        invoice.Items = payment.Items.Select(i => new ElectronicInvoiceItem
        {
            Description = i.Description,
            Quantity = i.Quantity,
            UnitPrice = i.UnitPrice,
            TaxAmount = i.TaxAmount,
            Total = i.Total
        }).ToList();

        // 5. Generar XML segÃºn especificaciones DGII
        var xml = await GenerateXmlAsync(invoice);

        // 6. Firmar digitalmente
        var signedXml = await _signatureService.SignXmlAsync(xml);
        invoice.Status = ECFStatus.Signed;

        // 7. Guardar XML firmado en S3
        var xmlKey = $"ecf/{invoice.IssueDate:yyyy/MM}/{invoice.ECFNumber}.xml";
        invoice.SignedXmlUrl = await _s3.UploadAsync(xmlKey, signedXml);

        // 8. Enviar a DGII
        var dgiiResponse = await _dgiiService.SubmitECFAsync(signedXml);

        if (dgiiResponse.Success)
        {
            invoice.Status = ECFStatus.Approved;
            invoice.TrackingNumber = dgiiResponse.TrackingNumber;
            invoice.ApprovalCode = dgiiResponse.ApprovalCode;
            invoice.DGIISubmitDate = DateTime.UtcNow;
            invoice.DGIIApprovalDate = DateTime.UtcNow;

            // 9. Generar PDF con QR
            invoice.QRCode = GenerateQRCode(invoice);
            var pdf = await _pdfGenerator.GenerateECFPdfAsync(invoice);
            var pdfKey = $"ecf/{invoice.IssueDate:yyyy/MM}/{invoice.ECFNumber}.pdf";
            invoice.PdfUrl = await _s3.UploadAsync(pdfKey, pdf);
        }
        else
        {
            invoice.Status = ECFStatus.Rejected;
            invoice.DGIIMessage = dgiiResponse.ErrorMessage;
        }

        // 10. Guardar en base de datos
        await _repository.AddAsync(invoice);

        return invoice;
    }

    private ECFType DetermineECFType(Payment payment)
    {
        // Si tiene RNC â†’ E31 (CrÃ©dito Fiscal)
        // Si no tiene RNC â†’ E32 (Consumo)
        if (!string.IsNullOrEmpty(payment.CustomerRNC))
            return ECFType.E31_CreditoFiscal;

        return ECFType.E32_Consumo;
    }

    private string FormatECFNumber(ECFType type, int sequential)
    {
        // E + tipo (2 dÃ­gitos) + secuencial (8 dÃ­gitos)
        return $"E{(int)type:D2}{sequential:D8}";
    }

    private string GenerateQRCode(ElectronicInvoice invoice)
    {
        // URL de verificaciÃ³n DGII
        var verificationUrl = $"https://dgii.gov.do/ecf/consulta?" +
            $"rnc={invoice.IssuerRNC}&ecf={invoice.ECFNumber}";

        // Generar QR con la URL
        return QRCodeGenerator.Generate(verificationUrl);
    }
}
```

### 3.3 IntegraciÃ³n con Web Services DGII

```csharp
// ECFService.Infrastructure/Services/DGIIWebService.cs

public class DGIIWebService : IDGIIWebService
{
    private readonly HttpClient _httpClient;
    private readonly DGIISettings _settings;
    private readonly ILogger<DGIIWebService> _logger;

    private const string PRODUCTION_URL = "https://ecf.dgii.gov.do/ecf/";
    private const string TEST_URL = "https://ecf.dgii.gov.do/testecf/";

    public async Task<DGIIResponse> SubmitECFAsync(string signedXml)
    {
        var url = _settings.IsProduction ? PRODUCTION_URL : TEST_URL;
        url += "RecepcionECF";

        try
        {
            // Configurar cliente con certificado
            var handler = new HttpClientHandler();
            handler.ClientCertificates.Add(_settings.Certificate);

            using var client = new HttpClient(handler);

            var content = new StringContent(signedXml, Encoding.UTF8, "application/xml");
            var response = await client.PostAsync(url, content);

            var responseXml = await response.Content.ReadAsStringAsync();

            // Parsear respuesta DGII
            return ParseDGIIResponse(responseXml);
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Error enviando e-CF a DGII");
            return new DGIIResponse
            {
                Success = false,
                ErrorMessage = ex.Message
            };
        }
    }

    public async Task<DGIIResponse> CancelECFAsync(string ecfNumber, string reason)
    {
        var url = _settings.IsProduction ? PRODUCTION_URL : TEST_URL;
        url += "AnulacionECF";

        var cancellationXml = GenerateCancellationXml(ecfNumber, reason);
        var signedXml = await _signatureService.SignXmlAsync(cancellationXml);

        // Similar al submit...
        return await SubmitXmlAsync(url, signedXml);
    }

    public async Task<ECFVerificationResult> VerifyECFAsync(string ecfNumber)
    {
        var url = _settings.IsProduction ? PRODUCTION_URL : TEST_URL;
        url += $"ConsultaECF?ecf={ecfNumber}&rnc=133325901";

        var response = await _httpClient.GetStringAsync(url);
        return ParseVerificationResponse(response);
    }
}
```

---

## 4. FLUJO DE FACTURACIÃ“N ELECTRÃ“NICA

### 4.1 Flujo Completo de Venta

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              FLUJO DE FACTURACIÃ“N ELECTRÃ“NICA - OKLA                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  1ï¸âƒ£ CLIENTE REALIZA COMPRA                                              â”‚
â”‚     â”œâ”€â”€ Selecciona servicio (Listing $29, Boost, SuscripciÃ³n)          â”‚
â”‚     â”œâ”€â”€ Ingresa datos de facturaciÃ³n                                   â”‚
â”‚     â”‚   â”œâ”€â”€ Nombre completo                                            â”‚
â”‚     â”‚   â”œâ”€â”€ RNC (opcional, pero necesario para E31)                    â”‚
â”‚     â”‚   â””â”€â”€ Email para recibir factura                                 â”‚
â”‚     â””â”€â”€ Procede al pago (AZUL o Stripe)                                â”‚
â”‚                                                                         â”‚
â”‚                        â–¼                                                â”‚
â”‚                                                                         â”‚
â”‚  2ï¸âƒ£ PAGO PROCESADO                                                      â”‚
â”‚     â”œâ”€â”€ Stripe/AZUL confirma transacciÃ³n                               â”‚
â”‚     â”œâ”€â”€ BillingService registra Payment                                â”‚
â”‚     â””â”€â”€ Dispara evento: PaymentCompletedEvent                          â”‚
â”‚                                                                         â”‚
â”‚                        â–¼                                                â”‚
â”‚                                                                         â”‚
â”‚  3ï¸âƒ£ GENERACIÃ“N DE e-CF                                                  â”‚
â”‚     â”œâ”€â”€ ECFService recibe evento                                       â”‚
â”‚     â”œâ”€â”€ Determina tipo: E31 (con RNC) o E32 (sin RNC)                  â”‚
â”‚     â”œâ”€â”€ Genera XML segÃºn especificaciones DGII                         â”‚
â”‚     â”œâ”€â”€ Firma digitalmente con certificado                             â”‚
â”‚     â””â”€â”€ Valida estructura XML                                          â”‚
â”‚                                                                         â”‚
â”‚                        â–¼                                                â”‚
â”‚                                                                         â”‚
â”‚  4ï¸âƒ£ ENVÃO A DGII                                                        â”‚
â”‚     â”œâ”€â”€ POST a https://ecf.dgii.gov.do/ecf/RecepcionECF                â”‚
â”‚     â”œâ”€â”€ DGII valida: RNC, montos, estructura, firma                    â”‚
â”‚     â””â”€â”€ DGII responde en < 3 segundos                                  â”‚
â”‚                                                                         â”‚
â”‚                        â–¼                                                â”‚
â”‚                                                                         â”‚
â”‚  5ï¸âƒ£ RESPUESTA DGII                                                      â”‚
â”‚     â”œâ”€â”€ âœ… APROBADO:                                                    â”‚
â”‚     â”‚   â”œâ”€â”€ Guardar TrackingNumber y ApprovalCode                      â”‚
â”‚     â”‚   â”œâ”€â”€ Generar PDF con cÃ³digo QR                                  â”‚
â”‚     â”‚   â”œâ”€â”€ Almacenar en S3                                            â”‚
â”‚     â”‚   â””â”€â”€ Enviar al cliente por email                                â”‚
â”‚     â”‚                                                                   â”‚
â”‚     â””â”€â”€ âŒ RECHAZADO:                                                   â”‚
â”‚         â”œâ”€â”€ Registrar cÃ³digo de error                                  â”‚
â”‚         â”œâ”€â”€ Alertar a administrador                                    â”‚
â”‚         â”œâ”€â”€ Corregir y reintentar                                      â”‚
â”‚         â””â”€â”€ Si persiste: Generar NCF manual (backup)                   â”‚
â”‚                                                                         â”‚
â”‚                        â–¼                                                â”‚
â”‚                                                                         â”‚
â”‚  6ï¸âƒ£ ALMACENAMIENTO Y REPORTE                                            â”‚
â”‚     â”œâ”€â”€ e-CF almacenado en PostgreSQL                                  â”‚
â”‚     â”œâ”€â”€ XML/PDF almacenados en S3                                      â”‚
â”‚     â”œâ”€â”€ Incluido automÃ¡ticamente en Formato 607                        â”‚
â”‚     â””â”€â”€ Disponible para auditorÃ­a                                      â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 Flujo de Nota de CrÃ©dito (Reembolso)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              FLUJO DE NOTA DE CRÃ‰DITO (E34)                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  1ï¸âƒ£ SOLICITUD DE REEMBOLSO                                              â”‚
â”‚     â”œâ”€â”€ Cliente solicita cancelaciÃ³n/reembolso                         â”‚
â”‚     â”œâ”€â”€ Admin aprueba en dashboard                                     â”‚
â”‚     â””â”€â”€ Sistema identifica e-CF original                               â”‚
â”‚                                                                         â”‚
â”‚                        â–¼                                                â”‚
â”‚                                                                         â”‚
â”‚  2ï¸âƒ£ GENERACIÃ“N DE NOTA DE CRÃ‰DITO                                       â”‚
â”‚     â”œâ”€â”€ Tipo: E34 (Nota de CrÃ©dito ElectrÃ³nica)                        â”‚
â”‚     â”œâ”€â”€ Referencia: e-CF original (ej: E3100000123)                    â”‚
â”‚     â”œâ”€â”€ Monto: Total o parcial del reembolso                           â”‚
â”‚     â””â”€â”€ Motivo: CancelaciÃ³n, error, devoluciÃ³n                         â”‚
â”‚                                                                         â”‚
â”‚                        â–¼                                                â”‚
â”‚                                                                         â”‚
â”‚  3ï¸âƒ£ ENVÃO A DGII                                                        â”‚
â”‚     â”œâ”€â”€ Mismo proceso que factura                                      â”‚
â”‚     â”œâ”€â”€ DGII valida que e-CF original existe                           â”‚
â”‚     â””â”€â”€ DGII valida que monto no excede original                       â”‚
â”‚                                                                         â”‚
â”‚                        â–¼                                                â”‚
â”‚                                                                         â”‚
â”‚  4ï¸âƒ£ PROCESAMIENTO                                                       â”‚
â”‚     â”œâ”€â”€ Si aprobado: Procesar reembolso (Stripe/AZUL)                  â”‚
â”‚     â”œâ”€â”€ Actualizar estado del e-CF original                            â”‚
â”‚     â”œâ”€â”€ Enviar nota de crÃ©dito al cliente                              â”‚
â”‚     â””â”€â”€ Incluir en Formato 607 como crÃ©dito                            â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. ESTRUCTURA XML DEL e-CF

### 5.1 Ejemplo de XML (E31 - CrÃ©dito Fiscal)

```xml
<?xml version="1.0" encoding="UTF-8"?>
<ECF xmlns="https://dgii.gov.do/ecf">
  <Encabezado>
    <Version>1.0</Version>
    <IdDoc>
      <TipoECF>31</TipoECF>
      <eNCF>E3100000001</eNCF>
      <FechaEmision>2026-01-25</FechaEmision>
      <FechaVencimiento>2026-02-25</FechaVencimiento>
    </IdDoc>
    <Emisor>
      <RNCEmisor>133325901</RNCEmisor>
      <RazonSocialEmisor>OKLA S.R.L.</RazonSocialEmisor>
      <DireccionEmisor>Santo Domingo, RD</DireccionEmisor>
      <FechaConstitucion>2024-01-15</FechaConstitucion>
    </Emisor>
    <Receptor>
      <RNCReceptor>101234567</RNCReceptor>
      <RazonSocialReceptor>Auto Dealer ABC S.R.L.</RazonSocialReceptor>
      <DireccionReceptor>Santiago, RD</DireccionReceptor>
    </Receptor>
    <Totales>
      <MontoGravadoI>129.00</MontoGravadoI>
      <ITBIS1>23.22</ITBIS1>
      <TotalITBIS>23.22</TotalITBIS>
      <MontoTotal>152.22</MontoTotal>
    </Totales>
  </Encabezado>
  <DetallesItem>
    <Item>
      <NumeroLinea>1</NumeroLinea>
      <IndicadorFacturacion>1</IndicadorFacturacion>
      <NombreItem>SuscripciÃ³n Plan Pro - Enero 2026</NombreItem>
      <IndicadorBienoServicio>2</IndicadorBienoServicio>
      <CantidadItem>1</CantidadItem>
      <PrecioUnitarioItem>129.00</PrecioUnitarioItem>
      <MontoItem>129.00</MontoItem>
    </Item>
  </DetallesItem>
  <SubTotales>
    <SubTotalGravadoI>129.00</SubTotalGravadoI>
    <SubTotalITBIS>23.22</SubTotalITBIS>
  </SubTotales>
  <DescuentosRecargos />
  <Paginacion>
    <PaginaActual>1</PaginaActual>
    <TotalPaginas>1</TotalPaginas>
  </Paginacion>
  <FechaHoraFirma>2026-01-25T10:30:00</FechaHoraFirma>
</ECF>
```

---

## 6. BASE DE DATOS

### 6.1 Schema para e-CF

```sql
-- Tabla principal de e-CF
CREATE TABLE electronic_invoices (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    ecf_number VARCHAR(20) NOT NULL UNIQUE,  -- E3100000001
    ecf_type INTEGER NOT NULL,                -- 31, 32, 34, etc.
    status VARCHAR(20) NOT NULL DEFAULT 'Draft',

    -- Emisor
    issuer_rnc VARCHAR(15) NOT NULL DEFAULT '133325901',
    issuer_name VARCHAR(200) NOT NULL DEFAULT 'OKLA S.R.L.',

    -- Receptor
    receiver_rnc VARCHAR(15),
    receiver_name VARCHAR(200) NOT NULL,
    receiver_type VARCHAR(20) NOT NULL,  -- Empresa, PersonaFisica, Consumidor
    receiver_email VARCHAR(200),

    -- Montos
    subtotal DECIMAL(18,2) NOT NULL,
    tax_rate DECIMAL(5,2) DEFAULT 18.00,
    tax_amount DECIMAL(18,2) NOT NULL,
    total DECIMAL(18,2) NOT NULL,
    currency VARCHAR(3) DEFAULT 'DOP',

    -- Fechas
    issue_date TIMESTAMP NOT NULL,
    due_date TIMESTAMP,
    dgii_submit_date TIMESTAMP,
    dgii_approval_date TIMESTAMP,

    -- DGII Response
    tracking_number VARCHAR(50),
    approval_code VARCHAR(50),
    dgii_message TEXT,

    -- Documentos
    signed_xml_url TEXT,
    pdf_url TEXT,
    qr_code TEXT,

    -- Referencias
    original_ecf_number VARCHAR(20),  -- Para notas de crÃ©dito
    payment_id UUID,

    -- AuditorÃ­a
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    created_by VARCHAR(100)
);

-- Items del e-CF
CREATE TABLE electronic_invoice_items (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    electronic_invoice_id UUID NOT NULL REFERENCES electronic_invoices(id),
    line_number INTEGER NOT NULL,
    description VARCHAR(500) NOT NULL,
    quantity DECIMAL(18,4) DEFAULT 1,
    unit_price DECIMAL(18,2) NOT NULL,
    tax_amount DECIMAL(18,2) NOT NULL,
    total DECIMAL(18,2) NOT NULL,
    is_service BOOLEAN DEFAULT true
);

-- Secuencias por tipo de e-CF
CREATE TABLE ecf_sequences (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    ecf_type INTEGER NOT NULL UNIQUE,
    current_number INTEGER NOT NULL DEFAULT 0,
    prefix VARCHAR(10) NOT NULL,  -- E31, E32, E34, etc.
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Inicializar secuencias
INSERT INTO ecf_sequences (ecf_type, current_number, prefix) VALUES
(31, 0, 'E31'),  -- CrÃ©dito Fiscal
(32, 0, 'E32'),  -- Consumo
(34, 0, 'E34'),  -- Nota de CrÃ©dito
(47, 0, 'E47'); -- Compras Exterior

-- Ãndices
CREATE INDEX idx_ecf_number ON electronic_invoices(ecf_number);
CREATE INDEX idx_ecf_type ON electronic_invoices(ecf_type);
CREATE INDEX idx_ecf_status ON electronic_invoices(status);
CREATE INDEX idx_ecf_issue_date ON electronic_invoices(issue_date);
CREATE INDEX idx_ecf_receiver_rnc ON electronic_invoices(receiver_rnc);
CREATE INDEX idx_ecf_payment ON electronic_invoices(payment_id);
```

---

## 7. MIGRACIÃ“N DE NCF A e-CF

### 7.1 Plan de MigraciÃ³n

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              PLAN DE MIGRACIÃ“N NCF â†’ e-CF                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  FASE 1: PREPARACIÃ“N (Semanas 1-2)                                      â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                      â”‚
â”‚  â€¢ Obtener certificado digital                                          â”‚
â”‚  â€¢ Configurar ambiente de pruebas DGII                                  â”‚
â”‚  â€¢ Desarrollar ECFService                                               â”‚
â”‚  â€¢ Crear tablas en base de datos                                        â”‚
â”‚                                                                         â”‚
â”‚  FASE 2: DESARROLLO (Semanas 3-4)                                       â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                       â”‚
â”‚  â€¢ Implementar generaciÃ³n de XML                                        â”‚
â”‚  â€¢ Implementar firma digital                                            â”‚
â”‚  â€¢ Integrar con Web Services DGII (pruebas)                             â”‚
â”‚  â€¢ Generar PDFs con QR                                                  â”‚
â”‚                                                                         â”‚
â”‚  FASE 3: PRUEBAS (Semanas 5-6)                                          â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                         â”‚
â”‚  â€¢ Ejecutar 20+ e-CF de cada tipo en ambiente de pruebas                â”‚
â”‚  â€¢ Validar respuestas de DGII                                           â”‚
â”‚  â€¢ Probar flujos de error                                               â”‚
â”‚  â€¢ Probar notas de crÃ©dito                                              â”‚
â”‚                                                                         â”‚
â”‚  FASE 4: CERTIFICACIÃ“N (Semana 7)                                       â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                      â”‚
â”‚  â€¢ Solicitar revisiÃ³n de DGII                                           â”‚
â”‚  â€¢ Corregir observaciones                                               â”‚
â”‚  â€¢ Obtener aprobaciÃ³n                                                   â”‚
â”‚                                                                         â”‚
â”‚  FASE 5: PRODUCCIÃ“N (Semana 8)                                          â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                          â”‚
â”‚  â€¢ Migrar a URLs de producciÃ³n                                          â”‚
â”‚  â€¢ Activar para todas las transacciones                                 â”‚
â”‚  â€¢ Monitorear primeras 100 transacciones                                â”‚
â”‚  â€¢ Desactivar emisiÃ³n de NCF tradicional                                â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 8. ENVÃO AUTOMÃTICO DE REPORTES FISCALES

### 8.1 Reportes con TransmisiÃ³n AutomÃ¡tica

Con la implementaciÃ³n de e-CF, los siguientes reportes se transmiten **automÃ¡ticamente** a la DGII:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          REPORTES CON ENVÃO AUTOMÃTICO A DGII                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  âœ… ENVÃO EN TIEMPO REAL (Cada TransacciÃ³n)                             â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                          â”‚
â”‚                                                                         â”‚
â”‚  ğŸ“„ e-CF Emitidos (E31, E32, E34)                                       â”‚
â”‚     â””â”€â”€ Cada factura â†’ DGII en < 5 segundos                            â”‚
â”‚     â””â”€â”€ ValidaciÃ³n instantÃ¡nea                                         â”‚
â”‚     â””â”€â”€ TrackingNumber como confirmaciÃ³n                               â”‚
â”‚     â””â”€â”€ 0% intervenciÃ³n humana                                         â”‚
â”‚                                                                         â”‚
â”‚  âœ… GENERACIÃ“N AUTOMÃTICA (Mensual - Sin envÃ­o manual)                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                 â”‚
â”‚                                                                         â”‚
â”‚  ğŸ“Š Formato 607 (Ventas y Operaciones)                                  â”‚
â”‚     â””â”€â”€ DGII ya tiene todos los e-CF â†’ Formato 607 PRE-GENERADO        â”‚
â”‚     â””â”€â”€ Solo verificar en Oficina Virtual                              â”‚
â”‚     â””â”€â”€ Tiempo: 5 minutos de revisiÃ³n                                  â”‚
â”‚                                                                         â”‚
â”‚  ğŸ“Š Formato 608 (e-CF Anulados)                                         â”‚
â”‚     â””â”€â”€ Generado automÃ¡ticamente de notas de crÃ©dito (E34)             â”‚
â”‚     â””â”€â”€ DGII consolida anulaciones                                     â”‚
â”‚                                                                         â”‚
â”‚  âœ… ENVÃO ELECTRÃ“NICO (Mensual - Semi-automÃ¡tico)                      â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                      â”‚
â”‚                                                                         â”‚
â”‚  ğŸ“Š Formato 606 (Compras y Gastos)                                      â”‚
â”‚     â””â”€â”€ Sistema genera TXT automÃ¡ticamente                             â”‚
â”‚     â””â”€â”€ EnvÃ­o vÃ­a Web Service DGII                                     â”‚
â”‚     â””â”€â”€ ValidaciÃ³n previa automÃ¡tica                                   â”‚
â”‚                                                                         â”‚
â”‚  ğŸ“Š Formato 609 (Compras del Exterior)                                  â”‚
â”‚     â””â”€â”€ Generado de gastos internacionales (DO, Stripe, etc.)          â”‚
â”‚     â””â”€â”€ EnvÃ­o electrÃ³nico a DGII                                       â”‚
â”‚                                                                         â”‚
â”‚  ğŸ“Š IT-1 (DeclaraciÃ³n ITBIS Mensual)                                    â”‚
â”‚     â””â”€â”€ Pre-llenado desde e-CF + Formato 606                           â”‚
â”‚     â””â”€â”€ CÃ¡lculo: ITBIS cobrado - ITBIS pagado                         â”‚
â”‚     â””â”€â”€ EnvÃ­o electrÃ³nico a DGII                                       â”‚
â”‚                                                                         â”‚
â”‚  ğŸ“Š IR-17 (Retenciones ISR)                                             â”‚
â”‚     â””â”€â”€ Generado de gastos con retenciÃ³n 10%                           â”‚
â”‚     â””â”€â”€ EnvÃ­o electrÃ³nico a DGII                                       â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.2 ImplementaciÃ³n: Servicio de EnvÃ­o AutomÃ¡tico

```csharp
// ECFService.Application/Services/AutomaticReportSubmissionService.cs

public class AutomaticReportSubmissionService : IAutomaticReportSubmissionService
{
    private readonly IDGIIWebService _dgiiService;
    private readonly IFormat606Service _format606Service;
    private readonly IFormat609Service _format609Service;
    private readonly IIT1Service _it1Service;
    private readonly IIR17Service _ir17Service;
    private readonly ILogger<AutomaticReportSubmissionService> _logger;

    /// <summary>
    /// Enviar todos los reportes del mes automÃ¡ticamente
    /// Se ejecuta el dÃ­a 10 de cada mes a las 8:00 AM
    /// </summary>
    public async Task<MonthlyReportResult> SubmitAllMonthlyReportsAsync(int year, int month)
    {
        var result = new MonthlyReportResult { Year = year, Month = month };

        _logger.LogInformation("Iniciando envÃ­o automÃ¡tico de reportes {Year}-{Month}", year, month);

        // 1. Formato 606 (Compras)
        try
        {
            var format606 = await _format606Service.GenerateAsync(year, month);
            var response606 = await _dgiiService.SubmitFormat606Async(format606);
            result.Format606 = new ReportSubmissionResult
            {
                Success = response606.Success,
                TrackingNumber = response606.TrackingNumber,
                SubmittedAt = DateTime.UtcNow
            };
            _logger.LogInformation("Formato 606 enviado: {Success}", response606.Success);
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Error enviando Formato 606");
            result.Format606 = new ReportSubmissionResult { Success = false, Error = ex.Message };
        }

        // 2. Formato 609 (Compras Exterior)
        try
        {
            var format609 = await _format609Service.GenerateAsync(year, month);
            if (format609.HasRecords)
            {
                var response609 = await _dgiiService.SubmitFormat609Async(format609);
                result.Format609 = new ReportSubmissionResult
                {
                    Success = response609.Success,
                    TrackingNumber = response609.TrackingNumber,
                    SubmittedAt = DateTime.UtcNow
                };
            }
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Error enviando Formato 609");
            result.Format609 = new ReportSubmissionResult { Success = false, Error = ex.Message };
        }

        // 3. IT-1 (ITBIS)
        try
        {
            var it1Data = await _it1Service.CalculateAsync(year, month);
            var responseIT1 = await _dgiiService.SubmitIT1Async(it1Data);
            result.IT1 = new ReportSubmissionResult
            {
                Success = responseIT1.Success,
                TrackingNumber = responseIT1.TrackingNumber,
                AmountToPay = it1Data.ITBISToPay,
                SubmittedAt = DateTime.UtcNow
            };
            _logger.LogInformation("IT-1 enviado: ITBIS a pagar = {Amount}", it1Data.ITBISToPay);
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Error enviando IT-1");
            result.IT1 = new ReportSubmissionResult { Success = false, Error = ex.Message };
        }

        // 4. IR-17 (Retenciones)
        try
        {
            var ir17Data = await _ir17Service.GenerateAsync(year, month);
            if (ir17Data.TotalWithheld > 0)
            {
                var responseIR17 = await _dgiiService.SubmitIR17Async(ir17Data);
                result.IR17 = new ReportSubmissionResult
                {
                    Success = responseIR17.Success,
                    TrackingNumber = responseIR17.TrackingNumber,
                    AmountToPay = ir17Data.TotalWithheld,
                    SubmittedAt = DateTime.UtcNow
                };
            }
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Error enviando IR-17");
            result.IR17 = new ReportSubmissionResult { Success = false, Error = ex.Message };
        }

        // 5. Notificar resultado
        await _notificationService.SendMonthlyReportSummaryAsync(result);

        return result;
    }
}
```

### 8.3 Servicio de EnvÃ­o a DGII (Web Services)

```csharp
// ECFService.Infrastructure/Services/DGIIReportWebService.cs

public class DGIIReportWebService : IDGIIReportWebService
{
    private readonly HttpClient _httpClient;
    private readonly IXmlSignatureService _signatureService;
    private readonly DGIISettings _settings;

    private const string BASE_URL_PROD = "https://dgii.gov.do/webservices/";
    private const string BASE_URL_TEST = "https://dgii.gov.do/testwebservices/";

    /// <summary>
    /// Enviar Formato 606 electrÃ³nicamente
    /// </summary>
    public async Task<DGIISubmissionResponse> SubmitFormat606Async(Format606Data data)
    {
        var url = GetBaseUrl() + "WSFormatos606/EnviarFormato606";

        var request = new Format606Request
        {
            RNCDeclarante = "133325901", // OKLA
            Periodo = $"{data.Year}{data.Month:D2}",
            CantidadRegistros = data.Records.Count,
            TotalMontoFacturado = data.TotalAmount,
            TotalITBIS = data.TotalITBIS,
            Registros = data.Records.Select(MapToFormat606Record).ToList()
        };

        var signedXml = await _signatureService.SignAsync(request.ToXml());

        return await SendToWebServiceAsync(url, signedXml);
    }

    /// <summary>
    /// Enviar IT-1 (DeclaraciÃ³n ITBIS) electrÃ³nicamente
    /// </summary>
    public async Task<DGIISubmissionResponse> SubmitIT1Async(IT1Data data)
    {
        var url = GetBaseUrl() + "WSIT1/EnviarDeclaracionIT1";

        var request = new IT1Request
        {
            RNC = "133325901",
            Periodo = $"{data.Year}{data.Month:D2}",
            // Ventas
            VentasBienesGravados = 0, // OKLA no vende bienes fÃ­sicos
            VentasServiciosGravados = data.TotalSalesBeforeTax,
            ITBISCobrado = data.ITBISCollected,
            // Compras
            ComprasBienesGravados = data.PurchasesGoods,
            ComprasServiciosGravados = data.PurchasesServices,
            ITBISPagado = data.ITBISPaid,
            // CÃ¡lculo
            ITBISNeto = data.ITBISCollected - data.ITBISPaid,
            ITBISAPagar = Math.Max(0, data.ITBISCollected - data.ITBISPaid),
            SaldoAFavor = Math.Max(0, data.ITBISPaid - data.ITBISCollected)
        };

        var signedXml = await _signatureService.SignAsync(request.ToXml());

        return await SendToWebServiceAsync(url, signedXml);
    }

    /// <summary>
    /// Enviar IR-17 (Retenciones) electrÃ³nicamente
    /// </summary>
    public async Task<DGIISubmissionResponse> SubmitIR17Async(IR17Data data)
    {
        var url = GetBaseUrl() + "WSIR17/EnviarDeclaracionIR17";

        var request = new IR17Request
        {
            RNCAgente = "133325901",
            Periodo = $"{data.Year}{data.Month:D2}",
            // Retenciones realizadas
            RetencionesServicios = data.WithholdingsServices, // 10%
            RetencionesAlquileres = data.WithholdingsRent,     // 10%
            TotalRetenido = data.TotalWithheld,
            // Detalle por proveedor
            Detalle = data.Details.Select(d => new IR17DetailRecord
            {
                RNCRetenido = d.SupplierRNC,
                NombreRetenido = d.SupplierName,
                TipoRetencion = d.Type,
                MontoSujeto = d.BaseAmount,
                MontoRetenido = d.WithheldAmount
            }).ToList()
        };

        var signedXml = await _signatureService.SignAsync(request.ToXml());

        return await SendToWebServiceAsync(url, signedXml);
    }

    /// <summary>
    /// Enviar Formato 609 (Compras Exterior) electrÃ³nicamente
    /// </summary>
    public async Task<DGIISubmissionResponse> SubmitFormat609Async(Format609Data data)
    {
        var url = GetBaseUrl() + "WSFormatos609/EnviarFormato609";

        var request = new Format609Request
        {
            RNCDeclarante = "133325901",
            Periodo = $"{data.Year}{data.Month:D2}",
            CantidadRegistros = data.Records.Count,
            TotalMontoPagado = data.TotalAmount,
            // Detalle de pagos internacionales
            Registros = data.Records.Select(r => new Format609Record
            {
                IdentificacionProveedor = r.ProviderIdentification,
                NombreProveedor = r.ProviderName,
                PaisProveedor = r.Country,
                FechaPago = r.PaymentDate,
                TipoServicio = r.ServiceType,
                MontoUSD = r.AmountUSD,
                MontoDOP = r.AmountDOP,
                TasaCambio = r.ExchangeRate
            }).ToList()
        };

        var signedXml = await _signatureService.SignAsync(request.ToXml());

        return await SendToWebServiceAsync(url, signedXml);
    }

    private async Task<DGIISubmissionResponse> SendToWebServiceAsync(string url, string signedXml)
    {
        try
        {
            var content = new StringContent(signedXml, Encoding.UTF8, "application/xml");
            var response = await _httpClient.PostAsync(url, content);
            var responseBody = await response.Content.ReadAsStringAsync();

            return ParseResponse(responseBody);
        }
        catch (Exception ex)
        {
            return new DGIISubmissionResponse
            {
                Success = false,
                ErrorCode = "CONNECTION_ERROR",
                ErrorMessage = ex.Message
            };
        }
    }
}
```

### 8.4 Job Programado para EnvÃ­o Mensual

```csharp
// ECFService.Api/Jobs/MonthlyReportSubmissionJob.cs

public class MonthlyReportSubmissionJob : IJob
{
    private readonly IAutomaticReportSubmissionService _submissionService;
    private readonly ILogger<MonthlyReportSubmissionJob> _logger;

    /// <summary>
    /// Se ejecuta el dÃ­a 10 de cada mes a las 8:00 AM
    /// Cron: 0 8 10 * *
    /// </summary>
    public async Task Execute(IJobExecutionContext context)
    {
        // Enviar reportes del mes anterior
        var targetDate = DateTime.Today.AddMonths(-1);
        var year = targetDate.Year;
        var month = targetDate.Month;

        _logger.LogInformation("Ejecutando envÃ­o automÃ¡tico de reportes para {Year}-{Month}", year, month);

        var result = await _submissionService.SubmitAllMonthlyReportsAsync(year, month);

        _logger.LogInformation(
            "EnvÃ­o completado: 606={F606}, 609={F609}, IT1={IT1}, IR17={IR17}",
            result.Format606?.Success,
            result.Format609?.Success,
            result.IT1?.Success,
            result.IR17?.Success
        );
    }
}

// ConfiguraciÃ³n en Program.cs
services.AddQuartz(q =>
{
    q.AddJob<MonthlyReportSubmissionJob>(opts => opts.WithIdentity("monthly-report-submission"));
    q.AddTrigger(opts => opts
        .ForJob("monthly-report-submission")
        .WithIdentity("monthly-report-submission-trigger")
        .WithCronSchedule("0 8 10 * * ?")); // DÃ­a 10, 8:00 AM
});
```

### 8.5 Resumen de AutomatizaciÃ³n

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              RESUMEN: ESFUERZO MANUAL CON e-CF                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  REPORTE          â”‚ ANTES (NCF)      â”‚ AHORA (e-CF)                    â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                   â”‚                  â”‚                                  â”‚
â”‚  EmisiÃ³n factura  â”‚ 5 min/factura    â”‚ 0 segundos (automÃ¡tico)         â”‚
â”‚  Formato 607      â”‚ 2-4 horas/mes    â”‚ 5 min verificaciÃ³n              â”‚
â”‚  Formato 608      â”‚ 1 hora/mes       â”‚ 0 min (automÃ¡tico)              â”‚
â”‚  Formato 606      â”‚ 2-4 horas/mes    â”‚ 10 min revisiÃ³n                 â”‚
â”‚  Formato 609      â”‚ 1-2 horas/mes    â”‚ 0 min (automÃ¡tico)              â”‚
â”‚  IT-1 ITBIS       â”‚ 1-2 horas/mes    â”‚ 5 min verificaciÃ³n              â”‚
â”‚  IR-17 Retenc.    â”‚ 1-2 horas/mes    â”‚ 5 min verificaciÃ³n              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  TOTAL MENSUAL    â”‚ 10-15 horas      â”‚ ~30 minutos                     â”‚
â”‚                   â”‚                  â”‚                                  â”‚
â”‚  AHORRO: 95% DEL TIEMPO ğŸ‰                                             â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 9. MONITOREO Y ALERTAS

### 9.1 Dashboard de e-CF

```typescript
// frontend/web/src/pages/admin/ECFDashboard.tsx

export const ECFDashboard = () => {
  const { data: stats } = useQuery({
    queryKey: ['ecf-stats'],
    queryFn: () => ecfService.getStats()
  });

  return (
    <div className="p-6 space-y-6">
      <h1 className="text-3xl font-bold">FacturaciÃ³n ElectrÃ³nica</h1>

      {/* EstadÃ­sticas del dÃ­a */}
      <div className="grid grid-cols-4 gap-4">
        <StatCard
          title="e-CF Emitidos Hoy"
          value={stats?.todayCount}
          icon={<FileText />}
        />
        <StatCard
          title="Aprobados"
          value={stats?.approvedCount}
          icon={<CheckCircle className="text-green-500" />}
        />
        <StatCard
          title="Rechazados"
          value={stats?.rejectedCount}
          icon={<XCircle className="text-red-500" />}
          alert={stats?.rejectedCount > 0}
        />
        <StatCard
          title="Monto Total"
          value={formatCurrency(stats?.totalAmount)}
          icon={<DollarSign />}
        />
      </div>

      {/* Alertas */}
      {stats?.rejectedCount > 0 && (
        <Alert variant="destructive">
          <AlertTitle>e-CF Rechazados</AlertTitle>
          <AlertDescription>
            Hay {stats.rejectedCount} e-CF rechazados por DGII que requieren atenciÃ³n.
            <Button variant="link" onClick={() => navigate('/admin/ecf/rejected')}>
              Ver detalles
            </Button>
          </AlertDescription>
        </Alert>
      )}

      {/* Lista de e-CF recientes */}
      <Card>
        <CardHeader>
          <CardTitle>Ãšltimos e-CF Emitidos</CardTitle>
        </CardHeader>
        <CardContent>
          <ECFTable data={stats?.recentECFs} />
        </CardContent>
      </Card>
    </div>
  );
};
```

---

## ğŸ“‹ CHECKLIST DE IMPLEMENTACIÃ“N

### Pre-requisitos

- [ ] Certificado digital obtenido
- [ ] Acceso a ambiente de pruebas DGII
- [ ] Credenciales de Web Services

### Backend

- [ ] ECFService microservicio creado
- [ ] Entidades y DTOs definidos
- [ ] Repositorios implementados
- [ ] Generador de XML implementado
- [ ] Firma digital implementada
- [ ] IntegraciÃ³n DGII implementada
- [ ] Generador de PDF con QR
- [ ] Event handlers para PaymentCompleted

### Base de Datos

- [ ] Tablas creadas
- [ ] Secuencias inicializadas
- [ ] Ãndices creados

### Frontend

- [ ] Dashboard de e-CF
- [ ] Visualizador de e-CF
- [ ] GestiÃ³n de rechazados
- [ ] Reportes

### Pruebas

- [ ] 20+ E31 enviados a DGII pruebas
- [ ] 20+ E32 enviados a DGII pruebas
- [ ] 10+ E34 enviados a DGII pruebas
- [ ] Flujos de error probados
- [ ] CertificaciÃ³n DGII obtenida

### ProducciÃ³n

- [ ] URLs de producciÃ³n configuradas
- [ ] Monitoreo activo
- [ ] Alertas configuradas

---

**Documento creado:** Enero 25, 2026  
**PrÃ³xima revisiÃ³n:** Antes de implementaciÃ³n  
**Responsable:** Equipo de Desarrollo + Contador
