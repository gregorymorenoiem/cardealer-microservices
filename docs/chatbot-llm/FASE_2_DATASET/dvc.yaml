# R19 (MLOps): DVC pipeline definition for dataset generation reproducibility.
# Run with: dvc repro
# This ensures the exact same dataset can be regenerated from the same code.

stages:
  generate_dataset:
    cmd: python generate_dataset.py --seed 42 --num-conversations 3000 --output output
    deps:
      - generate_dataset.py
      - conversation_templates.py
    outs:
      - output/train.jsonl
      - output/validation.jsonl
      - output/test.jsonl
    metrics:
      - output/dataset_manifest.json:
          cache: false
    params:
      - params.yaml:
          - seed
          - num_conversations
          - train_ratio
          - val_ratio

  validate_dataset:
    cmd: python -c "
      import json;
      manifest = json.load(open('output/dataset_manifest.json'));
      assert manifest['total_conversations'] >= 2500, f'Too few conversations: {manifest[\"total_conversations\"]}';
      assert manifest['intent_count'] >= 30, f'Too few intents: {manifest[\"intent_count\"]}';
      print(f'âœ… Dataset validated: {manifest[\"total_conversations\"]} conversations, {manifest[\"intent_count\"]} intents');
      "
    deps:
      - output/dataset_manifest.json
