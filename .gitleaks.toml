# =============================================================================
# Gitleaks Configuration - OKLA Microservices
# Custom rules for detecting secrets specific to our tech stack
# =============================================================================

title = "OKLA Gitleaks Config"

[allowlist]
  description = "Global allowlist"
  paths = [
    '''node_modules''',
    '''\.git''',
    '''bin/Debug''',
    '''bin/Release''',
    '''obj/''',
    '''_DESCARTADOS/''',
    '''\.github/copilot-instructions\.md''',
    '''docs/''',
    '''\.md$''',
  ]
  regexTarget = "match"
  regexes = [
    # Allow placeholder env var patterns
    '''\$\{[A-Z_]+\}''',
    # Allow development defaults that are not real secrets
    '''Password=postgres''',
    '''Password=password''',
    '''Password=devpassword''',
    '''Password=guest''',
    '''clave-super-secreta-desarrollo''',
  ]

[[rules]]
  id = "sendgrid-api-key"
  description = "SendGrid API Key"
  regex = '''SG\.[a-zA-Z0-9_-]{22,}\.[a-zA-Z0-9_-]{22,}'''
  tags = ["api-key", "sendgrid"]

[[rules]]
  id = "resend-api-key"
  description = "Resend API Key"
  regex = '''re_[a-zA-Z0-9]{20,}'''
  tags = ["api-key", "resend"]

[[rules]]
  id = "stripe-secret-key"
  description = "Stripe Secret Key"
  regex = '''sk_(live|test)_[a-zA-Z0-9]{20,}'''
  tags = ["api-key", "stripe"]

[[rules]]
  id = "twilio-account-sid"
  description = "Twilio Account SID"
  regex = '''AC[a-f0-9]{32}'''
  tags = ["api-key", "twilio"]

[[rules]]
  id = "jwt-hardcoded-key"
  description = "Hardcoded JWT signing key (non-placeholder)"
  regex = '''["']([A-Za-z0-9+/=]{32,})["']'''
  tags = ["jwt", "secret"]
  [rules.allowlist]
    regexes = [
      '''\$\{''',
      '''clave-super-secreta''',
    ]

[[rules]]
  id = "connection-string-password"
  description = "Database connection string with real password"
  regex = '''Password=(?!postgres|password|devpassword|guest|\$\{)[^\s;]+'''
  tags = ["database", "password"]
  [rules.allowlist]
    paths = [
      '''appsettings\.Development\.json''',
      '''appsettings\.Docker\.json''',
    ]
