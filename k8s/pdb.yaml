# =============================================================================
# POD DISRUPTION BUDGET (PDB) â€” Alta Disponibilidad
# =============================================================================
# Garantiza que SIEMPRE haya pods disponibles durante:
#   - Rolling updates (kubectl rollout restart)
#   - Node drains (maintenance, cluster upgrades)
#   - Spot instance reclaims (si se usan nodos spot)
#
# REGLAS:
#   ğŸ”´ CRITICAL (minReplicas=2): minAvailable=1 (50% siempre up)
#   ğŸŸ  IMPORTANT: minAvailable=1
#   ğŸ”µ INTERNAL: maxUnavailable=1 (mÃ¡s flexible)
# =============================================================================

---
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸ”´ CRITICAL â€” Siempre mantener al menos 1 pod (mÃ­nimo 2 rÃ©plicas)
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  name: frontend-web-pdb
  namespace: okla
  labels:
    tier: critical
spec:
  minAvailable: 1
  selector:
    matchLabels:
      app: frontend-web

---
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  name: gateway-pdb
  namespace: okla
  labels:
    tier: critical
spec:
  minAvailable: 1
  selector:
    matchLabels:
      app: gateway

---
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  name: authservice-pdb
  namespace: okla
  labels:
    tier: critical
spec:
  minAvailable: 1
  selector:
    matchLabels:
      app: authservice

---
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  name: vehiclessaleservice-pdb
  namespace: okla
  labels:
    tier: critical
spec:
  minAvailable: 1
  selector:
    matchLabels:
      app: vehiclessaleservice

---
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  name: billingservice-pdb
  namespace: okla
  labels:
    tier: critical
spec:
  minAvailable: 1
  selector:
    matchLabels:
      app: billingservice

---
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸŸ  IMPORTANT â€” Mantener al menos 1 pod disponible
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  name: userservice-pdb
  namespace: okla
  labels:
    tier: important
spec:
  maxUnavailable: 1 # maxUnavailable en vez de minAvailable â€” permite node drains con 1 rÃ©plica
  selector:
    matchLabels:
      app: userservice

---
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  name: roleservice-pdb
  namespace: okla
  labels:
    tier: important
spec:
  maxUnavailable: 1 # maxUnavailable â€” permite node drains con 1 rÃ©plica
  selector:
    matchLabels:
      app: roleservice

---
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  name: mediaservice-pdb
  namespace: okla
  labels:
    tier: important
spec:
  maxUnavailable: 1 # maxUnavailable â€” permite node drains con 1 rÃ©plica
  selector:
    matchLabels:
      app: mediaservice

---
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  name: notificationservice-pdb
  namespace: okla
  labels:
    tier: important
spec:
  maxUnavailable: 1 # maxUnavailable â€” permite node drains con 1 rÃ©plica
  selector:
    matchLabels:
      app: notificationservice

---
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  name: kycservice-pdb
  namespace: okla
  labels:
    tier: important
spec:
  maxUnavailable: 1 # maxUnavailable â€” permite node drains con 1 rÃ©plica
  selector:
    matchLabels:
      app: kycservice

---
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  name: contactservice-pdb
  namespace: okla
  labels:
    tier: important
spec:
  maxUnavailable: 1 # maxUnavailable â€” permite node drains con 1 rÃ©plica
  selector:
    matchLabels:
      app: contactservice

---
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  name: adminservice-pdb
  namespace: okla
  labels:
    tier: important
spec:
  maxUnavailable: 1 # maxUnavailable â€” permite node drains con 1 rÃ©plica
  selector:
    matchLabels:
      app: adminservice

---
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸ”µ INTERNAL â€” MÃ¡s flexible, permite 1 pod unavailable
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  name: errorservice-pdb
  namespace: okla
  labels:
    tier: internal
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app: errorservice

---
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  name: auditservice-pdb
  namespace: okla
  labels:
    tier: internal
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app: auditservice

---
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  name: idempotencyservice-pdb
  namespace: okla
  labels:
    tier: internal
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app: idempotencyservice
