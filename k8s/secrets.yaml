# =============================================================================
# SECRETS - Sensitive Configuration (Use External Secrets in Production!)
# =============================================================================
# ⚠️ IMPORTANTE: En producción, usa:
#   - Digital Ocean Managed Secrets
#   - External Secrets Operator
#   - HashiCorp Vault
# =============================================================================

---
apiVersion: v1
kind: Secret
metadata:
  name: database-secrets
  namespace: okla
type: Opaque
stringData:
  # PostgreSQL (Use DO Managed Database in production)
  POSTGRES_HOST: "db-postgresql-nyc1-okla-do-user.db.ondigitalocean.com"
  POSTGRES_PORT: "25060"
  POSTGRES_USER: "doadmin"
  POSTGRES_PASSWORD: "${POSTGRES_PASSWORD}" # Replace with actual or use sealed secrets
  POSTGRES_SSL_MODE: "require"

---
apiVersion: v1
kind: Secret
metadata:
  name: jwt-secrets
  namespace: okla
type: Opaque
stringData:
  Jwt__Key: "DpItyXBLcJG5x6vuN5EVF629jYOG0iRlYPeUH01zGlpP/b0HyxE5eoAR8XzLunNxx/TSVZJNfQkKng4Ztj4ygg=="
  Jwt__Issuer: "OklaService-Prod"
  Jwt__Audience: "Okla-App"
  Jwt__ExpiresMinutes: "60"
  Jwt__RefreshTokenExpiresDays: "7"

---
apiVersion: v1
kind: Secret
metadata:
  name: redis-secrets
  namespace: okla
type: Opaque
stringData:
  REDIS_PASSWORD: "${REDIS_PASSWORD}"

---
apiVersion: v1
kind: Secret
metadata:
  name: rabbitmq-secrets
  namespace: okla
type: Opaque
stringData:
  RABBITMQ_USERNAME: "okla"
  RABBITMQ_PASSWORD: "${RABBITMQ_PASSWORD}"

---
apiVersion: v1
kind: Secret
metadata:
  name: external-services-secrets
  namespace: okla
type: Opaque
stringData:
  # Stripe
  STRIPE_SECRET_KEY: "${STRIPE_SECRET_KEY}"
  STRIPE_WEBHOOK_SECRET: "${STRIPE_WEBHOOK_SECRET}"

  # SendGrid
  SENDGRID_API_KEY: "${SENDGRID_API_KEY}"

  # Twilio
  TWILIO_ACCOUNT_SID: "${TWILIO_ACCOUNT_SID}"
  TWILIO_AUTH_TOKEN: "${TWILIO_AUTH_TOKEN}"

  # AWS S3 (for media storage)
  AWS_ACCESS_KEY_ID: "${AWS_ACCESS_KEY_ID}"
  AWS_SECRET_ACCESS_KEY: "${AWS_SECRET_ACCESS_KEY}"
  AWS_S3_BUCKET: "okla-media"
  AWS_REGION: "us-east-1"

  # Google OAuth
  GOOGLE_CLIENT_ID: "${GOOGLE_CLIENT_ID}"
  GOOGLE_CLIENT_SECRET: "${GOOGLE_CLIENT_SECRET}"

---
apiVersion: v1
kind: Secret
metadata:
  name: registry-credentials
  namespace: okla
type: kubernetes.io/dockerconfigjson
data:
  .dockerconfigjson: "${DOCKER_CONFIG_JSON}" # Base64 encoded docker config

---
# =============================================================================
# SERVICE-SPECIFIC DATABASE SECRETS
# =============================================================================
apiVersion: v1
kind: Secret
metadata:
  name: reviewservice-db-secret
  namespace: okla
  labels:
    app: reviewservice
    tier: backend
    sprint: "14"
type: Opaque
stringData:
  ConnectionStrings__DefaultConnection: "Host=${POSTGRES_HOST};Port=${POSTGRES_PORT};Database=reviewservice;Username=${POSTGRES_USER};Password=${POSTGRES_PASSWORD};SSL Mode=Require;Trust Server Certificate=true"
  ConnectionStrings__RedisConnection: "redis://:${REDIS_PASSWORD}@redis:6379"
