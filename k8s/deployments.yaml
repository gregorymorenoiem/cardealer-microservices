# =============================================================================
# MVP SELF-MANAGED - Deployments (Hardened)
# =============================================================================
# Security: securityContext, readOnlyRootFilesystem, non-root, drop ALL caps
# Image tags: Use CI/CD variable latest ‚Äî never :latest in production
# Probes: Separate startup/liveness/readiness for graceful handling
# ServiceAccounts: Dedicated accounts with minimal permissions
# =============================================================================
#
# CLUSTER INFO (Feb 2026):
# Current cluster: 2√ó s-4vcpu-8gb nodes (~12GB allocatable, autoscale to 3).
# Pool name: okla-pool-upgraded
# 14 core services run with replicas: 1.
# 28 services without Docker images are set to replicas: 0.
# 2 services (adminservice, contactservice) disabled due to startup bugs.
# To enable services after building images:
#   kubectl scale deployment/<name> --replicas=1 -n okla
# =============================================================================

---
# =============================================================================
# FRONTEND WEB ‚Äî Staging: 1 replica (scale to 2 for production HA)
# =============================================================================
apiVersion: apps/v1
kind: Deployment
metadata:
  name: frontend-web
  namespace: okla
  labels:
    app: frontend-web
    tier: frontend
spec:
  replicas: 1
  strategy:
    type: RollingUpdate
    rollingUpdate:
      maxSurge: 1
      maxUnavailable: 0
  selector:
    matchLabels:
      app: frontend-web
  template:
    metadata:
      labels:
        app: frontend-web
    spec:
      serviceAccountName: okla-frontend
      automountServiceAccountToken: false
      topologySpreadConstraints:
        - maxSkew: 1
          topologyKey: kubernetes.io/hostname
          whenUnsatisfiable: ScheduleAnyway
          labelSelector:
            matchLabels:
              app: frontend-web
      imagePullSecrets:
        - name: registry-credentials
      containers:
        - name: frontend-web
          image: ghcr.io/gregorymorenoiem/frontend-web:latest
          ports:
            - containerPort: 8080
          env:
            # BFF pattern: INTERNAL_API_URL is the server-side-only URL for SSR ‚Üí Gateway calls
            # This is NOT exposed to the browser (not NEXT_PUBLIC_)
            - name: INTERNAL_API_URL
              value: "http://gateway:8080"
            - name: NODE_ENV
              value: "production"
            - name: RUNTIME_APP_VERSION
              value: "1.0.0"
          resources:
            requests:
              memory: "128Mi"
              cpu: "50m"
            limits:
              memory: "256Mi"
              cpu: "200m"
          securityContext:
            allowPrivilegeEscalation: false
            readOnlyRootFilesystem: false
            capabilities:
              drop:
                - ALL
          startupProbe:
            httpGet:
              path: /
              port: 8080
            initialDelaySeconds: 5
            periodSeconds: 5
            failureThreshold: 12
          livenessProbe:
            httpGet:
              path: /
              port: 8080
            periodSeconds: 30
            timeoutSeconds: 5
            failureThreshold: 3
          readinessProbe:
            httpGet:
              path: /
              port: 8080
            periodSeconds: 10
            timeoutSeconds: 5
            failureThreshold: 3
          volumeMounts:
            - name: tmp
              mountPath: /tmp
      volumes:
        - name: tmp
          emptyDir: {}

---
# =============================================================================
# GATEWAY ‚Äî üî¥ CRITICAL: minReplicas=2 para HA
# =============================================================================
apiVersion: apps/v1
kind: Deployment
metadata:
  name: gateway
  namespace: okla
  labels:
    app: gateway
    tier: backend
spec:
  replicas: 1
  strategy:
    type: RollingUpdate
    rollingUpdate:
      maxSurge: 1
      maxUnavailable: 0
  selector:
    matchLabels:
      app: gateway
  template:
    metadata:
      labels:
        app: gateway
    spec:
      serviceAccountName: okla-backend
      automountServiceAccountToken: false
      topologySpreadConstraints:
        - maxSkew: 1
          topologyKey: kubernetes.io/hostname
          whenUnsatisfiable: ScheduleAnyway
          labelSelector:
            matchLabels:
              app: gateway
      imagePullSecrets:
        - name: registry-credentials
      containers:
        - name: gateway
          image: ghcr.io/gregorymorenoiem/gateway:latest
          ports:
            - containerPort: 8080
          env:
            - name: ASPNETCORE_URLS
              value: "http://+:8080"
          envFrom:
            - configMapRef:
                name: global-config
            - secretRef:
                name: jwt-secrets
            - secretRef:
                name: rabbitmq-secrets
            - secretRef:
                name: redis-secrets
          resources:
            requests:
              memory: "64Mi"
              cpu: "25m"
            limits:
              memory: "192Mi"
              cpu: "150m"
          securityContext:
            allowPrivilegeEscalation: false
            readOnlyRootFilesystem: true
            capabilities:
              drop:
                - ALL
          startupProbe:
            httpGet:
              path: /health
              port: 8080
            initialDelaySeconds: 10
            periodSeconds: 5
            failureThreshold: 24
          livenessProbe:
            httpGet:
              path: /health
              port: 8080
            periodSeconds: 30
            timeoutSeconds: 10
            failureThreshold: 3
          readinessProbe:
            httpGet:
              path: /health
              port: 8080
            periodSeconds: 15
            timeoutSeconds: 10
            failureThreshold: 3
          volumeMounts:
            - name: ocelot-config
              mountPath: /app/ocelot.prod.json
              subPath: ocelot.json
            - name: tmp
              mountPath: /tmp
      volumes:
        - name: ocelot-config
          configMap:
            name: gateway-config
        - name: tmp
          emptyDir: {}

---
# =============================================================================
# AUTH SERVICE ‚Äî üî¥ CRITICAL: minReplicas=2 para HA
# =============================================================================
apiVersion: apps/v1
kind: Deployment
metadata:
  name: authservice
  namespace: okla
  labels:
    app: authservice
    tier: backend
spec:
  replicas: 1
  strategy:
    type: RollingUpdate
    rollingUpdate:
      maxSurge: 1
      maxUnavailable: 0
  selector:
    matchLabels:
      app: authservice
  template:
    metadata:
      labels:
        app: authservice
    spec:
      serviceAccountName: okla-backend
      automountServiceAccountToken: false
      topologySpreadConstraints:
        - maxSkew: 1
          topologyKey: kubernetes.io/hostname
          whenUnsatisfiable: ScheduleAnyway
          labelSelector:
            matchLabels:
              app: authservice
      imagePullSecrets:
        - name: registry-credentials
      containers:
        - name: authservice
          image: ghcr.io/gregorymorenoiem/authservice:latest
          ports:
            - containerPort: 8080
          env:
            - name: ASPNETCORE_URLS
              value: "http://+:8080"
          envFrom:
            - configMapRef:
                name: global-config
            - secretRef:
                name: authservice-db-secret
            - secretRef:
                name: jwt-secrets
            - secretRef:
                name: redis-secrets
            - secretRef:
                name: rabbitmq-secrets
          resources:
            requests:
              memory: "256Mi"
              cpu: "100m"
            limits:
              memory: "512Mi"
              cpu: "400m"
          securityContext:
            runAsNonRoot: true
            runAsUser: 1000
            allowPrivilegeEscalation: false
            readOnlyRootFilesystem: true
            capabilities:
              drop:
                - ALL
          startupProbe:
            httpGet:
              path: /health/live
              port: 8080
            initialDelaySeconds: 10
            periodSeconds: 5
            failureThreshold: 24
          livenessProbe:
            httpGet:
              path: /health/live
              port: 8080
            periodSeconds: 30
            timeoutSeconds: 5
            failureThreshold: 3
          readinessProbe:
            httpGet:
              path: /health/ready
              port: 8080
            periodSeconds: 10
            timeoutSeconds: 5
            failureThreshold: 3
          volumeMounts:
            - name: tmp
              mountPath: /tmp
      volumes:
        - name: tmp
          emptyDir: {}

---
# =============================================================================
# USER SERVICE
# =============================================================================
apiVersion: apps/v1
kind: Deployment
metadata:
  name: userservice
  namespace: okla
  labels:
    app: userservice
    tier: backend
spec:
  replicas: 1
  selector:
    matchLabels:
      app: userservice
  template:
    metadata:
      labels:
        app: userservice
    spec:
      serviceAccountName: okla-backend
      automountServiceAccountToken: false
      topologySpreadConstraints:
        - maxSkew: 1
          topologyKey: kubernetes.io/hostname
          whenUnsatisfiable: ScheduleAnyway
          labelSelector:
            matchLabels:
              app: userservice
      imagePullSecrets:
        - name: registry-credentials
      containers:
        - name: userservice
          image: ghcr.io/gregorymorenoiem/userservice:latest
          ports:
            - containerPort: 8080
          env:
            - name: ASPNETCORE_URLS
              value: "http://+:8080"
          envFrom:
            - configMapRef:
                name: global-config
            - secretRef:
                name: userservice-db-secret
            - secretRef:
                name: jwt-secrets
            - secretRef:
                name: redis-secrets
            - secretRef:
                name: rabbitmq-secrets
          resources:
            requests:
              memory: "128Mi"
              cpu: "50m"
            limits:
              memory: "256Mi"
              cpu: "200m"
          securityContext:
            runAsNonRoot: true
            runAsUser: 1000
            allowPrivilegeEscalation: false
            readOnlyRootFilesystem: true
            capabilities:
              drop:
                - ALL
          startupProbe:
            httpGet:
              path: /health
              port: 8080
            initialDelaySeconds: 10
            periodSeconds: 5
            failureThreshold: 24
          livenessProbe:
            httpGet:
              path: /health
              port: 8080
            periodSeconds: 30
            timeoutSeconds: 10
            failureThreshold: 3
          readinessProbe:
            httpGet:
              path: /health
              port: 8080
            periodSeconds: 15
            timeoutSeconds: 10
            failureThreshold: 3
          volumeMounts:
            - name: tmp
              mountPath: /tmp
      volumes:
        - name: tmp
          emptyDir: {}

---
# =============================================================================
# ROLE SERVICE
# =============================================================================
apiVersion: apps/v1
kind: Deployment
metadata:
  name: roleservice
  namespace: okla
  labels:
    app: roleservice
    tier: backend
spec:
  replicas: 1
  selector:
    matchLabels:
      app: roleservice
  template:
    metadata:
      labels:
        app: roleservice
    spec:
      serviceAccountName: okla-backend
      automountServiceAccountToken: false
      topologySpreadConstraints:
        - maxSkew: 1
          topologyKey: kubernetes.io/hostname
          whenUnsatisfiable: ScheduleAnyway
          labelSelector:
            matchLabels:
              app: roleservice
      imagePullSecrets:
        - name: registry-credentials
      containers:
        - name: roleservice
          image: ghcr.io/gregorymorenoiem/roleservice:latest
          ports:
            - containerPort: 8080
          env:
            - name: ASPNETCORE_URLS
              value: "http://+:8080"
          envFrom:
            - configMapRef:
                name: global-config
            - secretRef:
                name: roleservice-db-secret
            - secretRef:
                name: jwt-secrets
            - secretRef:
                name: redis-secrets
            - secretRef:
                name: rabbitmq-secrets
          resources:
            requests:
              memory: "128Mi"
              cpu: "50m"
            limits:
              memory: "256Mi"
              cpu: "200m"
          securityContext:
            runAsNonRoot: true
            runAsUser: 1000
            allowPrivilegeEscalation: false
            readOnlyRootFilesystem: true
            capabilities:
              drop:
                - ALL
          startupProbe:
            httpGet:
              path: /health
              port: 8080
            initialDelaySeconds: 10
            periodSeconds: 5
            failureThreshold: 24
          livenessProbe:
            httpGet:
              path: /health
              port: 8080
            periodSeconds: 30
            timeoutSeconds: 10
            failureThreshold: 3
          readinessProbe:
            httpGet:
              path: /health
              port: 8080
            periodSeconds: 15
            timeoutSeconds: 10
            failureThreshold: 3
          volumeMounts:
            - name: tmp
              mountPath: /tmp
      volumes:
        - name: tmp
          emptyDir: {}

---
# =============================================================================
# VEHICLES SALE SERVICE ‚Äî üî¥ CRITICAL: minReplicas=2 para HA
# =============================================================================
apiVersion: apps/v1
kind: Deployment
metadata:
  name: vehiclessaleservice
  namespace: okla
  labels:
    app: vehiclessaleservice
    tier: backend
spec:
  replicas: 1
  strategy:
    type: RollingUpdate
    rollingUpdate:
      maxSurge: 1
      maxUnavailable: 0
  selector:
    matchLabels:
      app: vehiclessaleservice
  template:
    metadata:
      labels:
        app: vehiclessaleservice
    spec:
      serviceAccountName: okla-backend
      automountServiceAccountToken: false
      topologySpreadConstraints:
        - maxSkew: 1
          topologyKey: kubernetes.io/hostname
          whenUnsatisfiable: ScheduleAnyway
          labelSelector:
            matchLabels:
              app: vehiclessaleservice
      imagePullSecrets:
        - name: registry-credentials
      containers:
        - name: vehiclessaleservice
          image: ghcr.io/gregorymorenoiem/vehiclessaleservice:latest
          ports:
            - containerPort: 8080
          env:
            - name: ASPNETCORE_URLS
              value: "http://+:8080"
          envFrom:
            - configMapRef:
                name: global-config
            - secretRef:
                name: vehiclessaleservice-db-secret
            - secretRef:
                name: jwt-secrets
            - secretRef:
                name: redis-secrets
            - secretRef:
                name: rabbitmq-secrets
          resources:
            requests:
              memory: "128Mi"
              cpu: "50m"
            limits:
              memory: "256Mi"
              cpu: "200m"
          securityContext:
            runAsNonRoot: true
            runAsUser: 1000
            allowPrivilegeEscalation: false
            readOnlyRootFilesystem: true
            capabilities:
              drop:
                - ALL
          startupProbe:
            httpGet:
              path: /health
              port: 8080
            initialDelaySeconds: 10
            periodSeconds: 5
            failureThreshold: 24
          livenessProbe:
            httpGet:
              path: /health
              port: 8080
            periodSeconds: 30
            timeoutSeconds: 10
            failureThreshold: 3
          readinessProbe:
            httpGet:
              path: /health
              port: 8080
            periodSeconds: 15
            timeoutSeconds: 10
            failureThreshold: 3
          volumeMounts:
            - name: tmp
              mountPath: /tmp
      volumes:
        - name: tmp
          emptyDir: {}

---
# =============================================================================
# MEDIA SERVICE
# =============================================================================
apiVersion: apps/v1
kind: Deployment
metadata:
  name: mediaservice
  namespace: okla
  labels:
    app: mediaservice
    tier: backend
spec:
  replicas: 1
  selector:
    matchLabels:
      app: mediaservice
  template:
    metadata:
      labels:
        app: mediaservice
    spec:
      serviceAccountName: okla-backend
      automountServiceAccountToken: false
      topologySpreadConstraints:
        - maxSkew: 1
          topologyKey: kubernetes.io/hostname
          whenUnsatisfiable: ScheduleAnyway
          labelSelector:
            matchLabels:
              app: mediaservice
      imagePullSecrets:
        - name: registry-credentials
      containers:
        - name: mediaservice
          image: ghcr.io/gregorymorenoiem/mediaservice:latest
          ports:
            - containerPort: 8080
          env:
            - name: ASPNETCORE_URLS
              value: "http://+:8080"
            - name: Storage__Provider
              value: "s3"
            - name: Storage__S3__BucketName
              value: "okla-media"
            - name: Storage__S3__Region
              value: "us-east-1"
            - name: Storage__S3__AccessKey
              valueFrom:
                secretKeyRef:
                  name: external-services-secrets
                  key: AWS_ACCESS_KEY_ID
            - name: Storage__S3__SecretKey
              valueFrom:
                secretKeyRef:
                  name: external-services-secrets
                  key: AWS_SECRET_ACCESS_KEY
          envFrom:
            - configMapRef:
                name: global-config
            - secretRef:
                name: mediaservice-db-secret
            - secretRef:
                name: jwt-secrets
            - secretRef:
                name: redis-secrets
            - secretRef:
                name: rabbitmq-secrets
          resources:
            requests:
              memory: "128Mi"
              cpu: "50m"
            limits:
              memory: "256Mi"
              cpu: "200m"
          securityContext:
            runAsNonRoot: true
            runAsUser: 1000
            allowPrivilegeEscalation: false
            readOnlyRootFilesystem: true
            capabilities:
              drop:
                - ALL
          startupProbe:
            httpGet:
              path: /health
              port: 8080
            initialDelaySeconds: 10
            periodSeconds: 5
            failureThreshold: 24
          livenessProbe:
            httpGet:
              path: /health
              port: 8080
            periodSeconds: 30
            timeoutSeconds: 10
            failureThreshold: 3
          readinessProbe:
            httpGet:
              path: /health
              port: 8080
            periodSeconds: 15
            timeoutSeconds: 10
            failureThreshold: 3
          volumeMounts:
            - name: tmp
              mountPath: /tmp
            - name: uploads
              mountPath: /app/uploads
      volumes:
        - name: tmp
          emptyDir: {}
        - name: uploads
          emptyDir: {}

---
# =============================================================================
# BILLING SERVICE ‚Äî üî¥ CRITICAL: minReplicas=2 para HA
# =============================================================================
apiVersion: apps/v1
kind: Deployment
metadata:
  name: billingservice
  namespace: okla
  labels:
    app: billingservice
    tier: backend
spec:
  replicas: 1
  strategy:
    type: RollingUpdate
    rollingUpdate:
      maxSurge: 1
      maxUnavailable: 0
  selector:
    matchLabels:
      app: billingservice
  template:
    metadata:
      labels:
        app: billingservice
    spec:
      serviceAccountName: okla-backend
      automountServiceAccountToken: false
      topologySpreadConstraints:
        - maxSkew: 1
          topologyKey: kubernetes.io/hostname
          whenUnsatisfiable: ScheduleAnyway
          labelSelector:
            matchLabels:
              app: billingservice
      imagePullSecrets:
        - name: registry-credentials
      containers:
        - name: billingservice
          image: ghcr.io/gregorymorenoiem/billingservice:latest
          ports:
            - containerPort: 8080
          env:
            - name: ASPNETCORE_URLS
              value: "http://+:8080"
          envFrom:
            - configMapRef:
                name: global-config
            - secretRef:
                name: billingservice-db-secret
            - secretRef:
                name: jwt-secrets
            - secretRef:
                name: redis-secrets
            - secretRef:
                name: rabbitmq-secrets
            - secretRef:
                name: external-services-secrets
          resources:
            requests:
              memory: "128Mi"
              cpu: "50m"
            limits:
              memory: "256Mi"
              cpu: "200m"
          securityContext:
            runAsNonRoot: true
            runAsUser: 1000
            allowPrivilegeEscalation: false
            readOnlyRootFilesystem: true
            capabilities:
              drop:
                - ALL
          startupProbe:
            httpGet:
              path: /health
              port: 8080
            initialDelaySeconds: 10
            periodSeconds: 5
            failureThreshold: 24
          livenessProbe:
            httpGet:
              path: /health
              port: 8080
            periodSeconds: 30
            timeoutSeconds: 10
            failureThreshold: 3
          readinessProbe:
            httpGet:
              path: /health
              port: 8080
            periodSeconds: 15
            timeoutSeconds: 10
            failureThreshold: 3
          volumeMounts:
            - name: tmp
              mountPath: /tmp
      volumes:
        - name: tmp
          emptyDir: {}

---
# =============================================================================
# NOTIFICATION SERVICE
# =============================================================================
apiVersion: apps/v1
kind: Deployment
metadata:
  name: notificationservice
  namespace: okla
  labels:
    app: notificationservice
    tier: backend
spec:
  replicas: 1
  selector:
    matchLabels:
      app: notificationservice
  template:
    metadata:
      labels:
        app: notificationservice
    spec:
      serviceAccountName: okla-backend
      automountServiceAccountToken: false
      topologySpreadConstraints:
        - maxSkew: 1
          topologyKey: kubernetes.io/hostname
          whenUnsatisfiable: ScheduleAnyway
          labelSelector:
            matchLabels:
              app: notificationservice
      imagePullSecrets:
        - name: registry-credentials
      containers:
        - name: notificationservice
          image: ghcr.io/gregorymorenoiem/notificationservice:latest
          ports:
            - containerPort: 8080
          env:
            - name: ASPNETCORE_URLS
              value: "http://+:8080"
          envFrom:
            - configMapRef:
                name: global-config
            - secretRef:
                name: notificationservice-db-secret
            - secretRef:
                name: jwt-secrets
            - secretRef:
                name: redis-secrets
            - secretRef:
                name: rabbitmq-secrets
            - secretRef:
                name: external-services-secrets
          resources:
            requests:
              memory: "128Mi"
              cpu: "50m"
            limits:
              memory: "256Mi"
              cpu: "200m"
          securityContext:
            runAsNonRoot: true
            runAsUser: 1000
            allowPrivilegeEscalation: false
            readOnlyRootFilesystem: true
            capabilities:
              drop:
                - ALL
          startupProbe:
            httpGet:
              path: /health
              port: 8080
            initialDelaySeconds: 10
            periodSeconds: 5
            failureThreshold: 24
          livenessProbe:
            httpGet:
              path: /health
              port: 8080
            periodSeconds: 30
            timeoutSeconds: 10
            failureThreshold: 3
          readinessProbe:
            httpGet:
              path: /health
              port: 8080
            periodSeconds: 15
            timeoutSeconds: 10
            failureThreshold: 3
          volumeMounts:
            - name: tmp
              mountPath: /tmp
      volumes:
        - name: tmp
          emptyDir: {}

---
# =============================================================================
# ERROR SERVICE
# =============================================================================
apiVersion: apps/v1
kind: Deployment
metadata:
  name: errorservice
  namespace: okla
  labels:
    app: errorservice
    tier: backend
spec:
  replicas: 1
  selector:
    matchLabels:
      app: errorservice
  template:
    metadata:
      labels:
        app: errorservice
    spec:
      serviceAccountName: okla-backend
      automountServiceAccountToken: false
      topologySpreadConstraints:
        - maxSkew: 1
          topologyKey: kubernetes.io/hostname
          whenUnsatisfiable: ScheduleAnyway
          labelSelector:
            matchLabels:
              app: errorservice
      imagePullSecrets:
        - name: registry-credentials
      containers:
        - name: errorservice
          image: ghcr.io/gregorymorenoiem/errorservice:latest
          ports:
            - containerPort: 8080
          env:
            - name: ASPNETCORE_URLS
              value: "http://+:8080"
          envFrom:
            - configMapRef:
                name: global-config
            - secretRef:
                name: errorservice-db-secret
            - secretRef:
                name: jwt-secrets
            - secretRef:
                name: redis-secrets
            - secretRef:
                name: rabbitmq-secrets
          resources:
            requests:
              memory: "128Mi"
              cpu: "50m"
            limits:
              memory: "256Mi"
              cpu: "200m"
          securityContext:
            runAsNonRoot: true
            runAsUser: 1000
            allowPrivilegeEscalation: false
            readOnlyRootFilesystem: true
            capabilities:
              drop:
                - ALL
          startupProbe:
            httpGet:
              path: /health
              port: 8080
            initialDelaySeconds: 10
            periodSeconds: 5
            failureThreshold: 24
          livenessProbe:
            httpGet:
              path: /health
              port: 8080
            periodSeconds: 30
            timeoutSeconds: 10
            failureThreshold: 3
          readinessProbe:
            httpGet:
              path: /health
              port: 8080
            periodSeconds: 15
            timeoutSeconds: 10
            failureThreshold: 3
          volumeMounts:
            - name: tmp
              mountPath: /tmp
      volumes:
        - name: tmp
          emptyDir: {}

---
# =============================================================================
# KYC SERVICE ‚Äî Verificaci√≥n de identidad
# =============================================================================
apiVersion: apps/v1
kind: Deployment
metadata:
  name: kycservice
  namespace: okla
  labels:
    app: kycservice
    tier: backend
spec:
  replicas: 1
  selector:
    matchLabels:
      app: kycservice
  template:
    metadata:
      labels:
        app: kycservice
    spec:
      serviceAccountName: okla-backend
      automountServiceAccountToken: false
      topologySpreadConstraints:
        - maxSkew: 1
          topologyKey: kubernetes.io/hostname
          whenUnsatisfiable: ScheduleAnyway
          labelSelector:
            matchLabels:
              app: kycservice
      imagePullSecrets:
        - name: registry-credentials
      containers:
        - name: kycservice
          image: ghcr.io/gregorymorenoiem/kycservice:latest
          ports:
            - containerPort: 8080
          env:
            - name: ASPNETCORE_URLS
              value: "http://+:8080"
          envFrom:
            - configMapRef:
                name: global-config
            - secretRef:
                name: kycservice-db-secret
            - secretRef:
                name: jwt-secrets
            - secretRef:
                name: redis-secrets
            - secretRef:
                name: rabbitmq-secrets
          resources:
            requests:
              memory: "256Mi"
              cpu: "100m"
            limits:
              memory: "512Mi"
              cpu: "400m"
          securityContext:
            runAsNonRoot: true
            runAsUser: 1000
            allowPrivilegeEscalation: false
            readOnlyRootFilesystem: true
            capabilities:
              drop:
                - ALL
          startupProbe:
            httpGet:
              path: /health
              port: 8080
            initialDelaySeconds: 10
            periodSeconds: 5
            timeoutSeconds: 3
            failureThreshold: 24
          livenessProbe:
            httpGet:
              path: /health
              port: 8080
            periodSeconds: 30
            timeoutSeconds: 10
            failureThreshold: 3
          readinessProbe:
            httpGet:
              path: /health
              port: 8080
            periodSeconds: 10
            timeoutSeconds: 5
            failureThreshold: 3
          volumeMounts:
            - name: tmp
              mountPath: /tmp
      volumes:
        - name: tmp
          emptyDir: {}

---
# =============================================================================
# AUDIT SERVICE ‚Äî Auditor√≠a centralizada (consumido internamente)
# =============================================================================
apiVersion: apps/v1
kind: Deployment
metadata:
  name: auditservice
  namespace: okla
  labels:
    app: auditservice
    tier: backend
spec:
  replicas: 0 # DISABLED: crashes on startup (DLQ bug)
  selector:
    matchLabels:
      app: auditservice
  template:
    metadata:
      labels:
        app: auditservice
    spec:
      serviceAccountName: okla-backend
      automountServiceAccountToken: false
      topologySpreadConstraints:
        - maxSkew: 1
          topologyKey: kubernetes.io/hostname
          whenUnsatisfiable: ScheduleAnyway
          labelSelector:
            matchLabels:
              app: auditservice
      imagePullSecrets:
        - name: registry-credentials
      containers:
        - name: auditservice
          image: ghcr.io/gregorymorenoiem/auditservice:latest
          ports:
            - containerPort: 8080
          env:
            - name: ASPNETCORE_URLS
              value: "http://+:8080"
          envFrom:
            - configMapRef:
                name: global-config
            - secretRef:
                name: auditservice-db-secret
            - secretRef:
                name: jwt-secrets
            - secretRef:
                name: redis-secrets
            - secretRef:
                name: rabbitmq-secrets
          resources:
            requests:
              memory: "128Mi"
              cpu: "50m"
            limits:
              memory: "256Mi"
              cpu: "200m"
          securityContext:
            runAsNonRoot: true
            runAsUser: 1000
            allowPrivilegeEscalation: false
            readOnlyRootFilesystem: true
            capabilities:
              drop:
                - ALL
          startupProbe:
            httpGet:
              path: /health/live
              port: 8080
            initialDelaySeconds: 10
            periodSeconds: 5
            failureThreshold: 24
          livenessProbe:
            httpGet:
              path: /health/live
              port: 8080
            periodSeconds: 30
            timeoutSeconds: 5
            failureThreshold: 3
          readinessProbe:
            httpGet:
              path: /health/ready
              port: 8080
            periodSeconds: 10
            timeoutSeconds: 5
            failureThreshold: 3
          volumeMounts:
            - name: tmp
              mountPath: /tmp
      volumes:
        - name: tmp
          emptyDir: {}

---
# =============================================================================
# IDEMPOTENCY SERVICE ‚Äî Control de operaciones duplicadas (consumido internamente)
# =============================================================================
apiVersion: apps/v1
kind: Deployment
metadata:
  name: idempotencyservice
  namespace: okla
  labels:
    app: idempotencyservice
    tier: backend
spec:
  replicas: 0 # DISABLED: no image in GHCR
  selector:
    matchLabels:
      app: idempotencyservice
  template:
    metadata:
      labels:
        app: idempotencyservice
    spec:
      serviceAccountName: okla-backend
      automountServiceAccountToken: false
      topologySpreadConstraints:
        - maxSkew: 1
          topologyKey: kubernetes.io/hostname
          whenUnsatisfiable: ScheduleAnyway
          labelSelector:
            matchLabels:
              app: idempotencyservice
      imagePullSecrets:
        - name: registry-credentials
      containers:
        - name: idempotencyservice
          image: ghcr.io/gregorymorenoiem/idempotencyservice:latest
          ports:
            - containerPort: 8080
          env:
            - name: ASPNETCORE_URLS
              value: "http://+:8080"
          envFrom:
            - configMapRef:
                name: global-config
            - secretRef:
                name: idempotencyservice-db-secret
            - secretRef:
                name: jwt-secrets
            - secretRef:
                name: redis-secrets
            - secretRef:
                name: rabbitmq-secrets
          resources:
            requests:
              memory: "128Mi"
              cpu: "50m"
            limits:
              memory: "256Mi"
              cpu: "200m"
          securityContext:
            runAsNonRoot: true
            runAsUser: 1000
            allowPrivilegeEscalation: false
            readOnlyRootFilesystem: true
            capabilities:
              drop:
                - ALL
          startupProbe:
            httpGet:
              path: /health/live
              port: 8080
            initialDelaySeconds: 10
            periodSeconds: 5
            failureThreshold: 24
          livenessProbe:
            httpGet:
              path: /health/live
              port: 8080
            periodSeconds: 30
            timeoutSeconds: 5
            failureThreshold: 3
          readinessProbe:
            httpGet:
              path: /health/ready
              port: 8080
            periodSeconds: 10
            timeoutSeconds: 5
            failureThreshold: 3
          volumeMounts:
            - name: tmp
              mountPath: /tmp
      volumes:
        - name: tmp
          emptyDir: {}

---
# =============================================================================
# ADMIN SERVICE ‚Äî Panel de administraci√≥n
# =============================================================================
apiVersion: apps/v1
kind: Deployment
metadata:
  name: adminservice
  namespace: okla
  labels:
    app: adminservice
    tier: backend
spec:
  replicas: 0 # DISABLED: crashes on startup
  selector:
    matchLabels:
      app: adminservice
  template:
    metadata:
      labels:
        app: adminservice
    spec:
      serviceAccountName: okla-backend
      automountServiceAccountToken: false
      topologySpreadConstraints:
        - maxSkew: 1
          topologyKey: kubernetes.io/hostname
          whenUnsatisfiable: ScheduleAnyway
          labelSelector:
            matchLabels:
              app: adminservice
      imagePullSecrets:
        - name: registry-credentials
      containers:
        - name: adminservice
          image: ghcr.io/gregorymorenoiem/adminservice:latest
          ports:
            - containerPort: 8080
          env:
            - name: ASPNETCORE_URLS
              value: "http://+:8080"
          envFrom:
            - configMapRef:
                name: global-config
            - secretRef:
                name: adminservice-db-secret
            - secretRef:
                name: jwt-secrets
            - secretRef:
                name: redis-secrets
            - secretRef:
                name: rabbitmq-secrets
          resources:
            requests:
              memory: "256Mi"
              cpu: "100m"
            limits:
              memory: "512Mi"
              cpu: "400m"
          securityContext:
            runAsNonRoot: true
            runAsUser: 1000
            allowPrivilegeEscalation: false
            readOnlyRootFilesystem: true
            capabilities:
              drop:
                - ALL
          startupProbe:
            httpGet:
              path: /health/live
              port: 8080
            initialDelaySeconds: 10
            periodSeconds: 5
            failureThreshold: 24
          livenessProbe:
            httpGet:
              path: /health/live
              port: 8080
            periodSeconds: 30
            timeoutSeconds: 5
            failureThreshold: 3
          readinessProbe:
            httpGet:
              path: /health/ready
              port: 8080
            periodSeconds: 10
            timeoutSeconds: 5
            failureThreshold: 3
          volumeMounts:
            - name: tmp
              mountPath: /tmp
      volumes:
        - name: tmp
          emptyDir: {}

---
# =============================================================================
# CHATBOT SERVICE ‚Äî Chatbot IA "Ana" + WhatsApp
# =============================================================================
apiVersion: apps/v1
kind: Deployment
metadata:
  name: chatbotservice
  namespace: okla
  labels:
    app: chatbotservice
    tier: backend
spec:
  replicas: 1
  selector:
    matchLabels:
      app: chatbotservice
  template:
    metadata:
      labels:
        app: chatbotservice
    spec:
      serviceAccountName: okla-backend
      automountServiceAccountToken: false
      topologySpreadConstraints:
        - maxSkew: 1
          topologyKey: kubernetes.io/hostname
          whenUnsatisfiable: ScheduleAnyway
          labelSelector:
            matchLabels:
              app: chatbotservice
      imagePullSecrets:
        - name: registry-credentials
      containers:
        - name: chatbotservice
          image: ghcr.io/gregorymorenoiem/chatbotservice:latest
          ports:
            - containerPort: 8080
          env:
            - name: ASPNETCORE_URLS
              value: "http://+:8080"
            # Set Docker env so EnsureCreated runs to create DB tables
            - name: ASPNETCORE_ENVIRONMENT
              value: "Docker"
            # ChatbotService reads Redis__ConnectionString, not Redis__Connection
            - name: Redis__ConnectionString
              valueFrom:
                secretKeyRef:
                  name: redis-secrets
                  key: Redis__Connection
            # ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            # LLM Provider ‚Äî HuggingFace Inference Endpoints
            # Chat completions: tu modelo fine-tuned hosteado en HF
            # ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            - name: LlmService__ServerUrl
              valueFrom:
                secretKeyRef:
                  name: chatbot-llm-secrets
                  key: LlmService__ServerUrl
            - name: LlmService__ApiKey
              valueFrom:
                secretKeyRef:
                  name: chatbot-llm-secrets
                  key: LlmService__ApiKey
            - name: LlmService__ModelId
              valueFrom:
                secretKeyRef:
                  name: chatbot-llm-secrets
                  key: LlmService__ModelId
            - name: LlmService__CompletionsPath
              valueFrom:
                secretKeyRef:
                  name: chatbot-llm-secrets
                  key: LlmService__CompletionsPath
            # ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            # Embedding Provider ‚Äî HuggingFace Inference API (gratis)
            # Embeddings para b√∫squeda vectorial RAG
            # ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            - name: Embedding__ServerUrl
              valueFrom:
                secretKeyRef:
                  name: chatbot-llm-secrets
                  key: Embedding__ServerUrl
            - name: Embedding__ApiKey
              valueFrom:
                secretKeyRef:
                  name: chatbot-llm-secrets
                  key: Embedding__ApiKey
            - name: Embedding__EmbeddingsPath
              valueFrom:
                secretKeyRef:
                  name: chatbot-llm-secrets
                  key: Embedding__EmbeddingsPath
            - name: Embedding__Provider
              valueFrom:
                secretKeyRef:
                  name: chatbot-llm-secrets
                  key: Embedding__Provider
          envFrom:
            - configMapRef:
                name: global-config
            - secretRef:
                name: chatbotservice-db-secret
            - secretRef:
                name: jwt-secrets
            - secretRef:
                name: redis-secrets
            - secretRef:
                name: rabbitmq-secrets
          resources:
            requests:
              memory: "256Mi"
              cpu: "100m"
            limits:
              memory: "512Mi"
              cpu: "500m"
          securityContext:
            runAsNonRoot: true
            runAsUser: 1000
            allowPrivilegeEscalation: false
            readOnlyRootFilesystem: true
            capabilities:
              drop:
                - ALL
          # ChatbotService only maps /health (not /health/live or /health/ready)
          # Use tcpSocket for startup/liveness, /health for readiness
          startupProbe:
            tcpSocket:
              port: 8080
            initialDelaySeconds: 10
            periodSeconds: 5
            failureThreshold: 24
          livenessProbe:
            tcpSocket:
              port: 8080
            periodSeconds: 30
            timeoutSeconds: 5
            failureThreshold: 3
          readinessProbe:
            httpGet:
              path: /health
              port: 8080
            initialDelaySeconds: 15
            periodSeconds: 10
            timeoutSeconds: 5
            failureThreshold: 6
          volumeMounts:
            - name: tmp
              mountPath: /tmp
      volumes:
        - name: tmp
          emptyDir: {}

---
# =============================================================================
# REVIEW SERVICE (Sprint 14)
# =============================================================================
apiVersion: apps/v1
kind: Deployment
metadata:
  name: reviewservice
  namespace: okla
  labels:
    app: reviewservice
    tier: backend
    sprint: "14"
spec:
  replicas: 1
  selector:
    matchLabels:
      app: reviewservice
  template:
    metadata:
      labels:
        app: reviewservice
    spec:
      serviceAccountName: okla-backend
      automountServiceAccountToken: false
      topologySpreadConstraints:
        - maxSkew: 1
          topologyKey: kubernetes.io/hostname
          whenUnsatisfiable: ScheduleAnyway
          labelSelector:
            matchLabels:
              app: reviewservice
      imagePullSecrets:
        - name: registry-credentials
      containers:
        - name: reviewservice
          image: ghcr.io/gregorymorenoiem/reviewservice:latest
          ports:
            - containerPort: 8080
          env:
            - name: ASPNETCORE_URLS
              value: "http://+:8080"
          envFrom:
            - configMapRef:
                name: global-config
            - secretRef:
                name: reviewservice-db-secret
            - secretRef:
                name: jwt-secrets
            - secretRef:
                name: redis-secrets
            - secretRef:
                name: rabbitmq-secrets
          resources:
            requests:
              memory: "256Mi"
              cpu: "100m"
            limits:
              memory: "512Mi"
              cpu: "400m"
          securityContext:
            runAsNonRoot: true
            runAsUser: 1000
            allowPrivilegeEscalation: false
            readOnlyRootFilesystem: true
            capabilities:
              drop:
                - ALL
          startupProbe:
            httpGet:
              path: /health
              port: 8080
            initialDelaySeconds: 10
            periodSeconds: 5
            failureThreshold: 24
          livenessProbe:
            httpGet:
              path: /health
              port: 8080
            periodSeconds: 30
            timeoutSeconds: 5
            failureThreshold: 3
          readinessProbe:
            httpGet:
              path: /health
              port: 8080
            periodSeconds: 10
            timeoutSeconds: 5
            failureThreshold: 3
          volumeMounts:
            - name: tmp
              mountPath: /tmp
      volumes:
        - name: tmp
          emptyDir: {}

---
# =============================================================================
# AI PROCESSING SERVICE
# =============================================================================
apiVersion: apps/v1
kind: Deployment
metadata:
  name: aiprocessingservice
  namespace: okla
  labels:
    app: aiprocessingservice
    tier: backend
spec:
  replicas: 0 # DISABLED: cluster capacity
  selector:
    matchLabels:
      app: aiprocessingservice
  template:
    metadata:
      labels:
        app: aiprocessingservice
    spec:
      serviceAccountName: okla-backend
      automountServiceAccountToken: false
      topologySpreadConstraints:
        - maxSkew: 1
          topologyKey: kubernetes.io/hostname
          whenUnsatisfiable: ScheduleAnyway
          labelSelector:
            matchLabels:
              app: aiprocessingservice
      imagePullSecrets:
        - name: registry-credentials
      containers:
        - name: aiprocessingservice
          image: ghcr.io/gregorymorenoiem/aiprocessingservice:latest
          ports:
            - containerPort: 8080
          env:
            - name: ASPNETCORE_URLS
              value: "http://+:8080"
          envFrom:
            - configMapRef:
                name: global-config
            - secretRef:
                name: aiprocessingservice-db-secret
            - secretRef:
                name: jwt-secrets
            - secretRef:
                name: redis-secrets
            - secretRef:
                name: rabbitmq-secrets
          resources:
            requests:
              memory: "128Mi"
              cpu: "50m"
            limits:
              memory: "256Mi"
              cpu: "200m"
          securityContext:
            runAsNonRoot: true
            runAsUser: 1000
            allowPrivilegeEscalation: false
            readOnlyRootFilesystem: true
            capabilities:
              drop:
                - ALL
          startupProbe:
            httpGet:
              path: /health
              port: 8080
            initialDelaySeconds: 10
            periodSeconds: 5
            failureThreshold: 24
          livenessProbe:
            httpGet:
              path: /health
              port: 8080
            periodSeconds: 30
            timeoutSeconds: 5
            failureThreshold: 3
          readinessProbe:
            httpGet:
              path: /health/ready
              port: 8080
            periodSeconds: 10
            timeoutSeconds: 5
            failureThreshold: 3
          volumeMounts:
            - name: tmp
              mountPath: /tmp
      volumes:
        - name: tmp
          emptyDir: {}

---
# =============================================================================
# ALERTS SERVICE
# =============================================================================
apiVersion: apps/v1
kind: Deployment
metadata:
  name: alertservice
  namespace: okla
  labels:
    app: alertservice
    tier: backend
spec:
  replicas: 0 # DISABLED: cluster capacity
  selector:
    matchLabels:
      app: alertservice
  template:
    metadata:
      labels:
        app: alertservice
    spec:
      serviceAccountName: okla-backend
      automountServiceAccountToken: false
      topologySpreadConstraints:
        - maxSkew: 1
          topologyKey: kubernetes.io/hostname
          whenUnsatisfiable: ScheduleAnyway
          labelSelector:
            matchLabels:
              app: alertservice
      imagePullSecrets:
        - name: registry-credentials
      containers:
        - name: alertservice
          image: ghcr.io/gregorymorenoiem/alertservice:latest
          ports:
            - containerPort: 8080
          env:
            - name: ASPNETCORE_URLS
              value: "http://+:8080"
          envFrom:
            - configMapRef:
                name: global-config
            - secretRef:
                name: alertservice-db-secret
            - secretRef:
                name: jwt-secrets
            - secretRef:
                name: redis-secrets
            - secretRef:
                name: rabbitmq-secrets
          resources:
            requests:
              memory: "128Mi"
              cpu: "50m"
            limits:
              memory: "256Mi"
              cpu: "200m"
          securityContext:
            runAsNonRoot: true
            runAsUser: 1000
            allowPrivilegeEscalation: false
            readOnlyRootFilesystem: true
            capabilities:
              drop:
                - ALL
          startupProbe:
            httpGet:
              path: /health
              port: 8080
            initialDelaySeconds: 10
            periodSeconds: 5
            failureThreshold: 24
          livenessProbe:
            httpGet:
              path: /health
              port: 8080
            periodSeconds: 30
            timeoutSeconds: 5
            failureThreshold: 3
          readinessProbe:
            httpGet:
              path: /health/ready
              port: 8080
            periodSeconds: 10
            timeoutSeconds: 5
            failureThreshold: 3
          volumeMounts:
            - name: tmp
              mountPath: /tmp
      volumes:
        - name: tmp
          emptyDir: {}

---
# =============================================================================
# API DOCUMENTATION SERVICE
# =============================================================================
apiVersion: apps/v1
kind: Deployment
metadata:
  name: apidocsservice
  namespace: okla
  labels:
    app: apidocsservice
    tier: backend
spec:
  replicas: 0 # DISABLED: cluster capacity
  selector:
    matchLabels:
      app: apidocsservice
  template:
    metadata:
      labels:
        app: apidocsservice
    spec:
      serviceAccountName: okla-backend
      automountServiceAccountToken: false
      topologySpreadConstraints:
        - maxSkew: 1
          topologyKey: kubernetes.io/hostname
          whenUnsatisfiable: ScheduleAnyway
          labelSelector:
            matchLabels:
              app: apidocsservice
      imagePullSecrets:
        - name: registry-credentials
      containers:
        - name: apidocsservice
          image: ghcr.io/gregorymorenoiem/apidocsservice:latest
          ports:
            - containerPort: 8080
          env:
            - name: ASPNETCORE_URLS
              value: "http://+:8080"
          envFrom:
            - configMapRef:
                name: global-config
            - secretRef:
                name: apidocsservice-db-secret
            - secretRef:
                name: jwt-secrets
            - secretRef:
                name: redis-secrets
            - secretRef:
                name: rabbitmq-secrets
          resources:
            requests:
              memory: "128Mi"
              cpu: "50m"
            limits:
              memory: "256Mi"
              cpu: "200m"
          securityContext:
            runAsNonRoot: true
            runAsUser: 1000
            allowPrivilegeEscalation: false
            readOnlyRootFilesystem: true
            capabilities:
              drop:
                - ALL
          startupProbe:
            httpGet:
              path: /health
              port: 8080
            initialDelaySeconds: 10
            periodSeconds: 5
            failureThreshold: 24
          livenessProbe:
            httpGet:
              path: /health
              port: 8080
            periodSeconds: 30
            timeoutSeconds: 5
            failureThreshold: 3
          readinessProbe:
            httpGet:
              path: /health/ready
              port: 8080
            periodSeconds: 10
            timeoutSeconds: 5
            failureThreshold: 3
          volumeMounts:
            - name: tmp
              mountPath: /tmp
      volumes:
        - name: tmp
          emptyDir: {}

---
# =============================================================================
# APPOINTMENTS SERVICE
# =============================================================================
apiVersion: apps/v1
kind: Deployment
metadata:
  name: appointmentservice
  namespace: okla
  labels:
    app: appointmentservice
    tier: backend
spec:
  replicas: 1
  selector:
    matchLabels:
      app: appointmentservice
  template:
    metadata:
      labels:
        app: appointmentservice
    spec:
      serviceAccountName: okla-backend
      automountServiceAccountToken: false
      topologySpreadConstraints:
        - maxSkew: 1
          topologyKey: kubernetes.io/hostname
          whenUnsatisfiable: ScheduleAnyway
          labelSelector:
            matchLabels:
              app: appointmentservice
      imagePullSecrets:
        - name: registry-credentials
      containers:
        - name: appointmentservice
          image: ghcr.io/gregorymorenoiem/appointmentservice:latest
          ports:
            - containerPort: 8080
          env:
            - name: ASPNETCORE_URLS
              value: "http://+:8080"
          envFrom:
            - configMapRef:
                name: global-config
            - secretRef:
                name: appointmentservice-db-secret
            - secretRef:
                name: jwt-secrets
            - secretRef:
                name: redis-secrets
            - secretRef:
                name: rabbitmq-secrets
          resources:
            requests:
              memory: "128Mi"
              cpu: "50m"
            limits:
              memory: "256Mi"
              cpu: "200m"
          securityContext:
            runAsNonRoot: true
            runAsUser: 1000
            allowPrivilegeEscalation: false
            readOnlyRootFilesystem: true
            capabilities:
              drop:
                - ALL
          startupProbe:
            httpGet:
              path: /health
              port: 8080
            initialDelaySeconds: 10
            periodSeconds: 5
            failureThreshold: 24
          livenessProbe:
            httpGet:
              path: /health
              port: 8080
            periodSeconds: 30
            timeoutSeconds: 5
            failureThreshold: 3
          readinessProbe:
            httpGet:
              path: /health/ready
              port: 8080
            periodSeconds: 10
            timeoutSeconds: 5
            failureThreshold: 3
          volumeMounts:
            - name: tmp
              mountPath: /tmp
      volumes:
        - name: tmp
          emptyDir: {}

---
# =============================================================================
# BACKGROUND REMOVAL SERVICE
# =============================================================================
apiVersion: apps/v1
kind: Deployment
metadata:
  name: backgroundremovalservice
  namespace: okla
  labels:
    app: backgroundremovalservice
    tier: backend
spec:
  replicas: 0 # DISABLED: cluster capacity
  selector:
    matchLabels:
      app: backgroundremovalservice
  template:
    metadata:
      labels:
        app: backgroundremovalservice
    spec:
      serviceAccountName: okla-backend
      automountServiceAccountToken: false
      topologySpreadConstraints:
        - maxSkew: 1
          topologyKey: kubernetes.io/hostname
          whenUnsatisfiable: ScheduleAnyway
          labelSelector:
            matchLabels:
              app: backgroundremovalservice
      imagePullSecrets:
        - name: registry-credentials
      containers:
        - name: backgroundremovalservice
          image: ghcr.io/gregorymorenoiem/backgroundremovalservice:latest
          ports:
            - containerPort: 8080
          env:
            - name: ASPNETCORE_URLS
              value: "http://+:8080"
          envFrom:
            - configMapRef:
                name: global-config
            - secretRef:
                name: backgroundremovalservice-db-secret
            - secretRef:
                name: jwt-secrets
            - secretRef:
                name: redis-secrets
            - secretRef:
                name: rabbitmq-secrets
          resources:
            requests:
              memory: "128Mi"
              cpu: "50m"
            limits:
              memory: "256Mi"
              cpu: "200m"
          securityContext:
            runAsNonRoot: true
            runAsUser: 1000
            allowPrivilegeEscalation: false
            readOnlyRootFilesystem: true
            capabilities:
              drop:
                - ALL
          startupProbe:
            httpGet:
              path: /health
              port: 8080
            initialDelaySeconds: 10
            periodSeconds: 5
            failureThreshold: 24
          livenessProbe:
            httpGet:
              path: /health
              port: 8080
            periodSeconds: 30
            timeoutSeconds: 5
            failureThreshold: 3
          readinessProbe:
            httpGet:
              path: /health/ready
              port: 8080
            periodSeconds: 10
            timeoutSeconds: 5
            failureThreshold: 3
          volumeMounts:
            - name: tmp
              mountPath: /tmp
      volumes:
        - name: tmp
          emptyDir: {}

---
# =============================================================================
# CACHE SERVICE
# =============================================================================
apiVersion: apps/v1
kind: Deployment
metadata:
  name: cacheservice
  namespace: okla
  labels:
    app: cacheservice
    tier: backend
spec:
  replicas: 0 # DISABLED: cluster capacity
  selector:
    matchLabels:
      app: cacheservice
  template:
    metadata:
      labels:
        app: cacheservice
    spec:
      serviceAccountName: okla-backend
      automountServiceAccountToken: false
      topologySpreadConstraints:
        - maxSkew: 1
          topologyKey: kubernetes.io/hostname
          whenUnsatisfiable: ScheduleAnyway
          labelSelector:
            matchLabels:
              app: cacheservice
      imagePullSecrets:
        - name: registry-credentials
      containers:
        - name: cacheservice
          image: ghcr.io/gregorymorenoiem/cacheservice:latest
          ports:
            - containerPort: 8080
          env:
            - name: ASPNETCORE_URLS
              value: "http://+:8080"
          envFrom:
            - configMapRef:
                name: global-config
            - secretRef:
                name: cacheservice-db-secret
            - secretRef:
                name: jwt-secrets
            - secretRef:
                name: redis-secrets
            - secretRef:
                name: rabbitmq-secrets
          resources:
            requests:
              memory: "128Mi"
              cpu: "50m"
            limits:
              memory: "256Mi"
              cpu: "200m"
          securityContext:
            runAsNonRoot: true
            runAsUser: 1000
            allowPrivilegeEscalation: false
            readOnlyRootFilesystem: true
            capabilities:
              drop:
                - ALL
          startupProbe:
            httpGet:
              path: /health
              port: 8080
            initialDelaySeconds: 10
            periodSeconds: 5
            failureThreshold: 24
          livenessProbe:
            httpGet:
              path: /health
              port: 8080
            periodSeconds: 30
            timeoutSeconds: 5
            failureThreshold: 3
          readinessProbe:
            httpGet:
              path: /health/ready
              port: 8080
            periodSeconds: 10
            timeoutSeconds: 5
            failureThreshold: 3
          volumeMounts:
            - name: tmp
              mountPath: /tmp
      volumes:
        - name: tmp
          emptyDir: {}

---
# =============================================================================
# COMPARISON SERVICE
# =============================================================================
apiVersion: apps/v1
kind: Deployment
metadata:
  name: comparisonservice
  namespace: okla
  labels:
    app: comparisonservice
    tier: backend
spec:
  replicas: 0 # DISABLED: cluster capacity
  selector:
    matchLabels:
      app: comparisonservice
  template:
    metadata:
      labels:
        app: comparisonservice
    spec:
      serviceAccountName: okla-backend
      automountServiceAccountToken: false
      topologySpreadConstraints:
        - maxSkew: 1
          topologyKey: kubernetes.io/hostname
          whenUnsatisfiable: ScheduleAnyway
          labelSelector:
            matchLabels:
              app: comparisonservice
      imagePullSecrets:
        - name: registry-credentials
      containers:
        - name: comparisonservice
          image: ghcr.io/gregorymorenoiem/comparisonservice:latest
          ports:
            - containerPort: 8080
          env:
            - name: ASPNETCORE_URLS
              value: "http://+:8080"
          envFrom:
            - configMapRef:
                name: global-config
            - secretRef:
                name: comparisonservice-db-secret
            - secretRef:
                name: jwt-secrets
            - secretRef:
                name: redis-secrets
            - secretRef:
                name: rabbitmq-secrets
          resources:
            requests:
              memory: "128Mi"
              cpu: "50m"
            limits:
              memory: "256Mi"
              cpu: "200m"
          securityContext:
            runAsNonRoot: true
            runAsUser: 1000
            allowPrivilegeEscalation: false
            readOnlyRootFilesystem: true
            capabilities:
              drop:
                - ALL
          startupProbe:
            httpGet:
              path: /health
              port: 8080
            initialDelaySeconds: 10
            periodSeconds: 5
            failureThreshold: 24
          livenessProbe:
            httpGet:
              path: /health
              port: 8080
            periodSeconds: 30
            timeoutSeconds: 5
            failureThreshold: 3
          readinessProbe:
            httpGet:
              path: /health/ready
              port: 8080
            periodSeconds: 10
            timeoutSeconds: 5
            failureThreshold: 3
          volumeMounts:
            - name: tmp
              mountPath: /tmp
      volumes:
        - name: tmp
          emptyDir: {}

---
# =============================================================================
# CONFIGURATION SERVICE
# =============================================================================
apiVersion: apps/v1
kind: Deployment
metadata:
  name: configurationservice
  namespace: okla
  labels:
    app: configurationservice
    tier: backend
spec:
  replicas: 0 # DISABLED: cluster capacity
  selector:
    matchLabels:
      app: configurationservice
  template:
    metadata:
      labels:
        app: configurationservice
    spec:
      serviceAccountName: okla-backend
      automountServiceAccountToken: false
      topologySpreadConstraints:
        - maxSkew: 1
          topologyKey: kubernetes.io/hostname
          whenUnsatisfiable: ScheduleAnyway
          labelSelector:
            matchLabels:
              app: configurationservice
      imagePullSecrets:
        - name: registry-credentials
      containers:
        - name: configurationservice
          image: ghcr.io/gregorymorenoiem/configurationservice:latest
          ports:
            - containerPort: 8080
          env:
            - name: ASPNETCORE_URLS
              value: "http://+:8080"
          envFrom:
            - configMapRef:
                name: global-config
            - secretRef:
                name: configurationservice-db-secret
            - secretRef:
                name: jwt-secrets
            - secretRef:
                name: redis-secrets
            - secretRef:
                name: rabbitmq-secrets
          resources:
            requests:
              memory: "128Mi"
              cpu: "50m"
            limits:
              memory: "256Mi"
              cpu: "200m"
          securityContext:
            runAsNonRoot: true
            runAsUser: 1000
            allowPrivilegeEscalation: false
            readOnlyRootFilesystem: true
            capabilities:
              drop:
                - ALL
          startupProbe:
            httpGet:
              path: /health
              port: 8080
            initialDelaySeconds: 10
            periodSeconds: 5
            failureThreshold: 24
          livenessProbe:
            httpGet:
              path: /health
              port: 8080
            periodSeconds: 30
            timeoutSeconds: 5
            failureThreshold: 3
          readinessProbe:
            httpGet:
              path: /health/ready
              port: 8080
            periodSeconds: 10
            timeoutSeconds: 5
            failureThreshold: 3
          volumeMounts:
            - name: tmp
              mountPath: /tmp
      volumes:
        - name: tmp
          emptyDir: {}

---
# =============================================================================
# CONTACT SERVICE
# =============================================================================
apiVersion: apps/v1
kind: Deployment
metadata:
  name: contactservice
  namespace: okla
  labels:
    app: contactservice
    tier: backend
spec:
  replicas: 0 # DISABLED: cluster capacity
  selector:
    matchLabels:
      app: contactservice
  template:
    metadata:
      labels:
        app: contactservice
    spec:
      serviceAccountName: okla-backend
      automountServiceAccountToken: false
      topologySpreadConstraints:
        - maxSkew: 1
          topologyKey: kubernetes.io/hostname
          whenUnsatisfiable: ScheduleAnyway
          labelSelector:
            matchLabels:
              app: contactservice
      imagePullSecrets:
        - name: registry-credentials
      containers:
        - name: contactservice
          image: ghcr.io/gregorymorenoiem/contactservice:latest
          ports:
            - containerPort: 8080
          env:
            - name: ASPNETCORE_URLS
              value: "http://+:8080"
          envFrom:
            - configMapRef:
                name: global-config
            - secretRef:
                name: contactservice-db-secret
            - secretRef:
                name: jwt-secrets
            - secretRef:
                name: redis-secrets
            - secretRef:
                name: rabbitmq-secrets
          resources:
            requests:
              memory: "128Mi"
              cpu: "50m"
            limits:
              memory: "256Mi"
              cpu: "200m"
          securityContext:
            runAsNonRoot: true
            runAsUser: 1000
            allowPrivilegeEscalation: false
            readOnlyRootFilesystem: true
            capabilities:
              drop:
                - ALL
          startupProbe:
            httpGet:
              path: /health
              port: 8080
            initialDelaySeconds: 10
            periodSeconds: 5
            failureThreshold: 24
          livenessProbe:
            httpGet:
              path: /health
              port: 8080
            periodSeconds: 30
            timeoutSeconds: 5
            failureThreshold: 3
          readinessProbe:
            httpGet:
              path: /health/ready
              port: 8080
            periodSeconds: 10
            timeoutSeconds: 5
            failureThreshold: 3
          volumeMounts:
            - name: tmp
              mountPath: /tmp
      volumes:
        - name: tmp
          emptyDir: {}

---
# =============================================================================
# CRM SERVICE
# =============================================================================
apiVersion: apps/v1
kind: Deployment
metadata:
  name: crmservice
  namespace: okla
  labels:
    app: crmservice
    tier: backend
spec:
  replicas: 0 # DISABLED: cluster capacity
  selector:
    matchLabels:
      app: crmservice
  template:
    metadata:
      labels:
        app: crmservice
    spec:
      serviceAccountName: okla-backend
      automountServiceAccountToken: false
      topologySpreadConstraints:
        - maxSkew: 1
          topologyKey: kubernetes.io/hostname
          whenUnsatisfiable: ScheduleAnyway
          labelSelector:
            matchLabels:
              app: crmservice
      imagePullSecrets:
        - name: registry-credentials
      containers:
        - name: crmservice
          image: ghcr.io/gregorymorenoiem/crmservice:latest
          ports:
            - containerPort: 8080
          env:
            - name: ASPNETCORE_URLS
              value: "http://+:8080"
          envFrom:
            - configMapRef:
                name: global-config
            - secretRef:
                name: crmservice-db-secret
            - secretRef:
                name: jwt-secrets
            - secretRef:
                name: redis-secrets
            - secretRef:
                name: rabbitmq-secrets
          resources:
            requests:
              memory: "128Mi"
              cpu: "50m"
            limits:
              memory: "256Mi"
              cpu: "200m"
          securityContext:
            runAsNonRoot: true
            runAsUser: 1000
            allowPrivilegeEscalation: false
            readOnlyRootFilesystem: true
            capabilities:
              drop:
                - ALL
          startupProbe:
            httpGet:
              path: /health
              port: 8080
            initialDelaySeconds: 10
            periodSeconds: 5
            failureThreshold: 24
          livenessProbe:
            httpGet:
              path: /health
              port: 8080
            periodSeconds: 30
            timeoutSeconds: 5
            failureThreshold: 3
          readinessProbe:
            httpGet:
              path: /health/ready
              port: 8080
            periodSeconds: 10
            timeoutSeconds: 5
            failureThreshold: 3
          volumeMounts:
            - name: tmp
              mountPath: /tmp
      volumes:
        - name: tmp
          emptyDir: {}

---
# =============================================================================
# DATA PROTECTION SERVICE
# =============================================================================
apiVersion: apps/v1
kind: Deployment
metadata:
  name: dataprotectionservice
  namespace: okla
  labels:
    app: dataprotectionservice
    tier: backend
spec:
  replicas: 0 # DISABLED: cluster capacity
  selector:
    matchLabels:
      app: dataprotectionservice
  template:
    metadata:
      labels:
        app: dataprotectionservice
    spec:
      serviceAccountName: okla-backend
      automountServiceAccountToken: false
      topologySpreadConstraints:
        - maxSkew: 1
          topologyKey: kubernetes.io/hostname
          whenUnsatisfiable: ScheduleAnyway
          labelSelector:
            matchLabels:
              app: dataprotectionservice
      imagePullSecrets:
        - name: registry-credentials
      containers:
        - name: dataprotectionservice
          image: ghcr.io/gregorymorenoiem/dataprotectionservice:latest
          ports:
            - containerPort: 8080
          env:
            - name: ASPNETCORE_URLS
              value: "http://+:8080"
          envFrom:
            - configMapRef:
                name: global-config
            - secretRef:
                name: dataprotectionservice-db-secret
            - secretRef:
                name: jwt-secrets
            - secretRef:
                name: redis-secrets
            - secretRef:
                name: rabbitmq-secrets
          resources:
            requests:
              memory: "128Mi"
              cpu: "50m"
            limits:
              memory: "256Mi"
              cpu: "200m"
          securityContext:
            runAsNonRoot: true
            runAsUser: 1000
            allowPrivilegeEscalation: false
            readOnlyRootFilesystem: true
            capabilities:
              drop:
                - ALL
          startupProbe:
            httpGet:
              path: /health
              port: 8080
            initialDelaySeconds: 10
            periodSeconds: 5
            failureThreshold: 24
          livenessProbe:
            httpGet:
              path: /health
              port: 8080
            periodSeconds: 30
            timeoutSeconds: 5
            failureThreshold: 3
          readinessProbe:
            httpGet:
              path: /health/ready
              port: 8080
            periodSeconds: 10
            timeoutSeconds: 5
            failureThreshold: 3
          volumeMounts:
            - name: tmp
              mountPath: /tmp
      volumes:
        - name: tmp
          emptyDir: {}

---
# =============================================================================
# DEALER ANALYTICS SERVICE
# =============================================================================
apiVersion: apps/v1
kind: Deployment
metadata:
  name: dealeranalyticsservice
  namespace: okla
  labels:
    app: dealeranalyticsservice
    tier: backend
spec:
  replicas: 0 # DISABLED: cluster capacity
  selector:
    matchLabels:
      app: dealeranalyticsservice
  template:
    metadata:
      labels:
        app: dealeranalyticsservice
    spec:
      serviceAccountName: okla-backend
      automountServiceAccountToken: false
      topologySpreadConstraints:
        - maxSkew: 1
          topologyKey: kubernetes.io/hostname
          whenUnsatisfiable: ScheduleAnyway
          labelSelector:
            matchLabels:
              app: dealeranalyticsservice
      imagePullSecrets:
        - name: registry-credentials
      containers:
        - name: dealeranalyticsservice
          image: ghcr.io/gregorymorenoiem/dealeranalyticsservice:latest
          ports:
            - containerPort: 8080
          env:
            - name: ASPNETCORE_URLS
              value: "http://+:8080"
          envFrom:
            - configMapRef:
                name: global-config
            - secretRef:
                name: dealeranalyticsservice-db-secret
            - secretRef:
                name: jwt-secrets
            - secretRef:
                name: redis-secrets
            - secretRef:
                name: rabbitmq-secrets
          resources:
            requests:
              memory: "128Mi"
              cpu: "50m"
            limits:
              memory: "256Mi"
              cpu: "200m"
          securityContext:
            runAsNonRoot: true
            runAsUser: 1000
            allowPrivilegeEscalation: false
            readOnlyRootFilesystem: true
            capabilities:
              drop:
                - ALL
          startupProbe:
            httpGet:
              path: /health
              port: 8080
            initialDelaySeconds: 10
            periodSeconds: 5
            failureThreshold: 24
          livenessProbe:
            httpGet:
              path: /health
              port: 8080
            periodSeconds: 30
            timeoutSeconds: 5
            failureThreshold: 3
          readinessProbe:
            httpGet:
              path: /health/ready
              port: 8080
            periodSeconds: 10
            timeoutSeconds: 5
            failureThreshold: 3
          volumeMounts:
            - name: tmp
              mountPath: /tmp
      volumes:
        - name: tmp
          emptyDir: {}

---
# =============================================================================
# DEALER MANAGEMENT SERVICE
# =============================================================================
apiVersion: apps/v1
kind: Deployment
metadata:
  name: dealermanagementservice
  namespace: okla
  labels:
    app: dealermanagementservice
    tier: backend
spec:
  replicas: 1
  selector:
    matchLabels:
      app: dealermanagementservice
  template:
    metadata:
      labels:
        app: dealermanagementservice
    spec:
      serviceAccountName: okla-backend
      automountServiceAccountToken: false
      topologySpreadConstraints:
        - maxSkew: 1
          topologyKey: kubernetes.io/hostname
          whenUnsatisfiable: ScheduleAnyway
          labelSelector:
            matchLabels:
              app: dealermanagementservice
      imagePullSecrets:
        - name: registry-credentials
      containers:
        - name: dealermanagementservice
          image: ghcr.io/gregorymorenoiem/dealermanagementservice:latest
          ports:
            - containerPort: 8080
          env:
            - name: ASPNETCORE_URLS
              value: "http://+:8080"
          envFrom:
            - configMapRef:
                name: global-config
            - secretRef:
                name: dealermanagementservice-db-secret
            - secretRef:
                name: jwt-secrets
            - secretRef:
                name: redis-secrets
            - secretRef:
                name: rabbitmq-secrets
          resources:
            requests:
              memory: "128Mi"
              cpu: "50m"
            limits:
              memory: "256Mi"
              cpu: "200m"
          securityContext:
            runAsNonRoot: true
            runAsUser: 1000
            allowPrivilegeEscalation: false
            readOnlyRootFilesystem: true
            capabilities:
              drop:
                - ALL
          startupProbe:
            httpGet:
              path: /health
              port: 8080
            initialDelaySeconds: 10
            periodSeconds: 5
            failureThreshold: 24
          livenessProbe:
            httpGet:
              path: /health
              port: 8080
            periodSeconds: 30
            timeoutSeconds: 5
            failureThreshold: 3
          readinessProbe:
            httpGet:
              path: /health/ready
              port: 8080
            periodSeconds: 10
            timeoutSeconds: 5
            failureThreshold: 3
          volumeMounts:
            - name: tmp
              mountPath: /tmp
      volumes:
        - name: tmp
          emptyDir: {}

---
# =============================================================================
# INTEGRATION SERVICE
# =============================================================================
apiVersion: apps/v1
kind: Deployment
metadata:
  name: integrationservice
  namespace: okla
  labels:
    app: integrationservice
    tier: backend
spec:
  replicas: 0 # DISABLED: cluster capacity
  selector:
    matchLabels:
      app: integrationservice
  template:
    metadata:
      labels:
        app: integrationservice
    spec:
      serviceAccountName: okla-backend
      automountServiceAccountToken: false
      topologySpreadConstraints:
        - maxSkew: 1
          topologyKey: kubernetes.io/hostname
          whenUnsatisfiable: ScheduleAnyway
          labelSelector:
            matchLabels:
              app: integrationservice
      imagePullSecrets:
        - name: registry-credentials
      containers:
        - name: integrationservice
          image: ghcr.io/gregorymorenoiem/integrationservice:latest
          ports:
            - containerPort: 8080
          env:
            - name: ASPNETCORE_URLS
              value: "http://+:8080"
          envFrom:
            - configMapRef:
                name: global-config
            - secretRef:
                name: integrationservice-db-secret
            - secretRef:
                name: jwt-secrets
            - secretRef:
                name: redis-secrets
            - secretRef:
                name: rabbitmq-secrets
          resources:
            requests:
              memory: "128Mi"
              cpu: "50m"
            limits:
              memory: "256Mi"
              cpu: "200m"
          securityContext:
            runAsNonRoot: true
            runAsUser: 1000
            allowPrivilegeEscalation: false
            readOnlyRootFilesystem: true
            capabilities:
              drop:
                - ALL
          startupProbe:
            httpGet:
              path: /health
              port: 8080
            initialDelaySeconds: 10
            periodSeconds: 5
            failureThreshold: 24
          livenessProbe:
            httpGet:
              path: /health
              port: 8080
            periodSeconds: 30
            timeoutSeconds: 5
            failureThreshold: 3
          readinessProbe:
            httpGet:
              path: /health/ready
              port: 8080
            periodSeconds: 10
            timeoutSeconds: 5
            failureThreshold: 3
          volumeMounts:
            - name: tmp
              mountPath: /tmp
      volumes:
        - name: tmp
          emptyDir: {}

---
# =============================================================================
# INVENTORY MANAGEMENT SERVICE
# =============================================================================
apiVersion: apps/v1
kind: Deployment
metadata:
  name: inventorymanagementservice
  namespace: okla
  labels:
    app: inventorymanagementservice
    tier: backend
spec:
  replicas: 0 # DISABLED: cluster capacity
  selector:
    matchLabels:
      app: inventorymanagementservice
  template:
    metadata:
      labels:
        app: inventorymanagementservice
    spec:
      serviceAccountName: okla-backend
      automountServiceAccountToken: false
      topologySpreadConstraints:
        - maxSkew: 1
          topologyKey: kubernetes.io/hostname
          whenUnsatisfiable: ScheduleAnyway
          labelSelector:
            matchLabels:
              app: inventorymanagementservice
      imagePullSecrets:
        - name: registry-credentials
      containers:
        - name: inventorymanagementservice
          image: ghcr.io/gregorymorenoiem/inventorymanagementservice:latest
          ports:
            - containerPort: 8080
          env:
            - name: ASPNETCORE_URLS
              value: "http://+:8080"
          envFrom:
            - configMapRef:
                name: global-config
            - secretRef:
                name: inventorymanagementservice-db-secret
            - secretRef:
                name: jwt-secrets
            - secretRef:
                name: redis-secrets
            - secretRef:
                name: rabbitmq-secrets
          resources:
            requests:
              memory: "128Mi"
              cpu: "50m"
            limits:
              memory: "256Mi"
              cpu: "200m"
          securityContext:
            runAsNonRoot: true
            runAsUser: 1000
            allowPrivilegeEscalation: false
            readOnlyRootFilesystem: true
            capabilities:
              drop:
                - ALL
          startupProbe:
            httpGet:
              path: /health
              port: 8080
            initialDelaySeconds: 10
            periodSeconds: 5
            failureThreshold: 24
          livenessProbe:
            httpGet:
              path: /health
              port: 8080
            periodSeconds: 30
            timeoutSeconds: 5
            failureThreshold: 3
          readinessProbe:
            httpGet:
              path: /health/ready
              port: 8080
            periodSeconds: 10
            timeoutSeconds: 5
            failureThreshold: 3
          volumeMounts:
            - name: tmp
              mountPath: /tmp
      volumes:
        - name: tmp
          emptyDir: {}

---
# =============================================================================
# LEAD SCORING SERVICE
# =============================================================================
apiVersion: apps/v1
kind: Deployment
metadata:
  name: leadscoringservice
  namespace: okla
  labels:
    app: leadscoringservice
    tier: backend
spec:
  replicas: 0 # DISABLED: cluster capacity
  selector:
    matchLabels:
      app: leadscoringservice
  template:
    metadata:
      labels:
        app: leadscoringservice
    spec:
      serviceAccountName: okla-backend
      automountServiceAccountToken: false
      topologySpreadConstraints:
        - maxSkew: 1
          topologyKey: kubernetes.io/hostname
          whenUnsatisfiable: ScheduleAnyway
          labelSelector:
            matchLabels:
              app: leadscoringservice
      imagePullSecrets:
        - name: registry-credentials
      containers:
        - name: leadscoringservice
          image: ghcr.io/gregorymorenoiem/leadscoringservice:latest
          ports:
            - containerPort: 8080
          env:
            - name: ASPNETCORE_URLS
              value: "http://+:8080"
          envFrom:
            - configMapRef:
                name: global-config
            - secretRef:
                name: leadscoringservice-db-secret
            - secretRef:
                name: jwt-secrets
            - secretRef:
                name: redis-secrets
            - secretRef:
                name: rabbitmq-secrets
          resources:
            requests:
              memory: "128Mi"
              cpu: "50m"
            limits:
              memory: "256Mi"
              cpu: "200m"
          securityContext:
            runAsNonRoot: true
            runAsUser: 1000
            allowPrivilegeEscalation: false
            readOnlyRootFilesystem: true
            capabilities:
              drop:
                - ALL
          startupProbe:
            httpGet:
              path: /health
              port: 8080
            initialDelaySeconds: 10
            periodSeconds: 5
            failureThreshold: 24
          livenessProbe:
            httpGet:
              path: /health
              port: 8080
            periodSeconds: 30
            timeoutSeconds: 5
            failureThreshold: 3
          readinessProbe:
            httpGet:
              path: /health/ready
              port: 8080
            periodSeconds: 10
            timeoutSeconds: 5
            failureThreshold: 3
          volumeMounts:
            - name: tmp
              mountPath: /tmp
      volumes:
        - name: tmp
          emptyDir: {}

---
# =============================================================================
# MAINTENANCE SERVICE
# =============================================================================
apiVersion: apps/v1
kind: Deployment
metadata:
  name: maintenanceservice
  namespace: okla
  labels:
    app: maintenanceservice
    tier: backend
spec:
  replicas: 0 # DISABLED: cluster capacity
  selector:
    matchLabels:
      app: maintenanceservice
  template:
    metadata:
      labels:
        app: maintenanceservice
    spec:
      serviceAccountName: okla-backend
      automountServiceAccountToken: false
      topologySpreadConstraints:
        - maxSkew: 1
          topologyKey: kubernetes.io/hostname
          whenUnsatisfiable: ScheduleAnyway
          labelSelector:
            matchLabels:
              app: maintenanceservice
      imagePullSecrets:
        - name: registry-credentials
      containers:
        - name: maintenanceservice
          image: ghcr.io/gregorymorenoiem/maintenanceservice:latest
          ports:
            - containerPort: 8080
          env:
            - name: ASPNETCORE_URLS
              value: "http://+:8080"
          envFrom:
            - configMapRef:
                name: global-config
            - secretRef:
                name: maintenanceservice-db-secret
            - secretRef:
                name: jwt-secrets
            - secretRef:
                name: redis-secrets
            - secretRef:
                name: rabbitmq-secrets
          resources:
            requests:
              memory: "128Mi"
              cpu: "50m"
            limits:
              memory: "256Mi"
              cpu: "200m"
          securityContext:
            runAsNonRoot: true
            runAsUser: 1000
            allowPrivilegeEscalation: false
            readOnlyRootFilesystem: true
            capabilities:
              drop:
                - ALL
          startupProbe:
            httpGet:
              path: /health
              port: 8080
            initialDelaySeconds: 10
            periodSeconds: 5
            failureThreshold: 24
          livenessProbe:
            httpGet:
              path: /health
              port: 8080
            periodSeconds: 30
            timeoutSeconds: 5
            failureThreshold: 3
          readinessProbe:
            httpGet:
              path: /health/ready
              port: 8080
            periodSeconds: 10
            timeoutSeconds: 5
            failureThreshold: 3
          volumeMounts:
            - name: tmp
              mountPath: /tmp
      volumes:
        - name: tmp
          emptyDir: {}

---
# =============================================================================
# MARKETING SERVICE
# =============================================================================
apiVersion: apps/v1
kind: Deployment
metadata:
  name: marketingservice
  namespace: okla
  labels:
    app: marketingservice
    tier: backend
spec:
  replicas: 0 # DISABLED: cluster capacity
  selector:
    matchLabels:
      app: marketingservice
  template:
    metadata:
      labels:
        app: marketingservice
    spec:
      serviceAccountName: okla-backend
      automountServiceAccountToken: false
      topologySpreadConstraints:
        - maxSkew: 1
          topologyKey: kubernetes.io/hostname
          whenUnsatisfiable: ScheduleAnyway
          labelSelector:
            matchLabels:
              app: marketingservice
      imagePullSecrets:
        - name: registry-credentials
      containers:
        - name: marketingservice
          image: ghcr.io/gregorymorenoiem/marketingservice:latest
          ports:
            - containerPort: 8080
          env:
            - name: ASPNETCORE_URLS
              value: "http://+:8080"
          envFrom:
            - configMapRef:
                name: global-config
            - secretRef:
                name: marketingservice-db-secret
            - secretRef:
                name: jwt-secrets
            - secretRef:
                name: redis-secrets
            - secretRef:
                name: rabbitmq-secrets
          resources:
            requests:
              memory: "128Mi"
              cpu: "50m"
            limits:
              memory: "256Mi"
              cpu: "200m"
          securityContext:
            runAsNonRoot: true
            runAsUser: 1000
            allowPrivilegeEscalation: false
            readOnlyRootFilesystem: true
            capabilities:
              drop:
                - ALL
          startupProbe:
            httpGet:
              path: /health
              port: 8080
            initialDelaySeconds: 10
            periodSeconds: 5
            failureThreshold: 24
          livenessProbe:
            httpGet:
              path: /health
              port: 8080
            periodSeconds: 30
            timeoutSeconds: 5
            failureThreshold: 3
          readinessProbe:
            httpGet:
              path: /health/ready
              port: 8080
            periodSeconds: 10
            timeoutSeconds: 5
            failureThreshold: 3
          volumeMounts:
            - name: tmp
              mountPath: /tmp
      volumes:
        - name: tmp
          emptyDir: {}

---
# =============================================================================
# MESSAGE BUS SERVICE
# =============================================================================
apiVersion: apps/v1
kind: Deployment
metadata:
  name: messagebusservice
  namespace: okla
  labels:
    app: messagebusservice
    tier: backend
spec:
  replicas: 0 # DISABLED: cluster capacity
  selector:
    matchLabels:
      app: messagebusservice
  template:
    metadata:
      labels:
        app: messagebusservice
    spec:
      serviceAccountName: okla-backend
      automountServiceAccountToken: false
      topologySpreadConstraints:
        - maxSkew: 1
          topologyKey: kubernetes.io/hostname
          whenUnsatisfiable: ScheduleAnyway
          labelSelector:
            matchLabels:
              app: messagebusservice
      imagePullSecrets:
        - name: registry-credentials
      containers:
        - name: messagebusservice
          image: ghcr.io/gregorymorenoiem/messagebusservice:latest
          ports:
            - containerPort: 8080
          env:
            - name: ASPNETCORE_URLS
              value: "http://+:8080"
          envFrom:
            - configMapRef:
                name: global-config
            - secretRef:
                name: messagebusservice-db-secret
            - secretRef:
                name: jwt-secrets
            - secretRef:
                name: redis-secrets
            - secretRef:
                name: rabbitmq-secrets
          resources:
            requests:
              memory: "128Mi"
              cpu: "50m"
            limits:
              memory: "256Mi"
              cpu: "200m"
          securityContext:
            runAsNonRoot: true
            runAsUser: 1000
            allowPrivilegeEscalation: false
            readOnlyRootFilesystem: true
            capabilities:
              drop:
                - ALL
          startupProbe:
            httpGet:
              path: /health
              port: 8080
            initialDelaySeconds: 10
            periodSeconds: 5
            failureThreshold: 24
          livenessProbe:
            httpGet:
              path: /health
              port: 8080
            periodSeconds: 30
            timeoutSeconds: 5
            failureThreshold: 3
          readinessProbe:
            httpGet:
              path: /health/ready
              port: 8080
            periodSeconds: 10
            timeoutSeconds: 5
            failureThreshold: 3
          volumeMounts:
            - name: tmp
              mountPath: /tmp
      volumes:
        - name: tmp
          emptyDir: {}

---
# =============================================================================
# PAYMENT SERVICE
# =============================================================================
apiVersion: apps/v1
kind: Deployment
metadata:
  name: paymentservice
  namespace: okla
  labels:
    app: paymentservice
    tier: backend
spec:
  replicas: 0 # DISABLED: cluster capacity
  selector:
    matchLabels:
      app: paymentservice
  template:
    metadata:
      labels:
        app: paymentservice
    spec:
      serviceAccountName: okla-backend
      automountServiceAccountToken: false
      topologySpreadConstraints:
        - maxSkew: 1
          topologyKey: kubernetes.io/hostname
          whenUnsatisfiable: ScheduleAnyway
          labelSelector:
            matchLabels:
              app: paymentservice
      imagePullSecrets:
        - name: registry-credentials
      containers:
        - name: paymentservice
          image: ghcr.io/gregorymorenoiem/paymentservice:latest
          ports:
            - containerPort: 8080
          env:
            - name: ASPNETCORE_URLS
              value: "http://+:8080"
          envFrom:
            - configMapRef:
                name: global-config
            - secretRef:
                name: paymentservice-db-secret
            - secretRef:
                name: jwt-secrets
            - secretRef:
                name: redis-secrets
            - secretRef:
                name: rabbitmq-secrets
          resources:
            requests:
              memory: "128Mi"
              cpu: "50m"
            limits:
              memory: "256Mi"
              cpu: "200m"
          securityContext:
            runAsNonRoot: true
            runAsUser: 1000
            allowPrivilegeEscalation: false
            readOnlyRootFilesystem: true
            capabilities:
              drop:
                - ALL
          startupProbe:
            httpGet:
              path: /health
              port: 8080
            initialDelaySeconds: 10
            periodSeconds: 5
            failureThreshold: 24
          livenessProbe:
            httpGet:
              path: /health
              port: 8080
            periodSeconds: 30
            timeoutSeconds: 5
            failureThreshold: 3
          readinessProbe:
            httpGet:
              path: /health/ready
              port: 8080
            periodSeconds: 10
            timeoutSeconds: 5
            failureThreshold: 3
          volumeMounts:
            - name: tmp
              mountPath: /tmp
      volumes:
        - name: tmp
          emptyDir: {}

---
# =============================================================================
# RATE LIMITING SERVICE
# =============================================================================
apiVersion: apps/v1
kind: Deployment
metadata:
  name: ratelimitingservice
  namespace: okla
  labels:
    app: ratelimitingservice
    tier: backend
spec:
  replicas: 0 # DISABLED: cluster capacity
  selector:
    matchLabels:
      app: ratelimitingservice
  template:
    metadata:
      labels:
        app: ratelimitingservice
    spec:
      serviceAccountName: okla-backend
      automountServiceAccountToken: false
      topologySpreadConstraints:
        - maxSkew: 1
          topologyKey: kubernetes.io/hostname
          whenUnsatisfiable: ScheduleAnyway
          labelSelector:
            matchLabels:
              app: ratelimitingservice
      imagePullSecrets:
        - name: registry-credentials
      containers:
        - name: ratelimitingservice
          image: ghcr.io/gregorymorenoiem/ratelimitingservice:latest
          ports:
            - containerPort: 8080
          env:
            - name: ASPNETCORE_URLS
              value: "http://+:8080"
          envFrom:
            - configMapRef:
                name: global-config
            - secretRef:
                name: ratelimitingservice-db-secret
            - secretRef:
                name: jwt-secrets
            - secretRef:
                name: redis-secrets
            - secretRef:
                name: rabbitmq-secrets
          resources:
            requests:
              memory: "128Mi"
              cpu: "50m"
            limits:
              memory: "256Mi"
              cpu: "200m"
          securityContext:
            runAsNonRoot: true
            runAsUser: 1000
            allowPrivilegeEscalation: false
            readOnlyRootFilesystem: true
            capabilities:
              drop:
                - ALL
          startupProbe:
            httpGet:
              path: /health
              port: 8080
            initialDelaySeconds: 10
            periodSeconds: 5
            failureThreshold: 24
          livenessProbe:
            httpGet:
              path: /health
              port: 8080
            periodSeconds: 30
            timeoutSeconds: 5
            failureThreshold: 3
          readinessProbe:
            httpGet:
              path: /health/ready
              port: 8080
            periodSeconds: 10
            timeoutSeconds: 5
            failureThreshold: 3
          volumeMounts:
            - name: tmp
              mountPath: /tmp
      volumes:
        - name: tmp
          emptyDir: {}

---
# =============================================================================
# RECOMMENDATION SERVICE
# =============================================================================
apiVersion: apps/v1
kind: Deployment
metadata:
  name: recommendationservice
  namespace: okla
  labels:
    app: recommendationservice
    tier: backend
spec:
  replicas: 0 # DISABLED: cluster capacity
  selector:
    matchLabels:
      app: recommendationservice
  template:
    metadata:
      labels:
        app: recommendationservice
    spec:
      serviceAccountName: okla-backend
      automountServiceAccountToken: false
      topologySpreadConstraints:
        - maxSkew: 1
          topologyKey: kubernetes.io/hostname
          whenUnsatisfiable: ScheduleAnyway
          labelSelector:
            matchLabels:
              app: recommendationservice
      imagePullSecrets:
        - name: registry-credentials
      containers:
        - name: recommendationservice
          image: ghcr.io/gregorymorenoiem/recommendationservice:latest
          ports:
            - containerPort: 8080
          env:
            - name: ASPNETCORE_URLS
              value: "http://+:8080"
          envFrom:
            - configMapRef:
                name: global-config
            - secretRef:
                name: recommendationservice-db-secret
            - secretRef:
                name: jwt-secrets
            - secretRef:
                name: redis-secrets
            - secretRef:
                name: rabbitmq-secrets
          resources:
            requests:
              memory: "128Mi"
              cpu: "50m"
            limits:
              memory: "256Mi"
              cpu: "200m"
          securityContext:
            runAsNonRoot: true
            runAsUser: 1000
            allowPrivilegeEscalation: false
            readOnlyRootFilesystem: true
            capabilities:
              drop:
                - ALL
          startupProbe:
            httpGet:
              path: /health
              port: 8080
            initialDelaySeconds: 10
            periodSeconds: 5
            failureThreshold: 24
          livenessProbe:
            httpGet:
              path: /health
              port: 8080
            periodSeconds: 30
            timeoutSeconds: 5
            failureThreshold: 3
          readinessProbe:
            httpGet:
              path: /health/ready
              port: 8080
            periodSeconds: 10
            timeoutSeconds: 5
            failureThreshold: 3
          volumeMounts:
            - name: tmp
              mountPath: /tmp
      volumes:
        - name: tmp
          emptyDir: {}

---
# =============================================================================
# REPORTS SERVICE
# =============================================================================
apiVersion: apps/v1
kind: Deployment
metadata:
  name: reportsservice
  namespace: okla
  labels:
    app: reportsservice
    tier: backend
spec:
  replicas: 0 # DISABLED: cluster capacity
  selector:
    matchLabels:
      app: reportsservice
  template:
    metadata:
      labels:
        app: reportsservice
    spec:
      serviceAccountName: okla-backend
      automountServiceAccountToken: false
      topologySpreadConstraints:
        - maxSkew: 1
          topologyKey: kubernetes.io/hostname
          whenUnsatisfiable: ScheduleAnyway
          labelSelector:
            matchLabels:
              app: reportsservice
      imagePullSecrets:
        - name: registry-credentials
      containers:
        - name: reportsservice
          image: ghcr.io/gregorymorenoiem/reportsservice:latest
          ports:
            - containerPort: 8080
          env:
            - name: ASPNETCORE_URLS
              value: "http://+:8080"
          envFrom:
            - configMapRef:
                name: global-config
            - secretRef:
                name: reportsservice-db-secret
            - secretRef:
                name: jwt-secrets
            - secretRef:
                name: redis-secrets
            - secretRef:
                name: rabbitmq-secrets
          resources:
            requests:
              memory: "128Mi"
              cpu: "50m"
            limits:
              memory: "256Mi"
              cpu: "200m"
          securityContext:
            runAsNonRoot: true
            runAsUser: 1000
            allowPrivilegeEscalation: false
            readOnlyRootFilesystem: true
            capabilities:
              drop:
                - ALL
          startupProbe:
            httpGet:
              path: /health
              port: 8080
            initialDelaySeconds: 10
            periodSeconds: 5
            failureThreshold: 24
          livenessProbe:
            httpGet:
              path: /health
              port: 8080
            periodSeconds: 30
            timeoutSeconds: 5
            failureThreshold: 3
          readinessProbe:
            httpGet:
              path: /health/ready
              port: 8080
            periodSeconds: 10
            timeoutSeconds: 5
            failureThreshold: 3
          volumeMounts:
            - name: tmp
              mountPath: /tmp
      volumes:
        - name: tmp
          emptyDir: {}

---
# =============================================================================
# SCHEDULER SERVICE
# =============================================================================
apiVersion: apps/v1
kind: Deployment
metadata:
  name: schedulerservice
  namespace: okla
  labels:
    app: schedulerservice
    tier: backend
spec:
  replicas: 0 # DISABLED: cluster capacity
  selector:
    matchLabels:
      app: schedulerservice
  template:
    metadata:
      labels:
        app: schedulerservice
    spec:
      serviceAccountName: okla-backend
      automountServiceAccountToken: false
      topologySpreadConstraints:
        - maxSkew: 1
          topologyKey: kubernetes.io/hostname
          whenUnsatisfiable: ScheduleAnyway
          labelSelector:
            matchLabels:
              app: schedulerservice
      imagePullSecrets:
        - name: registry-credentials
      containers:
        - name: schedulerservice
          image: ghcr.io/gregorymorenoiem/schedulerservice:latest
          ports:
            - containerPort: 8080
          env:
            - name: ASPNETCORE_URLS
              value: "http://+:8080"
          envFrom:
            - configMapRef:
                name: global-config
            - secretRef:
                name: schedulerservice-db-secret
            - secretRef:
                name: jwt-secrets
            - secretRef:
                name: redis-secrets
            - secretRef:
                name: rabbitmq-secrets
          resources:
            requests:
              memory: "128Mi"
              cpu: "50m"
            limits:
              memory: "256Mi"
              cpu: "200m"
          securityContext:
            runAsNonRoot: true
            runAsUser: 1000
            allowPrivilegeEscalation: false
            readOnlyRootFilesystem: true
            capabilities:
              drop:
                - ALL
          startupProbe:
            httpGet:
              path: /health
              port: 8080
            initialDelaySeconds: 10
            periodSeconds: 5
            failureThreshold: 24
          livenessProbe:
            httpGet:
              path: /health
              port: 8080
            periodSeconds: 30
            timeoutSeconds: 5
            failureThreshold: 3
          readinessProbe:
            httpGet:
              path: /health/ready
              port: 8080
            periodSeconds: 10
            timeoutSeconds: 5
            failureThreshold: 3
          volumeMounts:
            - name: tmp
              mountPath: /tmp
      volumes:
        - name: tmp
          emptyDir: {}

---
# =============================================================================
# SERVICE DISCOVERY SERVICE
# =============================================================================
apiVersion: apps/v1
kind: Deployment
metadata:
  name: servicediscovery
  namespace: okla
  labels:
    app: servicediscovery
    tier: backend
spec:
  replicas: 0 # DISABLED: cluster capacity
  selector:
    matchLabels:
      app: servicediscovery
  template:
    metadata:
      labels:
        app: servicediscovery
    spec:
      serviceAccountName: okla-backend
      automountServiceAccountToken: false
      topologySpreadConstraints:
        - maxSkew: 1
          topologyKey: kubernetes.io/hostname
          whenUnsatisfiable: ScheduleAnyway
          labelSelector:
            matchLabels:
              app: servicediscovery
      imagePullSecrets:
        - name: registry-credentials
      containers:
        - name: servicediscovery
          image: ghcr.io/gregorymorenoiem/servicediscovery:latest
          ports:
            - containerPort: 8080
          env:
            - name: ASPNETCORE_URLS
              value: "http://+:8080"
          envFrom:
            - configMapRef:
                name: global-config
            - secretRef:
                name: servicediscovery-db-secret
            - secretRef:
                name: jwt-secrets
            - secretRef:
                name: redis-secrets
            - secretRef:
                name: rabbitmq-secrets
          resources:
            requests:
              memory: "128Mi"
              cpu: "50m"
            limits:
              memory: "256Mi"
              cpu: "200m"
          securityContext:
            runAsNonRoot: true
            runAsUser: 1000
            allowPrivilegeEscalation: false
            readOnlyRootFilesystem: true
            capabilities:
              drop:
                - ALL
          startupProbe:
            httpGet:
              path: /health
              port: 8080
            initialDelaySeconds: 10
            periodSeconds: 5
            failureThreshold: 24
          livenessProbe:
            httpGet:
              path: /health
              port: 8080
            periodSeconds: 30
            timeoutSeconds: 5
            failureThreshold: 3
          readinessProbe:
            httpGet:
              path: /health/ready
              port: 8080
            periodSeconds: 10
            timeoutSeconds: 5
            failureThreshold: 3
          volumeMounts:
            - name: tmp
              mountPath: /tmp
      volumes:
        - name: tmp
          emptyDir: {}

---
# =============================================================================
# STAFF SERVICE
# =============================================================================
apiVersion: apps/v1
kind: Deployment
metadata:
  name: staffservice
  namespace: okla
  labels:
    app: staffservice
    tier: backend
spec:
  replicas: 0 # DISABLED: cluster capacity
  selector:
    matchLabels:
      app: staffservice
  template:
    metadata:
      labels:
        app: staffservice
    spec:
      serviceAccountName: okla-backend
      automountServiceAccountToken: false
      topologySpreadConstraints:
        - maxSkew: 1
          topologyKey: kubernetes.io/hostname
          whenUnsatisfiable: ScheduleAnyway
          labelSelector:
            matchLabels:
              app: staffservice
      imagePullSecrets:
        - name: registry-credentials
      containers:
        - name: staffservice
          image: ghcr.io/gregorymorenoiem/staffservice:latest
          ports:
            - containerPort: 8080
          env:
            - name: ASPNETCORE_URLS
              value: "http://+:8080"
          envFrom:
            - configMapRef:
                name: global-config
            - secretRef:
                name: staffservice-db-secret
            - secretRef:
                name: jwt-secrets
            - secretRef:
                name: redis-secrets
            - secretRef:
                name: rabbitmq-secrets
          resources:
            requests:
              memory: "128Mi"
              cpu: "50m"
            limits:
              memory: "256Mi"
              cpu: "200m"
          securityContext:
            runAsNonRoot: true
            runAsUser: 1000
            allowPrivilegeEscalation: false
            readOnlyRootFilesystem: true
            capabilities:
              drop:
                - ALL
          startupProbe:
            httpGet:
              path: /health
              port: 8080
            initialDelaySeconds: 10
            periodSeconds: 5
            failureThreshold: 24
          livenessProbe:
            httpGet:
              path: /health
              port: 8080
            periodSeconds: 30
            timeoutSeconds: 5
            failureThreshold: 3
          readinessProbe:
            httpGet:
              path: /health/ready
              port: 8080
            periodSeconds: 10
            timeoutSeconds: 5
            failureThreshold: 3
          volumeMounts:
            - name: tmp
              mountPath: /tmp
      volumes:
        - name: tmp
          emptyDir: {}

---
# =============================================================================
# VEHICLE 360 PROCESSING SERVICE
# =============================================================================
apiVersion: apps/v1
kind: Deployment
metadata:
  name: vehicle360processingservice
  namespace: okla
  labels:
    app: vehicle360processingservice
    tier: backend
spec:
  replicas: 0 # DISABLED: cluster capacity
  selector:
    matchLabels:
      app: vehicle360processingservice
  template:
    metadata:
      labels:
        app: vehicle360processingservice
    spec:
      serviceAccountName: okla-backend
      automountServiceAccountToken: false
      topologySpreadConstraints:
        - maxSkew: 1
          topologyKey: kubernetes.io/hostname
          whenUnsatisfiable: ScheduleAnyway
          labelSelector:
            matchLabels:
              app: vehicle360processingservice
      imagePullSecrets:
        - name: registry-credentials
      containers:
        - name: vehicle360processingservice
          image: ghcr.io/gregorymorenoiem/vehicle360processingservice:latest
          ports:
            - containerPort: 8080
          env:
            - name: ASPNETCORE_URLS
              value: "http://+:8080"
          envFrom:
            - configMapRef:
                name: global-config
            - secretRef:
                name: vehicle360processingservice-db-secret
            - secretRef:
                name: jwt-secrets
            - secretRef:
                name: redis-secrets
            - secretRef:
                name: rabbitmq-secrets
          resources:
            requests:
              memory: "128Mi"
              cpu: "50m"
            limits:
              memory: "256Mi"
              cpu: "200m"
          securityContext:
            runAsNonRoot: true
            runAsUser: 1000
            allowPrivilegeEscalation: false
            readOnlyRootFilesystem: true
            capabilities:
              drop:
                - ALL
          startupProbe:
            httpGet:
              path: /health
              port: 8080
            initialDelaySeconds: 10
            periodSeconds: 5
            failureThreshold: 24
          livenessProbe:
            httpGet:
              path: /health
              port: 8080
            periodSeconds: 30
            timeoutSeconds: 5
            failureThreshold: 3
          readinessProbe:
            httpGet:
              path: /health/ready
              port: 8080
            periodSeconds: 10
            timeoutSeconds: 5
            failureThreshold: 3
          volumeMounts:
            - name: tmp
              mountPath: /tmp
      volumes:
        - name: tmp
          emptyDir: {}

---
# =============================================================================
# VEHICLE INTELLIGENCE SERVICE
# =============================================================================
apiVersion: apps/v1
kind: Deployment
metadata:
  name: vehicleintelligenceservice
  namespace: okla
  labels:
    app: vehicleintelligenceservice
    tier: backend
spec:
  replicas: 0 # DISABLED: cluster capacity
  selector:
    matchLabels:
      app: vehicleintelligenceservice
  template:
    metadata:
      labels:
        app: vehicleintelligenceservice
    spec:
      serviceAccountName: okla-backend
      automountServiceAccountToken: false
      topologySpreadConstraints:
        - maxSkew: 1
          topologyKey: kubernetes.io/hostname
          whenUnsatisfiable: ScheduleAnyway
          labelSelector:
            matchLabels:
              app: vehicleintelligenceservice
      imagePullSecrets:
        - name: registry-credentials
      containers:
        - name: vehicleintelligenceservice
          image: ghcr.io/gregorymorenoiem/vehicleintelligenceservice:latest
          ports:
            - containerPort: 8080
          env:
            - name: ASPNETCORE_URLS
              value: "http://+:8080"
          envFrom:
            - configMapRef:
                name: global-config
            - secretRef:
                name: vehicleintelligenceservice-db-secret
            - secretRef:
                name: jwt-secrets
            - secretRef:
                name: redis-secrets
            - secretRef:
                name: rabbitmq-secrets
          resources:
            requests:
              memory: "128Mi"
              cpu: "50m"
            limits:
              memory: "256Mi"
              cpu: "200m"
          securityContext:
            runAsNonRoot: true
            runAsUser: 1000
            allowPrivilegeEscalation: false
            readOnlyRootFilesystem: true
            capabilities:
              drop:
                - ALL
          startupProbe:
            httpGet:
              path: /health
              port: 8080
            initialDelaySeconds: 10
            periodSeconds: 5
            failureThreshold: 24
          livenessProbe:
            httpGet:
              path: /health
              port: 8080
            periodSeconds: 30
            timeoutSeconds: 5
            failureThreshold: 3
          readinessProbe:
            httpGet:
              path: /health/ready
              port: 8080
            periodSeconds: 10
            timeoutSeconds: 5
            failureThreshold: 3
          volumeMounts:
            - name: tmp
              mountPath: /tmp
      volumes:
        - name: tmp
          emptyDir: {}

---
# =============================================================================
# ADVERTISING SERVICE ‚Äî Homepage Ads, Campaigns, Rotation
# =============================================================================
apiVersion: apps/v1
kind: Deployment
metadata:
  name: advertisingservice
  namespace: okla
  labels:
    app: advertisingservice
    tier: backend
spec:
  replicas: 0
  selector:
    matchLabels:
      app: advertisingservice
  template:
    metadata:
      labels:
        app: advertisingservice
    spec:
      serviceAccountName: okla-backend
      automountServiceAccountToken: false
      topologySpreadConstraints:
        - maxSkew: 1
          topologyKey: kubernetes.io/hostname
          whenUnsatisfiable: ScheduleAnyway
          labelSelector:
            matchLabels:
              app: advertisingservice
      imagePullSecrets:
        - name: registry-credentials
      containers:
        - name: advertisingservice
          image: ghcr.io/gregorymorenoiem/advertisingservice:latest
          ports:
            - containerPort: 8080
          env:
            - name: ASPNETCORE_URLS
              value: "http://+:8080"
            - name: ASPNETCORE_ENVIRONMENT
              value: "Docker"
          envFrom:
            - configMapRef:
                name: global-config
            - secretRef:
                name: advertisingservice-db-secret
            - secretRef:
                name: jwt-secrets
            - secretRef:
                name: redis-secrets
            - secretRef:
                name: rabbitmq-secrets
          resources:
            requests:
              memory: "256Mi"
              cpu: "100m"
            limits:
              memory: "512Mi"
              cpu: "500m"
          securityContext:
            runAsNonRoot: true
            runAsUser: 1000
            allowPrivilegeEscalation: false
            readOnlyRootFilesystem: true
            capabilities:
              drop:
                - ALL
          startupProbe:
            httpGet:
              path: /health/live
              port: 8080
            initialDelaySeconds: 10
            periodSeconds: 5
            failureThreshold: 24
          livenessProbe:
            httpGet:
              path: /health/live
              port: 8080
            periodSeconds: 30
            timeoutSeconds: 5
            failureThreshold: 3
          readinessProbe:
            httpGet:
              path: /health/ready
              port: 8080
            periodSeconds: 10
            timeoutSeconds: 5
            failureThreshold: 3
          volumeMounts:
            - name: tmp
              mountPath: /tmp
      volumes:
        - name: tmp
          emptyDir: {}
