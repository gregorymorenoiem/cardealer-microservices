# =============================================================================
# CONFIGMAPS - Non-sensitive Configuration
# =============================================================================
# ⚠️ SECURITY: NO credentials here. All secrets go in secrets.yaml
# RabbitMQ, Redis, DB credentials are in Kubernetes Secrets
# =============================================================================

---
apiVersion: v1
kind: ConfigMap
metadata:
  name: global-config
  namespace: okla
data:
  ASPNETCORE_ENVIRONMENT: "Production"
  TZ: "America/New_York"

  # Redis (host only — password in Secret)
  Cache__Provider: "Redis"
  Cache__Redis__Host: "redis"
  Cache__Redis__Port: "6379"

  # RabbitMQ (host/port only — credentials in rabbitmq-secrets)
  RabbitMQ__Host: "rabbitmq"
  RabbitMQ__HostName: "rabbitmq"
  RabbitMQ__Port: "5672"
  RabbitMQ__VirtualHost: "/"
  RabbitMQ__ExchangeName: "cardealer.events"

  # Logging
  Serilog__MinimumLevel__Default: "Information"
  Serilog__MinimumLevel__Override__Microsoft: "Warning"
  Serilog__MinimumLevel__Override__System: "Warning"

  # OpenTelemetry (enabled for observability)
  OpenTelemetry__Enabled: "true"
  OpenTelemetry__ServiceName: "okla"
  OpenTelemetry__ExporterEndpoint: "http://otel-collector:4317"

  # Consul (disabled — using K8s service discovery)
  Consul__Enabled: "false"

---
apiVersion: v1
kind: ConfigMap
metadata:
  name: gateway-config
  namespace: okla
data:
  ocelot.json: |
    {
      "Routes": [
        {
          "UpstreamPathTemplate": "/api/auth/{everything}",
          "UpstreamHttpMethod": ["GET", "POST", "PUT", "DELETE", "OPTIONS"],
          "DownstreamPathTemplate": "/api/auth/{everything}",
          "DownstreamScheme": "http",
          "DownstreamHostAndPorts": [{ "Host": "authservice", "Port": 8080 }]
        },
        {
          "UpstreamPathTemplate": "/api/auth",
          "UpstreamHttpMethod": ["GET", "POST", "PUT", "DELETE", "OPTIONS"],
          "DownstreamPathTemplate": "/api/auth",
          "DownstreamScheme": "http",
          "DownstreamHostAndPorts": [{ "Host": "authservice", "Port": 8080 }]
        },
        {
          "UpstreamPathTemplate": "/api/users/{everything}",
          "UpstreamHttpMethod": ["GET", "POST", "PUT", "DELETE", "OPTIONS"],
          "DownstreamPathTemplate": "/api/users/{everything}",
          "DownstreamScheme": "http",
          "DownstreamHostAndPorts": [{ "Host": "userservice", "Port": 8080 }]
        },
        {
          "UpstreamPathTemplate": "/api/users",
          "UpstreamHttpMethod": ["GET", "POST", "PUT", "DELETE", "OPTIONS"],
          "DownstreamPathTemplate": "/api/users",
          "DownstreamScheme": "http",
          "DownstreamHostAndPorts": [{ "Host": "userservice", "Port": 8080 }]
        },
        {
          "UpstreamPathTemplate": "/api/roles/{everything}",
          "UpstreamHttpMethod": ["GET", "POST", "PUT", "DELETE", "OPTIONS"],
          "DownstreamPathTemplate": "/api/roles/{everything}",
          "DownstreamScheme": "http",
          "DownstreamHostAndPorts": [{ "Host": "roleservice", "Port": 8080 }]
        },
        {
          "UpstreamPathTemplate": "/api/roles",
          "UpstreamHttpMethod": ["GET", "POST", "PUT", "DELETE", "OPTIONS"],
          "DownstreamPathTemplate": "/api/roles",
          "DownstreamScheme": "http",
          "DownstreamHostAndPorts": [{ "Host": "roleservice", "Port": 8080 }]
        },
        {
          "UpstreamPathTemplate": "/api/vehicles/{everything}",
          "UpstreamHttpMethod": ["GET", "POST", "PUT", "DELETE", "OPTIONS"],
          "DownstreamPathTemplate": "/api/vehicles/{everything}",
          "DownstreamScheme": "http",
          "DownstreamHostAndPorts": [{ "Host": "vehiclessaleservice", "Port": 8080 }]
        },
        {
          "UpstreamPathTemplate": "/api/vehicles",
          "UpstreamHttpMethod": ["GET", "POST", "PUT", "DELETE", "OPTIONS"],
          "DownstreamPathTemplate": "/api/vehicles",
          "DownstreamScheme": "http",
          "DownstreamHostAndPorts": [{ "Host": "vehiclessaleservice", "Port": 8080 }]
        },
        {
          "UpstreamPathTemplate": "/api/media/{everything}",
          "UpstreamHttpMethod": ["GET", "POST", "PUT", "DELETE", "OPTIONS"],
          "DownstreamPathTemplate": "/api/media/{everything}",
          "DownstreamScheme": "http",
          "DownstreamHostAndPorts": [{ "Host": "mediaservice", "Port": 8080 }]
        },
        {
          "UpstreamPathTemplate": "/api/media",
          "UpstreamHttpMethod": ["GET", "POST", "PUT", "DELETE", "OPTIONS"],
          "DownstreamPathTemplate": "/api/media",
          "DownstreamScheme": "http",
          "DownstreamHostAndPorts": [{ "Host": "mediaservice", "Port": 8080 }]
        },
        {
          "UpstreamPathTemplate": "/api/billing/{everything}",
          "UpstreamHttpMethod": ["GET", "POST", "PUT", "DELETE", "OPTIONS"],
          "DownstreamPathTemplate": "/api/billing/{everything}",
          "DownstreamScheme": "http",
          "DownstreamHostAndPorts": [{ "Host": "billingservice", "Port": 8080 }]
        },
        {
          "UpstreamPathTemplate": "/api/billing",
          "UpstreamHttpMethod": ["GET", "POST", "PUT", "DELETE", "OPTIONS"],
          "DownstreamPathTemplate": "/api/billing",
          "DownstreamScheme": "http",
          "DownstreamHostAndPorts": [{ "Host": "billingservice", "Port": 8080 }]
        },
        {
          "UpstreamPathTemplate": "/api/notifications/{everything}",
          "UpstreamHttpMethod": ["GET", "POST", "PUT", "DELETE", "OPTIONS"],
          "DownstreamPathTemplate": "/api/notifications/{everything}",
          "DownstreamScheme": "http",
          "DownstreamHostAndPorts": [{ "Host": "notificationservice", "Port": 8080 }]
        },
        {
          "UpstreamPathTemplate": "/api/notifications",
          "UpstreamHttpMethod": ["GET", "POST", "PUT", "DELETE", "OPTIONS"],
          "DownstreamPathTemplate": "/api/notifications",
          "DownstreamScheme": "http",
          "DownstreamHostAndPorts": [{ "Host": "notificationservice", "Port": 8080 }]
        },
        {
          "UpstreamPathTemplate": "/api/errors/{everything}",
          "UpstreamHttpMethod": ["GET", "POST", "PUT", "DELETE", "OPTIONS"],
          "DownstreamPathTemplate": "/api/errors/{everything}",
          "DownstreamScheme": "http",
          "DownstreamHostAndPorts": [{ "Host": "errorservice", "Port": 8080 }]
        },
        {
          "UpstreamPathTemplate": "/api/errors",
          "UpstreamHttpMethod": ["GET", "POST", "PUT", "DELETE", "OPTIONS"],
          "DownstreamPathTemplate": "/api/errors",
          "DownstreamScheme": "http",
          "DownstreamHostAndPorts": [{ "Host": "errorservice", "Port": 8080 }]
        },
        {
          "UpstreamPathTemplate": "/api/kyc/kycprofiles/pending",
          "UpstreamHttpMethod": ["OPTIONS", "GET"],
          "DownstreamPathTemplate": "/api/kycprofiles/pending",
          "DownstreamScheme": "http",
          "DownstreamHostAndPorts": [{ "Host": "kycservice", "Port": 8080 }],
          "AuthenticationOptions": { "AuthenticationProviderKey": "Bearer" },
          "RouteClaimsRequirement": { "account_type": "4, 5" }
        },
        {
          "UpstreamPathTemplate": "/api/kyc/kycprofiles/statistics",
          "UpstreamHttpMethod": ["OPTIONS", "GET"],
          "DownstreamPathTemplate": "/api/kycprofiles/statistics",
          "DownstreamScheme": "http",
          "DownstreamHostAndPorts": [{ "Host": "kycservice", "Port": 8080 }],
          "AuthenticationOptions": { "AuthenticationProviderKey": "Bearer" },
          "RouteClaimsRequirement": { "account_type": "4, 5" }
        },
        {
          "UpstreamPathTemplate": "/api/kyc/kycprofiles/expiring",
          "UpstreamHttpMethod": ["OPTIONS", "GET"],
          "DownstreamPathTemplate": "/api/kycprofiles/expiring",
          "DownstreamScheme": "http",
          "DownstreamHostAndPorts": [{ "Host": "kycservice", "Port": 8080 }],
          "AuthenticationOptions": { "AuthenticationProviderKey": "Bearer" },
          "RouteClaimsRequirement": { "account_type": "4, 5" }
        },
        {
          "UpstreamPathTemplate": "/api/kyc/kycprofiles/settings",
          "UpstreamHttpMethod": ["OPTIONS", "GET"],
          "DownstreamPathTemplate": "/api/kycprofiles/settings",
          "DownstreamScheme": "http",
          "DownstreamHostAndPorts": [{ "Host": "kycservice", "Port": 8080 }],
          "AuthenticationOptions": { "AuthenticationProviderKey": "Bearer" },
          "RouteClaimsRequirement": { "account_type": "4, 5" }
        },
        {
          "UpstreamPathTemplate": "/api/kyc/kycprofiles/{everything}",
          "UpstreamHttpMethod": ["OPTIONS", "GET", "POST", "PUT", "DELETE"],
          "DownstreamPathTemplate": "/api/kycprofiles/{everything}",
          "DownstreamScheme": "http",
          "DownstreamHostAndPorts": [{ "Host": "kycservice", "Port": 8080 }],
          "AuthenticationOptions": { "AuthenticationProviderKey": "Bearer" },
          "QoSOptions": { "ExceptionsAllowedBeforeBreaking": 3, "DurationOfBreak": 10, "TimeoutValue": 30000 }
        },
        {
          "UpstreamPathTemplate": "/api/kyc/kycprofiles",
          "UpstreamHttpMethod": ["OPTIONS", "GET", "POST"],
          "DownstreamPathTemplate": "/api/kycprofiles",
          "DownstreamScheme": "http",
          "DownstreamHostAndPorts": [{ "Host": "kycservice", "Port": 8080 }],
          "AuthenticationOptions": { "AuthenticationProviderKey": "Bearer" },
          "QoSOptions": { "ExceptionsAllowedBeforeBreaking": 3, "DurationOfBreak": 10, "TimeoutValue": 30000 }
        },
        {
          "UpstreamPathTemplate": "/api/kyc/{everything}",
          "UpstreamHttpMethod": ["OPTIONS", "GET", "POST", "PUT", "DELETE"],
          "DownstreamPathTemplate": "/api/kyc/{everything}",
          "DownstreamScheme": "http",
          "DownstreamHostAndPorts": [{ "Host": "kycservice", "Port": 8080 }],
          "AuthenticationOptions": { "AuthenticationProviderKey": "Bearer" },
          "QoSOptions": { "ExceptionsAllowedBeforeBreaking": 3, "DurationOfBreak": 10, "TimeoutValue": 30000 }
        },
        {
          "UpstreamPathTemplate": "/api/audit/{everything}",
          "UpstreamHttpMethod": ["GET", "POST", "PUT", "DELETE", "OPTIONS"],
          "DownstreamPathTemplate": "/api/audit/{everything}",
          "DownstreamScheme": "http",
          "DownstreamHostAndPorts": [{ "Host": "auditservice", "Port": 8080 }],
          "AuthenticationOptions": { "AuthenticationProviderKey": "Bearer" }
        },
        {
          "UpstreamPathTemplate": "/api/audit",
          "UpstreamHttpMethod": ["GET", "POST", "PUT", "DELETE", "OPTIONS"],
          "DownstreamPathTemplate": "/api/audit",
          "DownstreamScheme": "http",
          "DownstreamHostAndPorts": [{ "Host": "auditservice", "Port": 8080 }],
          "AuthenticationOptions": { "AuthenticationProviderKey": "Bearer" }
        },
        {
          "UpstreamPathTemplate": "/api/idempotency/{everything}",
          "UpstreamHttpMethod": ["GET", "POST", "DELETE", "OPTIONS"],
          "DownstreamPathTemplate": "/api/idempotency/{everything}",
          "DownstreamScheme": "http",
          "DownstreamHostAndPorts": [{ "Host": "idempotencyservice", "Port": 8080 }]
        },
        {
          "UpstreamPathTemplate": "/api/idempotency",
          "UpstreamHttpMethod": ["GET", "POST", "DELETE", "OPTIONS"],
          "DownstreamPathTemplate": "/api/idempotency",
          "DownstreamScheme": "http",
          "DownstreamHostAndPorts": [{ "Host": "idempotencyservice", "Port": 8080 }]
        },
        {
          "UpstreamPathTemplate": "/api/admin/employees",
          "UpstreamHttpMethod": ["OPTIONS", "GET", "POST"],
          "DownstreamPathTemplate": "/api/admin/employees",
          "DownstreamScheme": "http",
          "DownstreamHostAndPorts": [{ "Host": "adminservice", "Port": 8080 }],
          "AuthenticationOptions": { "AuthenticationProviderKey": "Bearer" }
        },
        {
          "UpstreamPathTemplate": "/api/admin/employees/{everything}",
          "UpstreamHttpMethod": ["OPTIONS", "GET", "POST", "PUT", "DELETE"],
          "DownstreamPathTemplate": "/api/admin/employees/{everything}",
          "DownstreamScheme": "http",
          "DownstreamHostAndPorts": [{ "Host": "adminservice", "Port": 8080 }],
          "AuthenticationOptions": { "AuthenticationProviderKey": "Bearer" }
        },
        {
          "UpstreamPathTemplate": "/api/admin/users/stats",
          "UpstreamHttpMethod": ["OPTIONS", "GET"],
          "DownstreamPathTemplate": "/api/admin/users/stats",
          "DownstreamScheme": "http",
          "DownstreamHostAndPorts": [{ "Host": "adminservice", "Port": 8080 }],
          "AuthenticationOptions": { "AuthenticationProviderKey": "Bearer" }
        },
        {
          "UpstreamPathTemplate": "/api/admin/users/{id}/status",
          "UpstreamHttpMethod": ["OPTIONS", "PATCH"],
          "DownstreamPathTemplate": "/api/admin/users/{id}/status",
          "DownstreamScheme": "http",
          "DownstreamHostAndPorts": [{ "Host": "adminservice", "Port": 8080 }],
          "AuthenticationOptions": { "AuthenticationProviderKey": "Bearer" }
        },
        {
          "UpstreamPathTemplate": "/api/admin/users/{id}/verify",
          "UpstreamHttpMethod": ["OPTIONS", "POST"],
          "DownstreamPathTemplate": "/api/admin/users/{id}/verify",
          "DownstreamScheme": "http",
          "DownstreamHostAndPorts": [{ "Host": "adminservice", "Port": 8080 }],
          "AuthenticationOptions": { "AuthenticationProviderKey": "Bearer" }
        },
        {
          "UpstreamPathTemplate": "/api/admin/{everything}",
          "UpstreamHttpMethod": ["OPTIONS", "GET", "POST", "PUT", "DELETE", "PATCH"],
          "DownstreamPathTemplate": "/api/admin/{everything}",
          "DownstreamScheme": "http",
          "DownstreamHostAndPorts": [{ "Host": "adminservice", "Port": 8080 }],
          "AuthenticationOptions": { "AuthenticationProviderKey": "Bearer" }
        },
        {
          "UpstreamPathTemplate": "/api/chat/message",
          "UpstreamHttpMethod": ["POST", "OPTIONS"],
          "DownstreamPathTemplate": "/api/chat/message",
          "DownstreamScheme": "http",
          "DownstreamHostAndPorts": [{ "Host": "chatbotservice", "Port": 8080 }],
          "RateLimitOptions": {
            "ClientWhitelist": [],
            "EnableRateLimiting": true,
            "Period": "1m",
            "PeriodTimespan": 60,
            "Limit": 30
          },
          "QoSOptions": {
            "ExceptionsAllowedBeforeBreaking": 3,
            "DurationOfBreak": 10,
            "TimeoutValue": 600000
          }
        },
        {
          "UpstreamPathTemplate": "/api/chat/whatsapp/webhook",
          "UpstreamHttpMethod": ["GET", "POST"],
          "DownstreamPathTemplate": "/api/chat/whatsapp/webhook",
          "DownstreamScheme": "http",
          "DownstreamHostAndPorts": [{ "Host": "chatbotservice", "Port": 8080 }],
          "QoSOptions": {
            "ExceptionsAllowedBeforeBreaking": 5,
            "DurationOfBreak": 10,
            "TimeoutValue": 30000
          }
        },
        {
          "UpstreamPathTemplate": "/api/chat/handoff/{everything}",
          "UpstreamHttpMethod": ["POST", "OPTIONS"],
          "DownstreamPathTemplate": "/api/chat/handoff/{everything}",
          "DownstreamScheme": "http",
          "DownstreamHostAndPorts": [{ "Host": "chatbotservice", "Port": 8080 }],
          "AuthenticationOptions": {
            "AuthenticationProviderKey": "Bearer"
          }
        },
        {
          "UpstreamPathTemplate": "/api/chat/{everything}",
          "UpstreamHttpMethod": ["GET", "POST", "PUT", "DELETE", "OPTIONS"],
          "DownstreamPathTemplate": "/api/chat/{everything}",
          "DownstreamScheme": "http",
          "DownstreamHostAndPorts": [{ "Host": "chatbotservice", "Port": 8080 }],
          "RateLimitOptions": {
            "ClientWhitelist": [],
            "EnableRateLimiting": true,
            "Period": "1m",
            "PeriodTimespan": 60,
            "Limit": 30
          }
        },
        {
          "UpstreamPathTemplate": "/api/chat",
          "UpstreamHttpMethod": ["GET", "POST", "PUT", "DELETE", "OPTIONS"],
          "DownstreamPathTemplate": "/api/chat",
          "DownstreamScheme": "http",
          "DownstreamHostAndPorts": [{ "Host": "chatbotservice", "Port": 8080 }],
          "RateLimitOptions": {
            "ClientWhitelist": [],
            "EnableRateLimiting": true,
            "Period": "1m",
            "PeriodTimespan": 60,
            "Limit": 30
          }
        },
        {
          "UpstreamPathTemplate": "/api/chatbot/{everything}",
          "UpstreamHttpMethod": ["GET", "POST", "PUT", "DELETE", "OPTIONS"],
          "DownstreamPathTemplate": "/api/chatbot/{everything}",
          "DownstreamScheme": "http",
          "DownstreamHostAndPorts": [{ "Host": "chatbotservice", "Port": 8080 }]
        },
        {
          "UpstreamPathTemplate": "/api/chatbot",
          "UpstreamHttpMethod": ["GET", "POST", "PUT", "DELETE", "OPTIONS"],
          "DownstreamPathTemplate": "/api/chatbot",
          "DownstreamScheme": "http",
          "DownstreamHostAndPorts": [{ "Host": "chatbotservice", "Port": 8080 }]
        }
      ],
      "SwaggerEndPoints": [
        {
          "Key": "AuthService",
          "Config": [{ "Name": "Auth Service", "Version": "v1", "Url": "http://authservice:8080/swagger/v1/swagger.json" }]
        },
        {
          "Key": "UserService",
          "Config": [{ "Name": "User Service", "Version": "v1", "Url": "http://userservice:8080/swagger/v1/swagger.json" }]
        },
        {
          "Key": "RoleService",
          "Config": [{ "Name": "Role Service", "Version": "v1", "Url": "http://roleservice:8080/swagger/v1/swagger.json" }]
        },
        {
          "Key": "VehiclesSaleService",
          "Config": [{ "Name": "Vehicles Sale Service", "Version": "v1", "Url": "http://vehiclessaleservice:8080/swagger/v1/swagger.json" }]
        },
        {
          "Key": "MediaService",
          "Config": [{ "Name": "Media Service", "Version": "v1", "Url": "http://mediaservice:8080/swagger/v1/swagger.json" }]
        },
        {
          "Key": "BillingService",
          "Config": [{ "Name": "Billing Service", "Version": "v1", "Url": "http://billingservice:8080/swagger/v1/swagger.json" }]
        },
        {
          "Key": "NotificationService",
          "Config": [{ "Name": "Notification Service", "Version": "v1", "Url": "http://notificationservice:8080/swagger/v1/swagger.json" }]
        },
        {
          "Key": "ErrorService",
          "Config": [{ "Name": "Error Service", "Version": "v1", "Url": "http://errorservice:8080/swagger/v1/swagger.json" }]
        },
        {
          "Key": "ChatbotService",
          "Config": [{ "Name": "Chatbot Service", "Version": "v1", "Url": "http://chatbotservice:8080/swagger/v1/swagger.json" }]
        },
        {
          "Key": "KYCService",
          "Config": [{ "Name": "KYC Service", "Version": "v1", "Url": "http://kycservice:8080/swagger/v1/swagger.json" }]
        },
        {
          "Key": "AuditService",
          "Config": [{ "Name": "Audit Service", "Version": "v1", "Url": "http://auditservice:8080/swagger/v1/swagger.json" }]
        },
        {
          "Key": "IdempotencyService",
          "Config": [{ "Name": "Idempotency Service", "Version": "v1", "Url": "http://idempotencyservice:8080/swagger/v1/swagger.json" }]
        },
        {
          "Key": "AdminService",
          "Config": [{ "Name": "Admin Service", "Version": "v1", "Url": "http://adminservice:8080/swagger/v1/swagger.json" }]
        }
      ],
      "GlobalConfiguration": {
        "BaseUrl": "https://okla.com.do",
        "LoadBalancerOptions": {
          "Type": "RoundRobin"
        },
        "QoSOptions": {
          "ExceptionsAllowedBeforeBreaking": 3,
          "DurationOfBreak": 10000,
          "TimeoutValue": 15000
        }
      }
    }
