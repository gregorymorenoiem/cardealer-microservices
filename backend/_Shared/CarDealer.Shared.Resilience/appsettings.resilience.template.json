{
  "_comment": "Configuración de Resiliencia estándar para microservicios OKLA. Copiar las secciones necesarias a cada appsettings.json",

  "Resilience": {
    "Enabled": true,
    "Retry": {
      "MaxRetries": 3,
      "DelaySeconds": 2,
      "UseExponentialBackoff": true,
      "UseJitter": true,
      "RetryStatusCodes": [408, 429, 500, 502, 503, 504]
    },
    "CircuitBreaker": {
      "FailureRatio": 0.5,
      "MinimumThroughput": 10,
      "SamplingDurationSeconds": 30,
      "BreakDurationSeconds": 30
    },
    "Timeout": {
      "TimeoutSeconds": 30,
      "TotalTimeoutSeconds": 120
    },
    "Bulkhead": {
      "Enabled": true,
      "MaxParallelization": 25,
      "MaxQueuingActions": 50
    },
    "RateLimiter": {
      "Enabled": false,
      "PermitLimit": 100,
      "QueueLimit": 10
    },
    "Fallback": {
      "Enabled": true,
      "UseCachedResponse": true,
      "CacheTtlSeconds": 300,
      "DegradedStatusCode": 503,
      "DefaultMessage": "Service temporarily unavailable. Please try again later."
    }
  },

  "_profiles": {
    "critical": {
      "_description": "Para AuthService, Gateway, BillingService — respuesta rápida, circuit breaker sensible",
      "Retry": { "MaxRetries": 2, "DelaySeconds": 1 },
      "CircuitBreaker": {
        "FailureRatio": 0.3,
        "MinimumThroughput": 5,
        "BreakDurationSeconds": 15
      },
      "Timeout": { "TimeoutSeconds": 10, "TotalTimeoutSeconds": 30 },
      "Bulkhead": { "MaxParallelization": 50 }
    },
    "background": {
      "_description": "Para NotificationService, AuditService — más reintentos, más tolerante",
      "Retry": { "MaxRetries": 5, "DelaySeconds": 5 },
      "CircuitBreaker": {
        "FailureRatio": 0.7,
        "MinimumThroughput": 20,
        "BreakDurationSeconds": 60
      },
      "Timeout": { "TimeoutSeconds": 60, "TotalTimeoutSeconds": 300 }
    },
    "internal": {
      "_description": "Para llamadas a AuditClient, IdempotencyClient — fire-and-forget, timeouts cortos",
      "Retry": { "MaxRetries": 2, "DelaySeconds": 1 },
      "CircuitBreaker": { "FailureRatio": 0.7, "BreakDurationSeconds": 15 },
      "Timeout": { "TimeoutSeconds": 5, "TotalTimeoutSeconds": 15 }
    }
  }
}
