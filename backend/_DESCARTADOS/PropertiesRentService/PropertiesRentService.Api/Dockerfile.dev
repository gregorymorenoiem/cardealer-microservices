# Development Dockerfile for PropertiesRentService
FROM mcr.microsoft.com/dotnet/sdk:8.0

WORKDIR /app

# Install wget for healthcheck
RUN apt-get update && apt-get install -y wget && rm -rf /var/lib/apt/lists/*

# Set environment
ENV ASPNETCORE_ENVIRONMENT=Development
ENV ASPNETCORE_URLS=http://+:80
ENV DOTNET_USE_POLLING_FILE_WATCHER=1

# Copy shared projects
COPY _Shared/CarDealer.Shared/ /app/_Shared/CarDealer.Shared/
COPY _Shared/CarDealer.Contracts/ /app/_Shared/CarDealer.Contracts/

# Copy service projects
COPY PropertiesRentService/PropertiesRentService.Domain/ /app/PropertiesRentService/PropertiesRentService.Domain/
COPY PropertiesRentService/PropertiesRentService.Application/ /app/PropertiesRentService/PropertiesRentService.Application/
COPY PropertiesRentService/PropertiesRentService.Infrastructure/ /app/PropertiesRentService/PropertiesRentService.Infrastructure/
COPY PropertiesRentService/PropertiesRentService.Shared/ /app/PropertiesRentService/PropertiesRentService.Shared/
COPY PropertiesRentService/PropertiesRentService.Api/ /app/PropertiesRentService/PropertiesRentService.Api/

WORKDIR /app/PropertiesRentService/PropertiesRentService.Api

# Restore and build
RUN dotnet restore
RUN dotnet build -c Debug

EXPOSE 80

HEALTHCHECK --interval=30s --timeout=10s --start-period=60s --retries=3 \
    CMD wget --no-verbose --tries=1 --spider http://localhost:80/health || exit 1

ENTRYPOINT ["dotnet", "run", "--no-build"]
