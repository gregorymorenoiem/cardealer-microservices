# Development Dockerfile for PropertiesSaleService
FROM mcr.microsoft.com/dotnet/sdk:8.0

WORKDIR /app

# Install wget for healthcheck
RUN apt-get update && apt-get install -y wget && rm -rf /var/lib/apt/lists/*

# Set environment
ENV ASPNETCORE_ENVIRONMENT=Development
ENV ASPNETCORE_URLS=http://+:80
ENV DOTNET_USE_POLLING_FILE_WATCHER=1

# Copy shared projects
COPY _Shared/CarDealer.Shared/ /app/_Shared/CarDealer.Shared/
COPY _Shared/CarDealer.Contracts/ /app/_Shared/CarDealer.Contracts/

# Copy service projects
COPY PropertiesSaleService/PropertiesSaleService.Domain/ /app/PropertiesSaleService/PropertiesSaleService.Domain/
COPY PropertiesSaleService/PropertiesSaleService.Application/ /app/PropertiesSaleService/PropertiesSaleService.Application/
COPY PropertiesSaleService/PropertiesSaleService.Infrastructure/ /app/PropertiesSaleService/PropertiesSaleService.Infrastructure/
COPY PropertiesSaleService/PropertiesSaleService.Shared/ /app/PropertiesSaleService/PropertiesSaleService.Shared/
COPY PropertiesSaleService/PropertiesSaleService.Api/ /app/PropertiesSaleService/PropertiesSaleService.Api/

WORKDIR /app/PropertiesSaleService/PropertiesSaleService.Api

# Restore and build
RUN dotnet restore
RUN dotnet build -c Debug

EXPOSE 80

HEALTHCHECK --interval=30s --timeout=10s --start-period=60s --retries=3 \
    CMD wget --no-verbose --tries=1 --spider http://localhost:80/health || exit 1

ENTRYPOINT ["dotnet", "run", "--no-build"]
