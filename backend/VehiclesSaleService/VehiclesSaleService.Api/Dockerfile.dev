# Development Dockerfile for VehiclesSaleService
FROM mcr.microsoft.com/dotnet/sdk:8.0

WORKDIR /app

# Install wget for healthcheck
RUN apt-get update && apt-get install -y wget && rm -rf /var/lib/apt/lists/*

# Set environment
ENV ASPNETCORE_ENVIRONMENT=Development
ENV ASPNETCORE_URLS=http://+:80
ENV DOTNET_USE_POLLING_FILE_WATCHER=1

# Copy shared projects
COPY _Shared/CarDealer.Shared/ /app/_Shared/CarDealer.Shared/
COPY _Shared/CarDealer.Contracts/ /app/_Shared/CarDealer.Contracts/

# Copy service projects
COPY VehiclesSaleService/VehiclesSaleService.Domain/ /app/VehiclesSaleService/VehiclesSaleService.Domain/
COPY VehiclesSaleService/VehiclesSaleService.Application/ /app/VehiclesSaleService/VehiclesSaleService.Application/
COPY VehiclesSaleService/VehiclesSaleService.Infrastructure/ /app/VehiclesSaleService/VehiclesSaleService.Infrastructure/
COPY VehiclesSaleService/VehiclesSaleService.Shared/ /app/VehiclesSaleService/VehiclesSaleService.Shared/
COPY VehiclesSaleService/VehiclesSaleService.Api/ /app/VehiclesSaleService/VehiclesSaleService.Api/

WORKDIR /app/VehiclesSaleService/VehiclesSaleService.Api

# Restore and build
RUN dotnet restore
RUN dotnet build -c Debug

EXPOSE 80

HEALTHCHECK --interval=30s --timeout=10s --start-period=60s --retries=3 \
    CMD wget --no-verbose --tries=1 --spider http://localhost:80/health || exit 1

ENTRYPOINT ["dotnet", "run", "--no-build"]
