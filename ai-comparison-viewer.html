<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
      AI Processing Comparison Viewer - BackgroundRemoval vs VehicleSegmentation
    </title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family:
          -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          "Helvetica Neue", Arial, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 40px 20px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .container {
        max-width: 1400px;
        width: 100%;
        background: white;
        border-radius: 12px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        overflow: hidden;
      }

      .header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 40px;
        text-align: center;
      }

      .header h1 {
        font-size: 32px;
        margin-bottom: 10px;
        font-weight: 600;
      }

      .header p {
        font-size: 16px;
        opacity: 0.9;
        margin-bottom: 20px;
      }

      .status {
        display: inline-block;
        padding: 8px 16px;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 20px;
        font-size: 14px;
        font-weight: 500;
      }

      .status.loading::after {
        content: "";
        display: inline-block;
        width: 8px;
        height: 8px;
        background: #fff;
        border-radius: 50%;
        margin-left: 8px;
        animation: pulse 1.5s infinite;
      }

      @keyframes pulse {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.5;
        }
      }

      .content {
        padding: 40px;
      }

      .comparison-section {
        margin-bottom: 40px;
      }

      .section-title {
        font-size: 20px;
        font-weight: 600;
        margin-bottom: 30px;
        color: #333;
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .badge {
        display: inline-block;
        padding: 4px 12px;
        border-radius: 4px;
        font-size: 12px;
        font-weight: 600;
        text-transform: uppercase;
      }

      .badge.bg-removal {
        background: #e3f2fd;
        color: #1976d2;
      }

      .badge.segmentation {
        background: #f3e5f5;
        color: #7b1fa2;
      }

      .comparison-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 30px;
        margin-bottom: 30px;
      }

      @media (max-width: 900px) {
        .comparison-grid {
          grid-template-columns: 1fr;
        }
      }

      .image-card {
        background: #f5f5f5;
        border-radius: 8px;
        overflow: hidden;
        border: 1px solid #e0e0e0;
        transition: all 0.3s ease;
      }

      .image-card:hover {
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
      }

      .image-header {
        padding: 16px;
        border-bottom: 1px solid #e0e0e0;
        background: #fafafa;
      }

      .image-header h3 {
        font-size: 14px;
        font-weight: 600;
        color: #333;
        margin-bottom: 4px;
      }

      .image-header p {
        font-size: 12px;
        color: #999;
      }

      .image-container {
        position: relative;
        aspect-ratio: 4/3;
        background: white;
        overflow: hidden;
      }

      .image-container img {
        width: 100%;
        height: 100%;
        object-fit: contain;
        background: #f5f5f5;
      }

      .image-container.loading {
        display: flex;
        align-items: center;
        justify-content: center;
        background: #f5f5f5;
      }

      .spinner {
        border: 3px solid #f3f3f3;
        border-top: 3px solid #667eea;
        border-radius: 50%;
        width: 32px;
        height: 32px;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .image-footer {
        padding: 12px 16px;
        background: #fafafa;
        border-top: 1px solid #e0e0e0;
        font-size: 12px;
        color: #666;
      }

      .description {
        background: #f5f5f5;
        border-left: 4px solid #667eea;
        padding: 16px;
        border-radius: 4px;
        margin-bottom: 30px;
        line-height: 1.6;
      }

      .description h4 {
        font-size: 14px;
        font-weight: 600;
        margin-bottom: 8px;
        color: #333;
      }

      .description p {
        font-size: 13px;
        color: #666;
        margin-bottom: 8px;
      }

      .description ul {
        font-size: 13px;
        color: #666;
        margin-left: 20px;
      }

      .description li {
        margin-bottom: 4px;
      }

      .info-section {
        background: #f9f9f9;
        padding: 24px;
        border-radius: 8px;
        margin-top: 40px;
        border: 1px solid #e0e0e0;
      }

      .info-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
      }

      .info-item {
        padding: 16px;
        background: white;
        border-radius: 6px;
        border: 1px solid #e0e0e0;
      }

      .info-label {
        font-size: 12px;
        font-weight: 600;
        text-transform: uppercase;
        color: #999;
        margin-bottom: 8px;
      }

      .info-value {
        font-size: 14px;
        font-weight: 600;
        color: #333;
        font-family: "Courier New", monospace;
        word-break: break-all;
      }

      .info-value.status-queued {
        color: #ff9800;
      }

      .info-value.status-processing {
        color: #2196f3;
      }

      .info-value.status-completed {
        color: #4caf50;
      }

      .info-value.status-error {
        color: #f44336;
      }

      .error-message {
        background: #ffebee;
        border-left: 4px solid #f44336;
        padding: 16px;
        border-radius: 4px;
        color: #c62828;
        font-size: 14px;
        margin-bottom: 20px;
      }

      .legend {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-top: 30px;
      }

      .legend-item {
        padding: 12px;
        background: white;
        border-radius: 6px;
        border-left: 4px solid #667eea;
      }

      .legend-item.segmentation {
        border-left-color: #7b1fa2;
      }

      .legend-item h4 {
        font-size: 13px;
        font-weight: 600;
        margin-bottom: 4px;
        color: #333;
      }

      .legend-item p {
        font-size: 12px;
        color: #666;
        line-height: 1.5;
      }

      .footer {
        padding: 20px 40px;
        background: #f5f5f5;
        border-top: 1px solid #e0e0e0;
        text-align: center;
        font-size: 12px;
        color: #999;
      }

      .timestamp {
        display: block;
        margin-top: 10px;
        font-size: 11px;
        color: #bbb;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <!-- Header -->
      <div class="header">
        <h1>üé® AI Processing Comparison</h1>
        <p>BackgroundRemoval vs VehicleSegmentation</p>
        <div class="status loading" id="status">Loading test data...</div>
      </div>

      <!-- Content -->
      <div class="content">
        <!-- Description -->
        <div class="description">
          <h4>‚ÑπÔ∏è What you're looking at:</h4>
          <p>
            These are two different AI processing modes applied to the same
            vehicle image:
          </p>
          <ul>
            <li>
              <strong>BackgroundRemoval (Type=0):</strong> Detects the vehicle
              and replaces the background with white, keeping the vehicle in its
              original colors
            </li>
            <li>
              <strong>VehicleSegmentation (Type=1):</strong> Creates a binary
              mask showing exactly which pixels belong to the vehicle (white) vs
              background (black)
            </li>
          </ul>
        </div>

        <!-- Main Comparison -->
        <div class="comparison-section">
          <div class="section-title">
            <span>Processing Results Comparison</span>
          </div>

          <div class="comparison-grid">
            <!-- BackgroundRemoval -->
            <div class="image-card">
              <div class="image-header">
                <h3>
                  <span class="badge bg-removal">Type=0</span> BackgroundRemoval
                </h3>
                <p>Vehicle with white background</p>
              </div>
              <div class="image-container loading" id="container-bg-removal">
                <div class="spinner"></div>
              </div>
              <div class="image-footer">
                <strong>Job ID:</strong>
                <span id="job-bg-removal-id"
                  >5227d73d-a784-4d3b-b051-718386361414</span
                ><br />
                <strong>Status:</strong>
                <span id="job-bg-removal-status" class="status-queued"
                  >Queued</span
                ><br />
                <strong>URL:</strong>
                <span
                  id="job-bg-removal-url"
                  style="word-break: break-all; font-size: 10px"
                  >-</span
                >
              </div>
            </div>

            <!-- VehicleSegmentation -->
            <div class="image-card">
              <div class="image-header">
                <h3>
                  <span class="badge segmentation">Type=1</span>
                  VehicleSegmentation
                </h3>
                <p>Binary mask of vehicle detection</p>
              </div>
              <div class="image-container loading" id="container-segmentation">
                <div class="spinner"></div>
              </div>
              <div class="image-footer">
                <strong>Job ID:</strong>
                <span id="job-seg-id">c2d83092-283b-4283-927f-15518d5f1fcf</span
                ><br />
                <strong>Status:</strong>
                <span id="job-seg-status" class="status-queued">Queued</span
                ><br />
                <strong>URL:</strong>
                <span
                  id="job-seg-url"
                  style="word-break: break-all; font-size: 10px"
                  >-</span
                >
              </div>
            </div>
          </div>
        </div>

        <!-- Job Details -->
        <div class="info-section">
          <div class="section-title">üìä Processing Details</div>
          <div class="info-grid">
            <div class="info-item">
              <div class="info-label">BackgroundRemoval Job</div>
              <div class="info-value" id="detail-bg-job">
                d9f2f6e3-e75f-4e7c-951e-e95a45c19b10
              </div>
            </div>
            <div class="info-item">
              <div class="info-label">VehicleSegmentation Job</div>
              <div class="info-value" id="detail-seg-job">
                18e4fe4d-6ef9-4130-9859-116522b93e3a
              </div>
            </div>
            <div class="info-item">
              <div class="info-label">BackgroundRemoval Status</div>
              <div class="info-value status-queued" id="detail-bg-status">
                Queued
              </div>
            </div>
            <div class="info-item">
              <div class="info-label">VehicleSegmentation Status</div>
              <div class="info-value status-queued" id="detail-seg-status">
                Queued
              </div>
            </div>
            <div class="info-item">
              <div class="info-label">Processing Time (BG Removal)</div>
              <div class="info-value" id="detail-bg-time">-</div>
            </div>
            <div class="info-item">
              <div class="info-label">Processing Time (Segmentation)</div>
              <div class="info-value" id="detail-seg-time">-</div>
            </div>
          </div>
        </div>

        <!-- Legend -->
        <div class="legend">
          <div class="legend-item">
            <h4>‚úÖ BackgroundRemoval (Type=0)</h4>
            <p>
              Uses YOLO to detect vehicle, then SAM2 to segment it precisely.
              Replaces background with white color while preserving vehicle
              colors.
            </p>
          </div>
          <div class="legend-item segmentation">
            <h4>‚úÖ VehicleSegmentation (Type=1)</h4>
            <p>
              Creates a binary mask where white = vehicle pixels, black =
              background. Used for precise vehicle boundary detection.
            </p>
          </div>
        </div>
      </div>

      <!-- Footer -->
      <div class="footer">
        OKLA AI Processing System - Real-time comparison viewer
        <span class="timestamp" id="timestamp"></span>
      </div>
    </div>

    <script>
      const TOKEN =
        "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJ0ZXN0LXVzZXItMDAxIiwibmFtZSI6IlRlc3QgVXNlciIsImVtYWlsIjoidGVzdEBva2xhLmNvbS5kbyIsInJvbGUiOiJBZG1pbiIsImlzcyI6Ik9LTEEiLCJhdWQiOiJPS0xBLVVzZXJzIiwiaWF0IjoxNzY5NDM2MTQ4LCJleHAiOjE3Njk1MjI1NDh9.sbKVm3kJmx0g1DPG3bVFSbTKJlJ09sqh1R4d4N9mgA0";
      const API_URL = "http://localhost:5070/api/aiprocessing";

      const JOBS = {
        bgRemoval: {
          id: "5958a547-f766-4092-999b-a4a3c800345f",
          name: "BackgroundRemoval",
          containerId: "container-bg-removal",
          jobIdElement: "job-bg-removal-id",
          statusElement: "job-bg-removal-status",
          urlElement: "job-bg-removal-url",
          detailStatus: "detail-bg-status",
          detailTime: "detail-bg-time",
        },
        segmentation: {
          id: "26d95f2f-0e48-472a-a686-9097768b0011",
          name: "VehicleSegmentation",
          containerId: "container-segmentation",
          jobIdElement: "job-seg-id",
          statusElement: "job-seg-status",
          urlElement: "job-seg-url",
          detailStatus: "detail-seg-status",
          detailTime: "detail-seg-time",
        },
      };

      function updateStatus(message) {
        document.getElementById("status").textContent = message;
        document.getElementById("timestamp").textContent =
          `Updated: ${new Date().toLocaleString()}`;
      }

      async function checkJobStatus(job) {
        try {
          const response = await fetch(`${API_URL}/jobs/${job.id}`, {
            method: "GET",
            headers: {
              "Content-Type": "application/json",
            },
          });

          if (!response.ok) {
            throw new Error(`HTTP ${response.status}`);
          }

          const data = await response.json();
          updateJobUI(job, data);
          return data.status;
        } catch (error) {
          console.error(`Error checking job ${job.id}:`, error);
          document.getElementById(job.statusElement).textContent = "Error";
          document.getElementById(job.detailStatus).textContent = "Error";
          return "error";
        }
      }

      function updateJobUI(job, data) {
        const statusElement = document.getElementById(job.statusElement);
        const detailStatus = document.getElementById(job.detailStatus);
        const container = document.getElementById(job.containerId);

        // Update status text
        let statusText = data.status || "Unknown";
        statusElement.textContent = statusText;
        statusElement.className = `status-${statusText.toLowerCase()}`;
        detailStatus.textContent = statusText;
        detailStatus.className = `status-${statusText.toLowerCase()}`;

        // Update URL
        if (data.processedUrl) {
          document.getElementById(job.urlElement).textContent =
            data.processedUrl;
        }

        // Update processing time
        if (data.processingTimeMs) {
          document.getElementById(job.detailTime).textContent =
            `${(data.processingTimeMs / 1000).toFixed(2)}s`;
        }

        // Load image if completed
        if (statusText.toLowerCase() === "completed" && data.processedUrl) {
          container.classList.remove("loading");
          container.innerHTML = `<img src="${data.processedUrl}" alt="${job.name}" loading="lazy" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22400%22 height=%22300%22%3E%3Ctext x=%2250%25%22 y=%2250%25%22 text-anchor=%22middle%22 dy=%22.3em%22 font-family=%22Arial%22 font-size=%2216%22 fill=%22%23999%22%3EImage failed to load%3C/text%3E%3C/svg%3E'">`;
        }
      }

      async function pollJobs() {
        updateStatus("‚è≥ Checking job status...");

        const statuses = await Promise.all([
          checkJobStatus(JOBS.bgRemoval),
          checkJobStatus(JOBS.segmentation),
        ]);

        const allCompleted = statuses.every(
          (s) => s === "Completed" || s === "completed",
        );
        const anyError = statuses.some((s) => s === "Error" || s === "error");

        if (allCompleted) {
          updateStatus("‚úÖ Processing complete!");
          clearInterval(pollInterval);
        } else if (anyError) {
          updateStatus("‚ùå Processing encountered an error");
          clearInterval(pollInterval);
        } else {
          updateStatus("‚è≥ Processing in progress...");
          // Continue polling
        }
      }

      // Initial poll
      pollJobs();

      // Poll every 2 seconds
      const pollInterval = setInterval(pollJobs, 2000);

      // Clear interval after 5 minutes
      setTimeout(
        () => {
          clearInterval(pollInterval);
          updateStatus("‚è±Ô∏è Polling stopped. Refresh page to resume.");
        },
        5 * 60 * 1000,
      );

      // Update timestamp
      document.getElementById("timestamp").textContent =
        `Updated: ${new Date().toLocaleString()}`;
    </script>
  </body>
</html>
